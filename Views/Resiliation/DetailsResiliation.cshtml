@model BeeProj.Models.B_RESILIATIONENTETE
@{
    ViewBag.Title = "DetailsResiliation";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
    <!-- Sweet Alert -->
<link href="~/css/plugins/sweetalert/sweetalert.css" rel="stylesheet"> 

<style>
    .dataTables_filter, .dataTables_info, .dataTables_length, .dataTables_paginate {
        display: none;
    }

    .dataTableMargin .ui-datatable-tablewrapper {
        overflow: hidden;
    }

    .table .table-bordered .table-striped {
        overflow-x: hidden;
        overflow-y: hidden;
    }

    .dataTables_scroll {
        overflow: auto;
    }


    table {
        table-layout: fixed;
        width: 98% !important;
    }
</style>
<title>Résiliation | Détail Résiliation </title>

<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="font-awesome/css/font-awesome.css" rel="stylesheet">

<link href="css/animate.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-sm-4">
        <h2> Détails Résiliation</h2>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="index.html"> Acceuil </a>
            </li>
            <li class="breadcrumb-item active">
                <strong>Détails Résiliation</strong>
            </li>
        </ol>
    </div>
</div>

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Demande Résiliation: Ref #@Model.R_Piece </h2>
        <ol class="breadcrumb">
            <li>
                <a href="@Url.Action("index","Home")">Acceuil </a>

            </li>
            <li>
                <a href="@Url.Action("ListeResiliation","Resiliation")">Liste Résiliations </a>

            </li>
            <li class="active">
                <strong>Détails Résiliation</strong>
            </li>
        </ol>
    </div>
    <div class="col-lg-2">

    </div>
</div>

<div class="row">
    <div class="col-lg-9" style="width: 75%; height: 70%;">
        <div class="wrapper wrapper-content animated fadeInUp">
            <div class="ibox">
                <div class="ibox-content">
                    <div class="row">
                        <div class="col-lg-12">

                            @if ((ViewBag.ResRecp == true && Model.R_Etat == 0) || (ViewBag.ResTrait == true && Model.R_Etat == 1))
                            {

                                <div class="m-b-md">
                                    <a href=@Url.Action("ModifResiliation/" + Model.cbMarq, "Resiliation") class="btn lazur-bg pull-right btn-rounded">Modifier la demande</a>
                                    <h3>Description de la demande de Résiliation #@Model.R_Piece</h3>
                                </div>
                            }
                        </div>
                    </div>



                    @*----------------------------------------------------------------------------------------------------------*@
                    <div class="row">

                        <div class="col-lg-5 ">

                            @*<dt>Modifier par</dt>
                                <dd>@Html.DisplayFor(model => model.cbCreateur)</dd>
                                <br />
                                <dt>Date d'envoi</dt>
                                <dd><small>@Html.DisplayFor(model => model.RC_DATE)</small></dd>
                                <br />
                                <dt>Matricule</dt>
                                <dd>@Html.DisplayFor(model => model.cbMarq)</dd>*@


                            <dl class="dl-horizontal ">
                                <br />
                                <dt>Ajouté par  </dt>
                                <dd>@Html.DisplayFor(model => model.cbCreateur)</dd>



                                <dt>Téléphone</dt>
                                <dd>@ViewBag.tel</dd>
                                <dd></dd>


                                <dt>Email</dt>
                                <dd>@ViewBag.mail </dd>


                                <dt>Agence </dt>
                                <dd> @ViewBag.Agence  </dd>



                            </dl>


                        </div>
                        <div class="col-lg-7" id="cluster_info">
                            <dl class="dl-horizontal">
                                <br />
                                @if ((ViewBag.ResTrait == true || ViewBag.ResRecp == true) && Model.R_Etat == 1)
                                {

                                    <dt>Affecté à</dt>
                                            <dd>
                                              @Html.DisplayFor(model => model.R_Affecte)  
                                            </dd>
                                            <br />
                                }




                                <dt>Statut</dt>

                                @if (Model.R_Etat == 0)
                                {
                                    <dd><span><i class="label style1 blue-bg">En attente</i> </span></dd>
                                }
                                else if (Model.R_Etat == 1)
                                {
                                    //<dd><span class="label bg-info">@Html.DisplayFor(model => model.RC_ETAT) </span></dd>
                                    <dd><span><i class="label bg-warning ">En cours</i></span></dd>


                                }

                                else if (Model.R_Etat == 2)
                                {
                                    <dd><span><i class="label bg-info "> Validée </i> </span></dd>

                                }
                                else if (Model.R_Etat == 3)
                                {
                                    <dd><span><i class="label bg-danger"> Annuler </i></span></dd>
                                }
                                <br />
                                <dt>Service</dt>


                                <dd><span><i class="label style1 label-info"> Service Commercial</i> </span></dd>

                                <br />
                                @*<dt>Abonnements à Resilier</dt>
                                <dd>
                                    <ul>
                                        @if (ViewBag.AboResi.Count == 0)
                                        {
                                            <p><center>Aucun abonnement à résilier </center> </p>
                                        }
                                        else
                                        {
                                            foreach (var item in ViewBag.AboResi)
                                            {
                                                <li>@item.AR_Design</li>

                                            }
                                        }
                                    </ul>

                                </dd>*@

                                
                                



                            </dl>

                        </div>
                        <!--********************************here-->






                        <div class="panel-body">

                            <div class="tab-content">
                                <!--FIN AVANCEMENT -->

                            </div>
                        </div>

                        <div class="row m-t-sm">
                            <div class="col-lg-12">
                                <div class="panel blank-panel">
                                    <div class="panel-heading">
                                        <div class="panel-options">
                                            <ul class="nav nav-tabs">
                                                <li class="nav-link active"><a href="#tab-8" data-toggle="tab">Détails</a></li>
                                                <li class="nav-link "><a href="#tab-1" data-toggle="tab">Généralité</a></li>
                                                <li class="nav-link"><a href="#tab-6" data-toggle="tab">Remarques</a></li>
                                                <li class=""><a href="#tab-4" data-toggle="tab">Documents</a></li>
                                                <li class=""><a href="#tab-5" data-toggle="tab">Facturation</a></li>
                                                @if(Model.R_Etat == 2) {
                                                <li class=""><a href="#tab-7" class="label-danger" data-toggle="tab">Retour Materiels</a></li>
                                                }

                                            </ul>
                                        </div>
                                    </div>


                                    <div class="panel-body">

                                        <div class="tab-content">


                                            <!-- Détails-->

                                            <div class="tab-pane active " id="tab-8">
                                                <form method="get" class="form-horizontal">

                                                    <div class="ibox float-e-margins">

                                                       

                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label">Intitulé Client</label>
                                                            <div class="col-sm-10">
                                                                <span class="help-block m-b-none">
                                                                    @Html.TextBoxFor(model => model.CT_Intitule, new { @class = "form-control", @Readonly = "Readonly" })
                                                                </span>

                                                            </div>
                                                        </div>




                                                       
                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label">Abonnements à Résilier</label>
                                                            <div class="col-sm-10">
                                                                <div class="editable form-control" contenteditable="true" Readonly = "Readonly">
                                                                    <ul>
                                                                        @if (ViewBag.AboResi.Count == 0)
                                                                        {
                                                                            <p><center>Aucun abonnement à résilier </center> </p>
                                                                        }
                                                                        else
                                                                        {
                                                                            foreach (var item in ViewBag.AboResi)
                                                                            {
                                                                                <li>@item.AR_Design</li>

                                                                            }
                                                                        }
                                                                    </ul>
                                                                   </div>
                                                                    @*@Html.TextAreaFor(model => model.R_Description, new { @class = "form-control", @Readonly = "Readonly" })*@

                                                                </div>
                                                        </div>





                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label">Date d'envoi</label>

                                                            <div class="col-sm-10">
                                                                <span class="help-block m-b-none">
                                                                    <input class="form-control" value="@ViewBag.date" readonly="readonly" />
                                                                    @*@Html.TextBoxFor(model => model.R_Envoi, new { @class = "form-control", @Readonly = "Readonly" })*@
                                                                </span>
                                                            </div>
                                                        </div>



                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label">Référence Abonnement</label>

                                                            <div class="col-sm-10">
                                                                <span class="help-block m-b-none">
                                                                    @Html.TextBoxFor(model => model.DO_RefTT, new { @class = "form-control", @Readonly = "Readonly" })
                                                                </span>
                                                            </div>
                                                        </div>




                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label">Description Résiliation</label>
                                                            <div class="col-sm-10">
                                                                <span class="help-block m-b-none">
                                                                    @Html.TextAreaFor(model => model.R_Description, new { @class = "form-control", @Readonly = "Readonly" })
                                                                </span>
                                                            </div>
                                                        </div>


                                                    </div>


                                                </form>
                                            </div>
                                            <!-- FIN Détails-->







                                            <!-- Généralité-->

                                            <div class="tab-pane" id="tab-1">
                                                <form method="get" class="form-horizontal">

                                                    <div class="ibox float-e-margins">

                                                        @*<div class="ibox-title">
                                                            <h5> Gnénéralités Client</h5>
                                                               <div class="ibox-tools">
                                                                   <a class="collapse-link">
                                                                   <i class="fa fa-chevron-up text-navy"></i>
                                                                   </a>
                                                                 </div>
                                                              </div>*@

                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label">Identifiant</label>
                                                            <div class="col-sm-10">
                                                                <span class="help-block m-b-none">
                                                                    @Html.TextBoxFor(model => model.CT_Identifiant, new { @class = "form-control", @Readonly = "Readonly" })
                                                                </span>

                                                            </div>
                                                        </div>


                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label">Telephone</label>

                                                            <div class="col-sm-10">
                                                                <span class="help-block m-b-none">
                                                                    @Html.TextBoxFor(model => model.CT_Telephone, new { @class = "form-control", @Readonly = "Readonly" })
                                                                </span>
                                                            </div>
                                                        </div>



                                                        <div class="form-group">
                                                            <label class="col-sm-2 control-label">Adresse</label>

                                                            <div class="col-sm-10">
                                                                <span class="help-block m-b-none">
                                                                    @Html.TextBoxFor(model => model.CT_Adresse, new { @class = "form-control", @Readonly = "Readonly" })
                                                                </span>
                                                            </div>
                                                        </div>



                                                        @*<div class="form-group">
                                                                <label class="col-sm-2 control-label">Service Concerné </label>

                                                                <div class="col-sm-10">
                                                                    <span class="help-block m-b-none">

                                                                        @if (Model.RC_SERVICE == 22)
                                                                        {
                                                                            <p class="form-control" Readonly="Readonly"> Service Facturation </p>

                                                                        }
                                                                        else if (Model.RC_SERVICE == 3)
                                                                        {
                                                                            <p class="form-control " Readonly="Readonly">Service Internet </p>
                                                                        }

                                                                        else
                                                                        {
                                                                            <p class="form-control " Readonly="Readonly">Service Technique </p>
                                                                        }

                                                                    </span>

                                                                </div>
                                                            </div>*@
                                                        

                                                        
                                                    </div>


                                                </form>
                                            </div>
                                            <!-- FIN Généralité-->
                                            <!-- Remarques -->


                                            <div class="tab-pane" id="tab-6">
                                                <div class="row">
                                                    @if (ViewBag.ListRemarque.Count == 0)
                                                    {
                                                        <p><center>Aucune Remarque </center> </p>
                                                    }
                                                    else
                                                    {
                                                        <div class="wrapper wrapper-content animated fadeInUp">
                                                            @foreach (var item in ViewBag.ListRemarque)
                                                            {



                                                                <ul class="notes">
                                                                    <li>
                                                                        <div>
                                                                            <small>@item.RQ_Date</small>
                                                                            <h4>@item.RQ_Sujet</h4>
                                                                            <p>@item.RQ_Description</p>
                                                                            @*<a href="#"><i class="fa fa-trash-o "></i></a>*@
                                                                        </div>
                                                                    </li>


                                                                </ul>

                                                            }
                                                        </div>
                                                    }
                                                </div>


                                            </div>

                                            <!--Fin Remarque-->
                                            <!-- Documents -->
                                            <div id="tab-4" class="tab-pane">
                                                <div class="panel-body full-height-scroll" style="overflow:scroll;height:inherit;width:inherit">

                                                    <div class="table-responsive">
                                                        <table class="table table-bordered table-stripped">
                                                            <thead>



                                                                <tr>
                                                                    <th></th>
                                                                    <th>
                                                                        Intitulé Document
                                                                    </th>


                                                                    <th> Description </th>
                                                                    <th>
                                                                        Ajouté par
                                                                    </th>
                                                                    <th>
                                                                        Date
                                                                    </th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                @*@if (ViewBag.ListFiles.Count == 0)
                                                                {
                                                                    <p><center>Aucune Fichier </center> </p>
                                                                }
                                                                else {*@ 
                                                                @foreach (var item in ViewBag.ListFiles)
                                                                {
                                                                    <tr>
                                                                        <td>
                                                                            <a href=@item.B_Lien target="_blank"> Voir </a>
                                                                        </td>
                                                                        <td>
                                                                            @item.B_Intitule
                                                                        </td>
                                                                        <td>
                                                                            @item.B_Description

                                                                        </td>
                                                                        <td> @item.cbCreateur</td>
                                                                        <td> @item.cbModification</td>

                                                                    </tr>
                                                                    @*}*@
                                                                }


                                                            </tbody>
                                                        </table>
                                                    </div>



                                                </div>
                                            </div>


                                            <!--Fin Document -->
                                            <!-- Commercial-->

                                            <div class="tab-pane" id="tab-5">
                                                <div>
                                                    <table class="table table-striped table-hover" id="facture">
                                                        <thead>
                                                            <tr>
                                                                <th></th>
                                                                <th>Statut</th>
                                                                <th>N° Pièce</th>
                                                                <th>Date </th>
                                                                @*<th>Référence</th>*@
                                                                <th>Montant TTC</th>
                                                                <th></th>
                                                            </tr>
                                                        </thead>


                                                    </table>
                                                </div>
                                                <button type="button" class="btn-xs btn-warning pull-right" id="generer"> Générer Factures </button>
                                              </div>
                                            <!--Fin Commercial-->

                                            <!-- Bon de retour-->

                                            <div class="tab-pane" id="tab-7">
                                                <div>
                                                     @*@if (ViewBag.ListMateriel == null)
                                                     {
                                                        <p><center>Aucune Materiel à retourner </center> </p>
                                                     }*@
                                                     @*else
                                                     {*@
                                                    <table class="table table-striped table-hover" id="Materiel">
                                                        <thead>
                                                            <tr>
                                                               <th></th>
                                                                <th>Référence</th>
                                                                <th>Article</th>
                                                                <th>Quantité</th>
                                                                <th>N° Serie</th>
                                                               
                                                            </tr>
                                                        </thead>
                                                        @*<tbody>
                                                            @foreach (var item in ViewBag.ListMateriel)
                                                            {
                                                                <tr>
                                                                    <td><input type="checkbox" name="" /></td>
                                                                    <td>
                                                                        @item.AR_Ref
                                                                   </td>
                                                                    <td>
                                                                        @item.DL_Design
                                                                    </td>
                                                                    <td>@item.DL_Qte</td>
                                                              
                                                                    <td>
                                                                        @item.LS_NoSerie

                                                                    </td>
                                                                   
                                                                </tr>

                                                            }

                                                        </tbody>*@


                                                    </table>
                                                    <button type="button" class="btn-xs btn-danger pull-right" id="retourner"> Retourner au stock </button>

                                                     @*}*@
                                                </div>
                                            </div>
                                            <!--Bon de retour-->
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
        </div>
    </div>


    <!-- TimeLine-->

    <div class="col-lg-3" id="target" style="overflow: scroll; width:25%; height: 650px;">
        <div id="vertical-timeline" class="vertical-containe">


            @foreach (var item in ViewBag.ListAction)
            {

                <div class="vertical-timeline-block bg-muted">


                    <div class="vertical-timeline-icon lazur-bg">
                        <i class="fa fa-dot-circle-o"></i>
                    </div>


                    <div class="vertical-timeline-content ">
                        <div class="stream-panel">
                            <div class="stream-info">
                                <a href="#">

                                    <span>@item.cbCreateur</span>
                                    <span class="date">@item.cbModification</span>
                                </a>
                            </div>

                            @item.AC_Commentaire .
                        </div>
                    </div>
                </div>


            }





        </div>

    </div>

</div>


<!-- Mainly scripts -->
<script src="~/js/jquery-3.1.1.min.js"></script>
<script src="~/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="~/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<script src="~/js/plugins/dataTables/datatables.min.js"></script>
    <!-- Sweet alert -->
<script src="~/js/plugins/sweetalert/sweetalert.min.js"></script>

<script>


    function format(table_id) {



        return '<table id="table_id" cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;" class="table  table-hover">' +
          '<thead>'+
    '<th></th>'+
    '<th></th>'+
    '<th></th>'+
    '<th></th>'+

    '</thead>'+
       '</table>';
    }


    function sub_DataTable(vtask_id,table_id) {

        var subtable = $('#table_id').DataTable({
            "ajax": {
                "url": "/Resiliation/FactureLineJson?id="+vtask_id,
                "type": "get",
                "datatype": "json",
                "scrollX": false,
                "width": "98%"

            },

            "columns": [

                 { "data": "AR_Ref" },
                 { "data": "DL_Design" },
                 { "data": "DL_Qte" },
                { "data": "DL_totalTTC" }



            ]
        });
    }


function getFactures() {
    var table = $("#facture").DataTable({
        "ajax": {
            "url": "/Resiliation/FactureJson?id=" + @Model.cbMarq,
            "type": "get",
            "datatype": "json",
            "scrollX": true,
            "scrollCollapse": false
        },
        "columns": [
                {
                    "className": "details-control",
                    "orderable":  false,
                    "data":       "cbMarq",
                    "defaultContent": ''
                },
                { "data": "DO_Statut" },
                { "data": "DO_Piece" },
                { "data": "DO_Date" },
              { "data": "DL_totalTTC" },
              { "data": "cbMarq" },



        ],
        "columnDefs": [

                {
                    targets: [0],
                    render: function (data, type, row) {

                        return '<i class="fa fa-plus-circle"></i>';




                    }

                },

                {
                    targets: [1],
                    render: function (data, type, row) {
                        if (data == 0) {
                            return '<i class="label bg-warning ">' + 'Non Payé' + '</i>';
                        }
                        else if (data == 1) {
                            return '<i class="label bg-info">' + 'Payé' + '</i>';
                        }




                    }
                },

                {
               

                    targets: [5],
                    render: function(data, type,row){
                        //return '<a onClick="PayerFactures('+ data +')" class="btn btn-sm btn-info" ><i class=""> Payer </i>';

                        //return '<button type="button" class="form-control btn-info"  "value="' +data+ '">Payer</button>';
                        return '<button class= "btn-view" type="button" onclick="editClick('+data+')">Payer</button>';

                    }}
              




        ]
    });
    
    function getFactClient() {
        $("#factclient").dataTable().fnDestroy();
        var table = $("#factclient").DataTable({
            "ajax": {
                "type": "POST",
                "url": "/GestionFactures/GetFacturesClients?dopiece=" + $('select#DO_Tiers').find("option:selected").val() + "&&statut=0",
                "type": 'get',
                "datatype": "json"
            },
            "columns": [
    { "data": "DO_Statut" },
                               { "data": "DO_Piece" },
                                { "data": "DO_Ref" },
                               { "data": "MontantFactHT" },
                               { "data": "MontantFactTTC" },
                               { "data": "cbMarq" }


            ]

    ,
            "columnDefs": [

                {
                    targets: [0],
                    render: function (data, type, row) {

                        return '<i class="label bg-warning ">Non payée</i>';

                    }
                },

                        {
                            targets: [4],
                            render: function (data, type, row) {
                                $('#DO_MontantTTC').val(data);
                                return ' <h4 class="font-bold">' + accounting.formatNumber(data, 3, " ") + '</p>';

                            }
                        },
                        {
                            targets: [3],
                            render: function (data, type, row) {
                                return ' <h4 class="font-bold">' + accounting.formatNumber(data, 3, " ") + '</p>';

                            }
                        },
            {
                targets: [5],
                render: function (data, type, row) {
                    $('#cbmDet').val(data);

                    return '<a onClick="PayerFactu(' + data + ')" class="btn btn-sm btn-info payerFacture" ><i class="fa fa-money"> Payer </i>';
                    //'<button class="btn btn-warning btn-sm demo4" value="' + data + '" id="cbClick">Payer</button>'
                    //

                }
            }
            ]


        });






    }


   
    $('#facture tbody').on('click', '.btn-view', function (e) {
        var data = table.row( $(this).parents('tr') ).data();
        var cbmarq = data["cbMarq"];






            swal({
                title: "Payer cette facture?",
                text: " ",
                type: "warning",
                showCancelButton: true,
                cancelButtonText: 'Annuler',
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Oui, payer.",
                closeOnConfirm: false
            }, function () {
                $.ajax({
                    type: "get",
                    url: '/Resiliation/payerFacture2?cbmFacture=' + cbmarq , // we are calling json method
                    dataType: 'json',
                    //    data: { cbmFacture: id, ModeReg: $("#DO_ModeRegl").val() },
                    success: function (msg) {
                        if (msg.msg == 0) {
                            //print reçu
                            //$("#factclient").dataTable().fnDestroy();
                            getFactClient();
                            swal("Payée!", "Facture payée avec succès ! ", "success");
                            swal({
                                title: "Imprimer ",
                                text: "impression du reçu ",
                                type: "success",
                                showCancelButton: true,
                                confirmButtonColor: "#DD6B55",
                                confirmButtonText: "Oui",
                                closeOnConfirm: false,
                                showCancelButton: false,

                            }, function () {
                                //     window.location.href = '/GestionFactures/RecuPaiementFacture/' + data;
                                window.open('/Resiliation/RecuPaiementFacture/' + cbmarq, '_blank');
                                swal("Facture réglée", "reçu téléchargé", "success");
                            });
                        }
                        else {
                            swal({
                                title: "Echec",
                                text: "Un problème est survenu",
                                type: "danger"
                            });
                        }
                    }
                });
            });




       






    } );

    $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
        // var target = $(e.target).attr("href"); // activated tab
        // alert (target);
        $($.fn.dataTable.tables(true)).css('width', '100%');
        $($.fn.dataTable.tables(true)).DataTable().columns.adjust().draw();
    });
    //   Add event listener for opening and closing details
    $('#facture tbody').on('click', 'td.details-control', function () {
        var tr = $(this).closest('tr');
        var row = table.row(tr);

        var data = table.row($(this)).data();

        if (row.child.isShown()) {
            // This row is already open - close it
            row.child.hide();
            tr.removeClass('shown');
        }
        else {
            var virtual_task_id = data["cbMarq"];
            var subtable_id = "subtable-"+virtual_task_id;
            row.child(format(subtable_id)).show(); /* HERE I format the new table */
            tr.addClass('shown');
            sub_DataTable(virtual_task_id, subtable_id); /*HERE I was expecting to load data*/
        }
           
    });        
   
    



}    
    var selectedREF = [] ;
    var selectedQTE = [] ;
    var selectedSERIE = [] ;
    $('#retourner').click(function () {
        $('#Materiel').find('input[type="checkbox"]:checked').each(function () {
            var tr = $(this).closest('tr');
            //var reference= $(this).find('td:eq(1)').html();
            //var qt = $(this).find('td:eq(3)').html();
            //var serie = $(this).find('td:eq(4)').html(); 
            var reference = tr.find('td:eq(1)').html();
            var qt = tr.find('td:eq(3)').html();
            var serie = tr.find('td:eq(4)').html();

            selectedREF.push(reference);
            selectedQTE.push(qt);
            selectedSERIE.push(serie);

        });

        if(selectedREF.length > 1){
            for (var i =0; i < selectedREF.length; i++) {
                
                alert(selectedREF[i]);
                alert(selectedQTE[i]);
                alert(selectedSERIE[i]);
                }
            
            }
       

            //**************************
            $.ajax({
                type: "get",
                url: "/Resiliation/RetournerStock?id=" + @Model.cbMarq + "&&selectedREF=" + selectedREF + "&&selectedQTE=" + selectedQTE + "&&selectedSERIE="+ selectedSERIE,

                @*url: '@Url.Action("RetournerStock")',
                data: {id:@Model.cbMarq, selectedREF: selectedREF, selectedQTE: selectedQTE, selectedSERIE: selectedSERIE },*@
                dataType: 'json',
                success: function (msg) {
                }
            });
       

    });
    $(document).ready(function () {

       
         
       




        $('#Materiel').DataTable({
            "ajax": {

                "url": "/Resiliation/getMateriel?appiece="+ @Model.cbMarq,
                "type": 'get',

                "bInfo": false,
                "bFilter": false,
                "paging": false,
                "ordering": false,
                "info": false,
                "filter": false,
                "datatype": "json"
            },
            "columns": [
                {"data": "cbm"},
                {"data": "reference"},
                {"data": "designation"},
                {"data": "quantite"},
                 {"data": "serie"},
            

            ],
            "columnDefs": [ {
               

                   targets: [0],
                   render: function(data, type,row){
                       return '<input type="checkbox" background: name="name" class="form-control" style="background:white; "value="' +data+ '">';


                   }
              
            } ],


        });

        getFactures();
    });








        //$('#facture').dataTable({
        //    "fnDrawCallback": function(oSettings) {
        //        if ($('#facture tr').length < 11) {
        //            $('.dataTables_paginate').hide();
        //        }
        //    }
        //});



    $( "#generer" ).click(function() {

            var reference = @Model.cbMarq;
      

            //alert(reference);
            swal({
                title: "Générer les factures ?",
                text: " ",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Oui.",
                closeOnConfirm: false
            }, function () {

                //alert(reference);
                $.ajax({
                    type: "get",
                    url: '@Url.Action("GenererFactures")', 
                    dataType: 'json',
                    data: { cbmResiliation: reference},
                    success: function (msg) {
                        if (msg.result == true) {
                            //print reçu 
                            $("#facture").dataTable().fnDestroy();
                            getFactures();
                            swal("Payée!", "Facture payée avec succès ! ", "success");
                            swal({
                                title: "Succés ",
                                text: "Factures générées",
                                type: "success",
                                showCancelButton: true,
                                confirmButtonColor: "#DD6B55",
                                confirmButtonText: "Oui",
                                closeOnConfirm: true,
                                showCancelButton: false,

                            }, function () {

                                //**************************
                                @*$.ajax({
                                    type: "get",
                                    url: '@Url.Action("RecuPaiementFacture")', 
                                    dataType: 'json',
                                    data: { id: data },
                                    success: function (msg) {
                                    }
                                });*@
                                swal("Facture réglée", "reçu téléchargé", "success");
                            });

                        }
                        else {
                            swal({
                                title: "Echec",
                                text: "Un problème est survenu",
                                type: "danger"
                            });
                        }
                    }
                });
                $(this).prop('disabled', true);
            });


        });



</script>