@model BeeProj.Models.B_VERSEMENTEntete

@{
    ViewBag.Title = "Details Versement";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/css/plugins/dataTables/datatables.min.css" rel="stylesheet">
<link href="~/css/bootstrap.min.css" rel="stylesheet">
<link href="~/font-awesome/css/font-awesome.css" rel="stylesheet">
<link href="~/css/animate.css" rel="stylesheet">
<link href="~/css/plugins/dropzone/basic.css" rel="stylesheet">
<link href="~/css/plugins/dropzone/dropzone.css" rel="stylesheet">
<link href="~/css/plugins/jasny/jasny-bootstrap.min.css" rel="stylesheet">
<link href="~/css/plugins/codemirror/codemirror.css" rel="stylesheet">
<link href="~/css/style.css" rel="stylesheet">
<!-- Sweet Alert -->
<link href="~/css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
<style>
    .modal-largess {
        width: 50%; /* Adjust the width as needed */
    }
</style>

<!-- Ladda style -->
<link href="~/css/plugins/ladda/ladda-themeless.min.css" rel="stylesheet">
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <br />
        <ol class="breadcrumb">
            <li>
                <a href=@Url.Action("Index","Home")>Acceuil</a>
            </li>
            <li>
                <a href=@Url.Action("ListeVersement", "GestionFactures")>Liste des versements</a>

            </li>
            <li class="active">
                <strong>Détails Versement</strong>
            </li>
        </ol>
    </div>
    <div class="col-lg-2">

    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
    @if (ViewData.ModelState[""] != null && ViewData.ModelState[""].Errors.Count > 0)
    {
        <div class="alert alert-danger alert-dismissable">
            <button type="button" class="close " data-dismiss="alert"> × </button>
            @Html.ValidationSummary("", new { @class = "text-danger" })

        </div>
    }

    <div class="row">
        <div class="row">
            <div class="col-lg-12">
                <div class="wrapper wrapper-content animated fadeInUp">

                    <div class="ibox">
                        <div class="ibox-title">
                            <h3>Bordereau de versement Ref #@Model.V_Piece </h3>
                            <small class="text-muted">Dernière modification le @Model.CbModification.GetValueOrDefault().ToString("dd/MM/yyyy") , par @Model.CbCreateur .</small>
                            @if (Model.V_Imprim == 0)
                            {
                                <a class="pull-right" title="Imprimer le bordereau de versement " onclick="InfoImprimerBord(@Model.cbMarq)">
                                    <i title="Imprimer le bordereau de versement" class="fa fa-print">  Imprimer le bordereau de versement </i>
                                </a>
                            }
                            else
                            {
                                <a class="pull-right" title="Imprimer le bordereau de versement"
                                   href=@Url.Action("ImprimerBordereauVersement/" + @Model.cbMarq, "GestionFactures") target="_blank">
                                    <i title="Imprimer le bordereau de versement" class="fa fa-print">  Voir votre bordereau de versement </i>
                                </a>


                            }
                            <div class="ibox-tools">
                                <!-- if connected is BEE Agency -->
                                @if (ViewBag.AgenceConnectee == Model.A_CodeRecep
                                    && (Model.V_Statut == 0 && Model.V_Recu == 1)
                                    || (Model.V_TypeBordereau == "AUTRE")
                                    && (User.IsInRole("Controleur de Recette") || User.IsInRole("Admin"))
                                    //
                                    )
                                {

                                    if (Model.V_Recu == 1)
                                    {
                                        <a class="text-info" href="@Model.V_Path" target="_blank" style="color:#23c6c8"> @Model.V_Attachement </a>
                                    }
                                    <button class="btn btn-primary btn-xs" id="validerBord" type="button">Valider </button>
                                    <button class="btn btn-purplebee   btn-xs" title="Encaisser bordereau" data-toggle="modal" data-target="#Encaisserbordereau">
                                        Encaisser
                                    </button>
                                    <button class="btn btn-graybee btn-xs" id="annulerBord" type="button">Annuler </button>


                                }
                                else if ((User.IsInRole("Admin") || User.IsInRole("Controleur de Recette")) && Model.V_Statut == 0)
                                {
                                    <button class="btn btn-primary btn-xs" id="validerBord" type="button">Valider </button>
                                    <button class="btn btn-purplebee   btn-xs" title="Modifier bordereau" data-toggle="modal" data-target="#Encaisserbordereau">
                                        Encaisser
                                    </button>
                                    <button class="btn btn-graybee btn-xs" id="annulerBord" type="button">Annuler </button>
                                }
                                else if ((User.IsInRole("Admin") || User.IsInRole("Controleur de Recette")) && Model.V_Statut == 4)
                                {
                                    <button class="btn btn-primary btn-xs" id="validerBord" type="button">Valider </button>
                                    <button class="btn btn-graybee btn-xs" id="annulerBord" type="button">Annuler </button>
                                }
                                @if (Model.V_Statut == 1)
                                {
                                    <a class="text-warning" href="@Model.V_Path" target="_blank"> @Model.V_Attachement </a>
                                    <code>Bordereau validé</code>
                                }


                            </div>



                            @if (Model.V_Statut == 1 && (User.IsInRole("Admin") || User.IsInRole("Controleur de Recette")))
                            {
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="payment-card">
                                            <i class="fa fa-credit-card-alt payment-icon-big text-success"></i>
                                            <div class="row">
                                                <div class="col-sm-6">
                                                    <small>
                                                        <strong>Type Bordereau: </strong> @Model.V_TypeBordereau
                                                        <br />
                                                        <strong>@Model.V_Description </strong>
                                                        <br />
                                                        @if (Model.V_Recu == 1)
                                                        {
                                                            <strong>Attachement: </strong>
                                                            <a class="text-info" href="@Model.V_Path" target="_blank" style="color:#23c6c8"> @Model.V_Attachement </a>
                                                        }
                                                    </small>

                                                </div>
                                                <div class="col-sm-6 text-right">
                                                    <small>
                                                        <strong>Banque : </strong> @Model.V_BANQUE
                                                        <br />
                                                        <strong>Code Banque : </strong> @Model.V_CodeBank
                                                        <br />
                                                        <strong>Date Opération : </strong> @Model.V_DateValeur.GetValueOrDefault().ToString("dd/MM/yyyy")
                                                        <br />
                                                        <strong>Controleur de Recette :</strong> @Model.CbCreateur
                                                    </small>
                                                </div>
                                            </div>

                                            <a class="btn btn-purplebee  dim" title="Modifier bordereau" data-toggle="modal" data-target="#Modifierbordereau">
                                                <i title="Modifier bordereau " class="fa fa-edit"></i>
                                            </a>
                                        </div>
                                    </div>

                                </div>

                            }
                            <div class="ibox-content">
                                <div class="feed-activity-list">
                                    <div class="feed-element">
                                        <div class="media-body ">
                                            @if (ViewBag.AgenceConnectee != Model.A_CodeRecep && Model.V_Statut == 0 && Model.V_Recu == 0)
                                            {
                                                <div class="well">
                                                    Notez que votre versement ne pourra être valider qu'après avoir attaché le reçu bancaire de votre versement.
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="fileinput fileinput-new input-group" data-provides="fileinput">
                                                            <div class="form-control" data-trigger="fileinput">
                                                                <i class="glyphicon glyphicon-file fileinput-exists"></i>
                                                                <span class="fileinput-filename"></span>
                                                            </div>
                                                            <span class="input-group-addon btn btn-default btn-file">
                                                                <span class="fileinput-new">Choisir </span><span class="fileinput-exists">Changer</span>

                                                                <input type="file" name="..." id="fileinput" accept="image/gif, image/jpeg" />

                                                            </span>
                                                            <a href="#" class="input-group-addon btn btn-default fileinput-exists" data-dismiss="fileinput">Enlever</a>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <button class="btn btn-sm btn-purplebee" id="attacherRecu">Attacher reçu</button>
                                                    </div>
                                                </div>

                                            }
                                            else if (ViewBag.AgenceConnectee != Model.A_CodeRecep && Model.V_Statut == 0 && Model.V_Recu == 1)
                                            {
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <p class="text-danger">Vous pouvez changer l'attachement. <a href="@Model.V_Path" target="_blank"> @Model.V_Attachement </a></p>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="fileinput fileinput-new input-group" data-provides="fileinput">
                                                            <div class="form-control" data-trigger="fileinput">
                                                                <i class="glyphicon glyphicon-file fileinput-exists"></i>
                                                                <span class="fileinput-filename"></span>
                                                            </div>
                                                            <span class="input-group-addon btn btn-default btn-file">
                                                                <span class="fileinput-new">Choisir </span><span class="fileinput-exists">Changer</span>

                                                                <input type="file" name="..." id="fileinput" accept="image/gif, image/jpeg" />

                                                            </span>
                                                            <a href="#" class="input-group-addon btn btn-default fileinput-exists" data-dismiss="fileinput">Enlever</a>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <button class="btn btn-sm btn-purplebee" id="attacherRecu">Attacher reçu</button>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                </div>


                                <div class="project-list">

                                    <table class="table table-hover dataTables-example  table-striped " id="listeBorderaux">
                                        <thead>
                                            <tr>
                                                <th class="project-status">
                                                    Statut
                                                </th>
                                                <th>
                                                    Montant
                                                </th>
                                                <th>N° Reglement </th>
                                                <th> N° Facture</th>
                                                <th>#Rang</th>
                                                <th>Creation Abonnement</th>
                                                <th>Intitulé Client </th>

                                                <th>
                                                    Date de paiement
                                                </th>
                                                <th>
                                                    Date du versement
                                                </th>
                                                @*@if (Request.IsAuthenticated && (User.IsInRole("Admin") || User.IsInRole("Voir Total Commission")))
                                                    {
                                                        <th>
                                                            Montant Commission
                                                        </th>
                                                    }
                                                    @if (Model.V_Imprim == 0 && ViewBag.versementDetails.Count > 1 && Model.V_Statut == 0 && Request.IsAuthenticated && (User.IsInRole("Admin") || User.IsInRole("Supprimer Ligne Versement")))
                                                    {
                                                       <th></th>
                                                    }*@


                                                @if (ViewBag.versementDetails.Count > 1 && Model.V_Statut == 0 && Request.IsAuthenticated && (User.IsInRole("Admin") || User.IsInRole("Supprimer Ligne Versement")))
                                                {
                                                    <th></th>
                                                }
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var item in ViewBag.versementDetails)
                                            {
                                                <tr>
                                                    <td class="project-status">
                                                        @if (Model.V_Statut == 0)
                                                        {
                                                            <span class="label yellow-bg">Versé</span>
                                                        }
                                                        else if (Model.V_Statut == 1 || Model.V_Statut == 3)
                                                        {
                                                            <span class="label lazur-bg">Validé</span>
                                                        }
                                                        else if (Model.V_Statut == 4)
                                                        {
                                                            <span class="label lazur-bg">En cours d'encaissement</span>
                                                        }
                                                        else
                                                        {
                                                            <span class="label label-danger">Non validé</span>
                                                        }
                                                    </td>
                                                    <td>
                                                        @item.RG_Montant
                                                    </td>
                                                    <td>
                                                        @item.RG_Piece


                                                    </td>

                                                    <td>
                                                        @foreach (var item2 in item.NFacture)
                                                        {
                                                            <a title="voir la facture" target="_blank" href="/GestionFactures/DetailsFacture/@item2.cbMarq"> @item2.DO_Piece </a>
                                                            <hr />

                                                        }

                                                    </td>

                                                    <td>
                                                        @foreach (var item3 in item.NFacture)
                                                        {
                                                            @item3.DO_Rang
                                                            <hr />
                                                        }
                                                    </td>
                                                    <td>
                                                        @foreach (var item3 in item.NFacture)
                                                        {
                                                            @item3.dateCreationAbo
                                                            <hr />
                                                        }
                                                    </td>
                                                    <td>
                                                        @item.CT_Intitule
                                                    </td>
                                                    <td>
                                                        @item.DO_Date
                                                    </td>


                                                    <td>
                                                        @item.V_Date
                                                    </td>
                                                    @*@if (Request.IsAuthenticated && (User.IsInRole("Admin") || User.IsInRole("Voir Total Commission")))
                                                        {
                                                            <td>
                                                                @String.Format("{0:N3}", item.MontantCommission) TND
                                                            </td>
                                                        }*@
                                                    @if (ViewBag.versementDetails.Count > 1 && Model.V_Statut == 0 && (Request.IsAuthenticated && (User.IsInRole("Admin") || User.IsInRole("Supprimer Ligne Versement"))))
                                                    {
                                                        <td>
                                                            <button type="button" onclick="SupprimerLaLigne(@item.RG_NO)" class="btn btn-graybee btn-rounded" id="SupprimerLaLigne">
                                                                <i class="fa fa-remove"></i>
                                                            </button>
                                                        </td>
                                                    }
                                                </tr>
                                            }

                                        </tbody>
                                    </table>

                                    <hr />
                                    <p class="pull-right"> Total: <strong>@String.Format("{0:N3}", @Model.V_Montant) TND </strong></p>

                                    @if (User.IsInRole("avance sur commission"))
                                    {<p> Avances: <strong>@String.Format("{0:N3}", @Model.V_NetAvances) TND </strong></p>}


                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal inmodal" id="validerBordereau" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content animated fadeIn">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <i class="fa fa-dollar modal-icon"></i>
                    <h4 class="modal-title">Validation du versement </h4>
                </div>
                <div class="modal-body">
                    @using (Html.BeginForm("ValiderVersement", "GestionFactures", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
                    {
                        @Html.HiddenFor(model => model.cbMarq)
                        <div class="row">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">Banque </label>
                                <div class="col-sm-8">
                                    <select class="form-control" id="V_BANQUE" name="V_BANQUE">
                                        <option>-- Choisir --</option>
                                        @foreach (var item in ViewBag.banques)
                                        {
                                            <option value="@item.BQ_No"> @item.BQ_Abrege</option>
                                        }
                                    </select>
                                </div>

                            </div>

                            <div class="form-group">
                                <label class="col-sm-4 control-label">Code Bancaire </label>
                                <div class="col-sm-8" id="v_banquechange">
                                    <select class="form-control" id="V_CodeBank" name="V_CodeBank">
                                        <option>-- Choisir --</option>
                                        @foreach (var item in ViewBag.journoux)
                                        {
                                            <option value="@item.CG_Num"> @item.CG_Num</option>
                                        }
                                    </select>
                                </div>

                            </div>

                            @*<div class="form-group">
                                    <label class="col-sm-4 control-label">Banque </label>
                                    <div class="col-sm-8"><input class="form-control" type="text" id="V_BANQUE" name="V_BANQUE"></div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-4 control-label">Code Bancaire </label>
                                    <div class="col-sm-8"><input type="text" class="form-control" id="V_CodeBank" name="V_CodeBank"></div>
                                </div>*@

                            <div class="form-group">
                                <label class="col-sm-4 control-label">Date Opération</label>
                                <div class="col-sm-8"><input class="form-control" type="date" id="V_DateValeur" name="V_DateValeur"></div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-4 control-label">Commentaires </label>
                                <div class="col-sm-8">
                                    <textarea class="form-control" id="V_Commentaire" name="V_Commentaire"> </textarea>
                                </div>
                            </div>
                            <div class="m-5 p-5" style="text-align: center">
                                <div id="wait">

                                    <div class="spinner-border text-purplebee" role="status">
                                        <i class="fa fa-spinner fa-spin" style="font-size:50px"></i>
                                        <br />
                                        <h3>Merci de  patienter...</h3>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-white" data-dismiss="modal">Fermer</button>
                            <button type="submit" class="btn btn-purplebee ladda-button" id="ConfirmerVers">Valider </button>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
    <div class="modal inmodal" id="annulerBordereau" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content animated fadeIn">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <i class="fa fa-remove modal-icon"></i>
                    <h4 class="modal-title">Annulation du versement </h4>
                </div>
                <div class="modal-body">
                    @using (Html.BeginForm("AnnulerVersement", "GestionFactures", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
                    {
                        @Html.HiddenFor(model => model.cbMarq)
                        <div class="row">
                            <p>Etes vous sûr de vouloir annuler ce versement ? </p>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">Commentaires </label>
                                <div class="col-sm-10">
                                    <textarea class="form-control" id="V_Commentaire" name="V_Commentaire"> </textarea>
                                </div>

                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-white" data-dismiss="modal">Fermer</button>
                            <button type="submit" class="btn btn-purplebee" id="ConfirmerVers">Oui </button>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
    <div class="modal inmodal" id="DestinataireBordereau" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content animated fadeIn">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <i class="fa fa-bank modal-icon"></i>
                    <h4 class="modal-title">Bordereau de versement</h4>
                </div>
                <div class="modal-body">
                    @*@using (Html.BeginForm("DestinationBordereau", "GestionFactures", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
                        {
                            @Html.HiddenFor(model => model.cbMarq)*@
                    <div class="alert alert-danger">
                        Votre versement est en instance.
                        Merci d'attacher le reçu bancaire de votre versement pour que l'administration puisse valider votre versement.
                    </div>
                    <p>
                        Est ce-que vous voulez générer ce bordereau de versement par <strong> remise à la banque </strong> ou bien par
                        <strong> remise à un responsable régional</strong>
                    </p>



                    <div class="row">
                        <div class="form-group">
                            <div class="col-sm-12">
                                <select class="form-control choix_remiseBord" id="choix_remiseBord">
                                    <option> -- choisir -- </option>
                                    <option value=0> par remise à la banque</option>
                                    <option value=1> par remise au responsable régional</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group hidden" id="Banque">
                            <label class="col-sm-4 control-label">Commentaire </label>
                            <div class="col-sm-8">
                                <textarea class="form-control" id="commentaireBanque"> </textarea>

                            </div>
                        </div>
                        <div class="form-group hidden" id="RespReg">
                            <label class="col-sm-4 control-label">Choisir le responsable régional  </label>
                            <div class="col-sm-8">
                                <select class="form-control" id="RegionalName">
                                    @foreach (var item in ViewBag.ListeResponsables)
                                    {
                                        <option value="@item.UserName"> @item.FirstName @item.LastName</option>
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">Fermer</button>
                        <button type="submit" class="btn btn-purplebee hidden" id="EnvoyerBordereau">Générer Bordereau de Versement </button>
                    </div>
                    @*}*@
                </div>
            </div>
        </div>
    </div>

    @*details bordereau*@
    @*modifier bordereau*@
    <div class="modal inmodal" id="Modifierbordereau" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content animated flipInY">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                    <h4 class="modal-title">Modifier Bordereau</h4>
                </div>
                <div class="modal-body">
                    @using (Html.BeginForm("ModifierBordereau", "GestionFactures", FormMethod.Post, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
                    {
                        @Html.HiddenFor(model => model.cbMarq)
                        <div class="row">
                            @*<div class="form-group ">
                                    <label class="col-sm-2 control-label">Banque</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" id="V_BANQUE" name="V_BANQUE" type="text" value=@Model.V_BANQUE />
                                    </div>
                                </div>
                                <div class="form-group ">
                                    <label class="col-sm-2 control-label">Code Bank</label>
                                    <div class="col-sm-8">
                                        <input class="form-control" id="V_CodeBank" name="V_CodeBank" type="text" value=@Model.V_CodeBank />
                                    </div>
                                </div>*@

                            <div class="form-group">
                                <label class="col-sm-2 control-label">Banque </label>
                                <div class="col-sm-8">
                                    <select class="form-control" id="V_BANQUE" name="V_BANQUE">
                                        <option>-- Choisir --</option>
                                        @foreach (var item in ViewBag.banques)
                                        {
                                            <option value="@item.BQ_No"> @item.BQ_Abrege</option>
                                        }
                                    </select>
                                </div>

                            </div>

                            <div class="form-group">
                                <label class="col-sm-2 control-label">Code Bancaire </label>
                                <div class="col-sm-8" id="v_banquechange">
                                    <select class="form-control" id="V_CodeBank" name="V_CodeBank">
                                        <option>-- Choisir --</option>
                                        @foreach (var item in ViewBag.journoux)
                                        {
                                            <option value="@item.CG_Num"> @item.CG_Num</option>
                                        }
                                    </select>
                                </div>

                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group ">
                                <label class="col-sm-2 control-label">Date</label>
                                <div class="col-sm-8">
                                    <input class="form-control" id="V_DateValeur" name="V_DateValeur" type="date" value=@Model.V_DateValeur />
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary ladda-button " data-style="expand-right">Modifier </button>
                            <button type="button" class="btn btn-graybee" data-dismiss="modal">Fermer</button>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>


    @*New Encaisser*@
    <div class="modal" id="Encaisserbordereau" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-largess">
            <div class="modal-content animated flipInY">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                    <h4 class="modal-title" style="text-align: center;">Encaisser Bordereau</h4>
                </div>
                <div class="modal-body">
                    @using (Html.BeginForm("Encaisserbordereau", "GestionFactures", FormMethod.Post, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
                    {
                        @Html.HiddenFor(model => model.cbMarq)
                        int i = 0;
                        <div class="row" id="Duplicate">
                            <div class="form-group">
                                <label class="col-lg-2 control-label">Banque *</label>
                                <div class="col-lg-4">
                                    <select class="form-control" id="V_BANQUECheque[@(i)]" name="V_BANQUECheque" required>
                                        <option  disabled selected>-- Choisir --</option>
                                        @foreach (var item in ViewBag.banques)
                                        {
                                            <option value="@item.BQ_Abrege"> @item.BQ_Abrege</option>
                                        }
                                    </select>
                                </div>
                                <label class="col-lg-2 control-label">Numéro de chéque  *</label>
                                <div class="col-lg-4">
                                    <input type="text" class="form-control" name="V_NumCheque" id="V_NumCheque[@(i)]" placeholder="N° Chèque,Référence de paiement TPE , N° Compte du client," required />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-2 control-label">Numéro du compte bancaire du client  *</label>
                                <div class="col-lg-4">
                                    <input type="text" class="form-control" name="V_NumCompte" id="V_NumCompte[@i]" placeholder="Nom de la banque,N° Ordre de virement" required />
                                </div>
                                <label class="col-lg-2 control-label">Titulaire Chéque * </label>
                                <div class="col-lg-4">
                                    <input type="text" class="form-control" name="V_TitulaireCheque" id="V_TitulaireCheque[@i]" placeholder="Titulaire du Chèque" maxlength="17" required />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-lg-2 control-label">Date Echéance * </label>
                                <div class="col-lg-4">
                                    <input type="text" pattern="\d{1,2}/\d{1,2}/\d{4}" class="form-control" name="V_DateEchCont" id="V_DateEchCont[@i]" placeholder="Date d'échéance du chèque (format : jj/mm/aaaa)" required />
                                </div>
                                <label class="col-lg-2 control-label">saisir le montant de chéque :<sup> *  </sup></label>
                                <div class="col-lg-4">
                                    <input type="text" pattern="\d*([,\/]?\d+)" class="form-control" id="V_MontantCheque[@i]" name="V_MontantCheque" required>

                                </div>
                            </div>

                            <button type="button" class="btn btn-purplebee ladda-button style=" text-align: center;"" onclick="duplicateItem()" data-style="expand-right">Ajouter  </button>
                            <button class="btn btn-graybee ladda-button style=" text-align: center;"" onclick="removeItem(this)">Supprimer</button>
                            <hr />

                        </div>
                        <div id="container">
                            <!-- Cloned items will be inserted here -->
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary ladda-button " data-style="expand-right">Encaisser </button>
                            <button type="button" class="btn btn-graybee" data-dismiss="modal" id="annuler">Fermer</button>
                        </div>
                        i = i + 1;

                    }


                </div>
                    </div>
        </div>
    </div>
</div>

<!-- Mainly scripts -->
<script src="~/js/jquery-3.1.1.min.js"></script>
<script src="~/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="~/js/plugins/dataTables/datatables.min.js"></script>
<!-- DROPZONE -->
<script src="~/js/plugins/dropzone/dropzone.js"></script>
<script src="~/js/plugins/dataTables/datatables.min.js"></script>
<!-- CodeMirror -->
<script src="~/js/plugins/codemirror/codemirror.js"></script>
<script src="~/js/plugins/codemirror/mode/xml/xml.js"></script>
<script src="~/js/plugins/jasny/jasny-bootstrap.min.js"></script>
<script src="~/js/ChoiceBordereau.js"></script>

<!-- Ladda -->
<script src="~/js/plugins/ladda/spin.min.js"></script>
<script src="~/js/plugins/ladda/ladda.min.js"></script>
<script src="~/js/plugins/ladda/ladda.jquery.min.js"></script>
<!-- Sweet alert -->
<script src="~/js/plugins/sweetalert/sweetalert.min.js"></script>
@*<script>
    var index = 1;

    function duplicateItem() {
        var container = document.getElementById('duplicateContainer');
        var lastItem = container.lastElementChild;
        var newItem = lastItem.cloneNode(true);

        // Mettre à jour les noms des champs avec l'index actuel
        var select = newItem.querySelector('select');
        select.id = 'V_BANQUECheque[' + index + ']';
        select.name = 'V_BANQUECheque';
        var input = newItem.querySelector('input');
        input.name = 'identifiantpay';
        input.id = 'identifiantpay[' + index + ']';
        container.appendChild(newItem);
        index++;
    }
</script>*@
<script>
    //new 
    function duplicateItem() {
        // Find the original item
        var original = document.getElementById('Duplicate');

        // Check if the original item exists
        if (original) {
            // Clone the original item
            var clone = original.cloneNode(true);
            //clone.querySelector('select').setAttribute('id', 'V_BANQUECheque_' + index1);
            //clone.querySelector('select').setAttribute('name', 'V_BANQUECheque[' + index1 + ']');
            //clone.querySelector('input').setAttribute('id', 'identifiantpay_' + index1);
            //clone.querySelector('input').setAttribute('name', 'identifiantpay_' + index1);

            // Find the container where the clone will be inserted
            var container = document.getElementById('container');

            // Check if the container exists
            if (container) {
                // Append the clone to the container
                container.appendChild(clone);
                index++;
            } else {
                console.error("Container not found");
            }
        } else {
            console.error("Original item not found");
        }
       // index1++;
    }

    function removeItem(button) {
        // Find the parent element of the button, which is the item to remove
        var itemToRemove = button.parentNode;

        // Find the parent container of the item
        var container = itemToRemove.parentNode;

        // Remove the item from the container
        container.removeChild(itemToRemove);
    }
    $("#annuler").click(function () {
        $('#Encaisserbordereau').prop('disabled', true);
        location.reload();

    })
$(document).ready(function () {
        $('#listeBorderaux').DataTable({
           "order": [[1, "desc"]],
            responsive: true,
            dom: '<"html5buttons"B>lTfgitp',
            buttons: [
                { extend: 'copy' },
                { extend: 'csv' },
                { extend: 'excel', title: 'ExampleFile' },
                { extend: 'pdf', title: 'ExampleFile' },

                {
                    extend: 'print',
                    customize: function (win) {
                        $(win.document.body).addClass('white-bg');
                        $(win.document.body).css('font-size', '10px');

                        $(win.document.body).find('table')
                                .addClass('compact')
                                .css('font-size', 'inherit');
                    }
                }
            ]

        });
});



    $('#validerBord').click(function () {
        $("#validerBordereau").modal();
    });
    $('#annulerBord').click(function () {
        $("#annulerBordereau").modal();
    });
    $('#attacherRecu').click(function () {
        var fileUpload = $("#fileinput").get(0);
        var files = fileUpload.files;
        // Create FormData object
        var fileData = new FormData();
        // Looping over all files and add it to FormData object
        for (var i = 0; i < files.length; i++) {
            fileData.append(files[i].name, files[i]);
        }
        $.ajax({
            type: "Post",
            url: "/GestionFactures/AttacherRecuBordereau?cbmVEntete="+@Model.cbMarq,
            contentType: false, // Not to set any content header
            processData: false, // Not to process data
            data: fileData,
            success: function (result) {
                location.reload();
             }
        });
    });

    $('#V_BANQUE').on('change', () => {
        console.log("here")
        $.ajax({
            type: "get",
            url:  '@Url.Action("getJourneaux")',
            dataType: 'json',
            data: { BQ_No: $('#V_BANQUE').val() },

                success: function (res) {
                    if (res.result == 0) {
                        var len = res.data.length;
                        $("#V_CodeBank").empty();
                        if (len > 0) {
                            for (var i = 0; i < len; i++) {

                                $("#V_CodeBank").append("<option value='" + res.data[i].JO_Num + "'>" + res.data[i].CG_Num + "</option>");
                                //$("#CT_CodePostal").append("<input type='" + text + "class='" + form - control + "name='" + CT_CodePostal + "id='" + CT_CodePostal + "value='" + msg.cpostal[i] + "'>");
                            }
                        }
                        //swal("Modifié!", "Ligne supprimée avec succès .", "success");
                        //********************
                        //window.location = "/GestionFactures/DetailsVersement/@Model.cbMarq";

                    }
                    else {
                        swal({
                            title: "Erreur ",
                            text: res,
                            type: "danger"
                        });
                    }
                }
            });

    })

function SupprimerLaLigne(RGNO){
        swal({
            title: "Etes-vous sûr ?",
            text: "Enregistrer les modifications ?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Oui",
            closeOnConfirm: false
        }, function () {
            $.ajax({
                type: "get",
                url: '/GestionFactures/SupprimerLigne?id='+RGNO+'&&VersementEntete='+@Model.cbMarq,
                dataType: 'json',
                success: function (res) {
                    if(res == 0 )
                    {
                        swal("Modifié!", "Ligne supprimée avec succès .", "success");
                        //********************
                        window.location = "/GestionFactures/DetailsVersement/@Model.cbMarq";

                    }
                    else {
                        swal({
                            title: "Aucune modification ",
                            text: res,
                            type: "danger"
                        });
                    }
                }
            });
        });
    }
    $(document).ready(function () {
        $(document).ajaxStart(function () {
            $("#wait").css("display", "block");
            $("#annulerCochage").css("display", "none");
        });
        $(document).ajaxComplete(function () {
            $("#wait").css("display", "none");
            $("#annulerCochage").css("display", "inline-block");
        });
        $("button").click(function () {
            $("#txt").load("demo_ajax_load.asp");
        });
    });

</script>