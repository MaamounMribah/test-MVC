@model BeeProj.Models.DemandeMigrationModel
@{
    ViewBag.Title = "ModifierMigration";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .dataTables_filter, .dataTables_info, .dataTables_length, .dataTables_paginate {
        display: none;
    }

    .dataTableMargin .ui-datatable-tablewrapper {
        overflow: hidden;
    }

    .table .table-bordered .table-striped {
        overflow-x: hidden;
        overflow-y: hidden;
    }

    .dataTables_scroll {
        overflow: auto;
    }


    table {
        table-layout: fixed;
        width: 98% !important;
    }
</style>
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-sm-4">
        <h2>Détails Demande</h2>
        <ol class="breadcrumb">

            <li>
                <a>Acceuil </a>
            </li>
            <li>
                <a>Gestion des demande</a>
            </li>

            <li class="active">
                <strong>Modification demande migration </strong>
            </li>
        </ol>
    </div>
</div>

<div class="wrapper wrapper-content animated fadeInRight">
    @if (TempData["MSG"] != null)
    {
        <div class="alert alert-warning alert-dismissable">
            <button type="button" class="close " data-dismiss="alert"> × </button>
            <p class="text-danger">@TempData["MSG"]</p>
        </div>

    }
   
    @using (Html.BeginForm("Modifier", "Migration", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
    {

        @Html.HiddenFor(model => model.cbMarq)
        if (ViewData.ModelState[""] != null && ViewData.ModelState[""].Errors.Count > 0)
        {
            <div class="alert alert-danger alert-dismissable">
                <button type="button" class="close " data-dismiss="alert"> × </button>
                @Html.ValidationSummary("", new { @class = "text-danger" })

            </div>
        }
        <!-- Modal add new   -->
        <div class="modal inmodal" id="ProcessAbonnement" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content animated flipInX">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">Enregistrer les modifications </h4>
                    </div>
                    <div class="modal-body">
                        @*************************************** manel 26/09/2019 pb factureeeeeeee ***********************************@
                        @if (Model.GD_Avancement == 90)
                        {
                            <div class="alert alert-warning">
                                @ViewBag.Message
                                <br />
                                @ViewBag.MsgNonPayes
                                <br />
                                @if (ViewBag.MsgNbreJoursAvoir != null || ViewBag.MsgPlusieursavoir != null)
                                {
                                    @ViewBag.MsgPlusieursavoir
                                    <br />
                                    @ViewBag.MsgNbreJoursAvoir
                                }
                                <br />
                                La derniere facture generee pour l'abonnement à migrer est le n° @ViewBag.DerniereFacture.DO_Piece pour
                                la période du @ViewBag.DerniereFacture.DO_DebutPeriod.ToString("dd/MM/yyyy") au
                                @ViewBag.DerniereFacture.DO_FinPeriod.ToString("dd/MM/yyyy"),
                                @*<a class="alert-link" href="#">voir la facture</a>*@
                                <br />
                                @if (@ViewBag.DerniereFacture.DO_Statut == 1)
                                {
                                    <p class="text-success"> la facture a été payée</p>
                                }
                                else
                                {
                                    <p class="text-danger"> La facture n'a pas été reglée </p>
                                }
                            </div>
                        }
                        else if (Model.GD_Avancement == 50)
                        {
                            <div class="form-group">
                                <label class="col-sm-4 control-label">
                                    Articles réservés pour cet abonnement
                                </label>
                                @foreach (var item in ViewBag.ArtPACK)
                                {
                                    <div class="col-sm-8">
                                        @if (item.AR_Type == 0 && item.LS_NoSerie != null)
                                        {
                                            <strong class="text-success">@item.DL_Design :</strong> <strong> @item.LS_NoSerie </strong>
                                        }
                                    </div>
                                }
                            </div>if (ViewBag.les_lotsserie != null)
                            {
                                <select class="col-md-6 form-control chosen-select " id="Selectionart" name="Selectionart">
                                    @if (ViewBag.les_lotsserie != null)
                                    {
                                        <option class="font-bold text-black-50" selected="selected"> ----Choisir----- </option>
                                        foreach (var item in ViewBag.les_lotsserie)
                                        {
                                            <option class="font-bold text-black-50" value="@item.ls_noserie">@item.ls_noserie </option>

                                        }
                                    }
                                </select>
                            }


                        }
                        @* ******************************************* manel 15/10/2019 ***************************************************@
                        @*@if (Model.GD_Avancement==30) {
                            <div class="form-group">
                                <label class="col-sm-4 control-label">
                                    Articles réservés pour cet abonnement
                                </label>
                                @foreach (var item in ViewBag.ArtPACK)
                                {
                                    <div class="col-sm-8">
                                        @if (item.AR_Type == 0 && item.LS_NoSerie != null)
                                        {
                                            <strong class="text-success">@item.DL_Design :</strong> <strong> @item.LS_NoSerie </strong>
                                        }
                                    </div>
                                }
                            </div>


                             }*@



                        @* ******************************************* manel 15/10/2019 ***************************************************@
                        Voulez-vous vraiment enregistrer les modifications?

                        <div class="form-group">
                            <label class="control-label">Commentaires</label>
                            <div class="">
                                <textarea type="text" id="AC_Commentaire" name="AC_Commentaire" class="form-control col-sm-pull-2"></textarea>
                            </div>
                        </div>


                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                        @if (Model.GD_Avancement < 90)
                        {
                            <button type="button" class="btn btn-purplebee-light" onclick="SaveRemarque(@Model.cbMarq)">Enregistrer</button>
                            <button type="submit" value="submit" class="btn btn-purplebee" onclick="Envoyer(@Model.cbMarq)">Enregistrer et passer à l'étape suivante </button>
                        }
                        else
                        {
                            @*<button type="button" class="btn btn-purplebee-light" onclick="SaveRemarque(@Model.cbMarq)">Enregistrer</button>*@
                            <button type="submit" value="submit" class="btn btn-purplebee" onclick="Envoyer(@Model.cbMarq)">  Valider </button>
                        }

                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col-lg-8">
                <div class="wrapper wrapper-content animated fadeInUp">
                    <div class="ibox">
                        <div class="ibox-content">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="m-b-md">
                                        @*@if (ViewBag.MigRecep == true && Model.GD_Etat == 0)
                                            {    <button type="button" class="btn red-bg pull-right btn-rounded" data-toggle="modal" data-target="#EditOpp">
                                                Sauvgarder <i class="fa fa-save"></i>
                                            </button>
                                            }
                                            else if (ViewBag.MigRep == true && Model.GD_Etat == 1)
                                            {

                                            }*@

                                        @if (User.IsInRole("AvancerMig") || User.IsInRole("Admin"))
                                        {
                                            if (Model.GD_Statut == 0 && (User.IsInRole("Admin") || User.IsInRole("AvancerMig")))
                                            {
                                                <button type="button" class="btn btn-purplebee pull-right" data-toggle="modal" data-target="#TraiterMigration">
                                                    Traiter <i class="fa fa-gears"></i>
                                                </button>


                                            }
                                            else if (Model.GD_Statut == 1 && Model.GD_Avancement < 50 && (User.IsInRole("Admin") || User.IsInRole("AvancerMig")))
                                            {
                                                <button type="button" class="btn bg-purplebee pull-right" onclick="ModalShow()">
                                                    Enregistrer <i class="fa fa-long-arrow-right"></i>
                                                </button>
                                            }
                                            else if (Model.GD_Statut == 1 && Model.GD_Avancement == 50 &&
                                            (User.IsInRole("Reservation mat migration") || User.IsInRole("Admin") || User.IsInRole("AvancerMig")))

                                            {
                                                <button type="button" class="btn bg-purplebee pull-right" onclick="ModalShow()">
                                                    Enregistrer <i class="fa fa-long-arrow-right"></i>
                                                </button>
                                            }
                                            else if (Model.GD_Statut == 1 && Model.GD_Avancement == 80 &&
                                            (User.IsInRole("Admin") || User.IsInRole("AvancerMig")))

                                            {
                                                <button type="button" class="btn bg-purplebee pull-right" onclick="ModalShow()">
                                                    Enregistrer <i class="fa fa-long-arrow-right"></i>
                                                </button>
                                            }
                                            else if (Model.GD_Statut != 3 && Model.GD_Avancement == 100)
                                            {

                                            }
                                            else if (Model.GD_Statut != 3 && Model.GD_Avancement > 50 && User.IsInRole("Admin") || User.IsInRole("AvancerMig"))

                                            {
                                                <button type="button" class="btn bg-purplebee pull-right" onclick="ModalShow()">
                                                    Enregistrer <i class="fa fa-long-arrow-right"></i>
                                                </button>
                                            }
                                        }

                                        @if (User.IsInRole("RejeterDemande") || User.IsInRole("Admin") || User.IsInRole("AvancerMig"))
                                        {
                                            if (Model.GD_Statut != 3 && Model.GD_Avancement < 50)
                                            {
                                                <button type="button" class="btn btn-graybee pull-right btn-outline" data-toggle="modal" data-target="#RejeterDemande">
                                                    <i class="fa fa-remove"></i> Rejeter la demande
                                                </button>

                                            }
                                            else if (Model.GD_Statut != 3 && Model.GD_Avancement >= 50)
                                            {
                                                @*<button type="button" class="btn btn-graybee pull-right btn-outline" data-toggle="modal" data-target="#RejeterDemande" hidden="hidden">
                                                        <i class="fa fa-remove"></i> Rejeter la demande
                                                    </button>*@
                                            }

                                        }
                                        @if (User.IsInRole("RejeterDemande") || User.IsInRole("Admin") || User.IsInRole("AvancerMig"))
                                        {
                                            if (Model.GD_Statut == 3)
                                            {
                                                <button type="button" class="btn btn-graybee pull-right btn-outline" data-toggle="modal" data-target="#AnnulerAnnulationMigration">
                                                    <i class="fa fa-remove"></i> Annuler annulation demande
                                                </button>

                                            }


                                        }


                                        <h3>Référence de la demande: #@Model.GD_Piece</h3>
                                        <small>Demande de migration ajoutée par: @Model.cbCreateur - @Model.GD_Date</small>
                                        <br />
                                        <small> @ViewBag.Agence </small>
                                        <br />
                                        @if (ViewBag.dateval != null)
                                        {
                                            <small>Date Validation Technique: @ViewBag.dateval.ToString("dd/MM/yyyy") </small>
                                        }
                                        else
                                        {
                                            @*<small>Date Validation Technique: @ViewBag.dateval.ToString("dd/MM/yyyy") </small>*@
                                        }

                                        <br /><br />

                                        <span>Statut: </span>
                                        @if (Model.GD_Statut == 1)
                                        {
                                            <span class="label bg-purplebee-light"> En cours </span>

                                        }
                                        else if (Model.GD_Statut == 0)
                                        {
                                            <span class="label style1 bg-purplebee">Nouveau </span>

                                        }

                                        else if (Model.GD_Statut == 3)
                                        {
                                            <span class="label bg-graybee">Annulée </span>

                                        }
                                        else if (Model.GD_Statut == 2)
                                        {
                                            <span class="label bg-greenbee">Validée</span>

                                        }


                                        @*TimeLine*@
                                        <div class="m-b-md">
                                            @if (ViewBag.Abonnement != null)
                                            {
                                                if ((ViewBag.Abonnement.DO_Etape == 7))
                                                {
                                                    <a class="btn bg-primary btn-rounded pull-right" id="genererContrat" href="@Url.Action("VisualiserFacture", "GestionFactures", new { id = @ViewBag.DerniereFactureNouvAbo.cbMarq })" target="_blank" title="Imprimer facture"><i class="fa fa-print "></i> </a>
                                                }

                                                if ((ViewBag.Abonnement.DO_Etape > 4 && ViewBag.Abonnement.DO_Etape != 8))
                                                {
                                                    <a class="btn bg-primary btn-rounded pull-right" id="imprimerContrat" href="@Url.Action("ImprimerContrat", "Abonnement", new { id = @ViewBag.Abonnement.cbMarq })" target="_blank" title="Imprimer Contrat "><i class="fa fa-vcard-o"></i></a>
                                                }

                                            }

                                        </div>
                                    </div>



                                </div>

                            </div>

                            <div class="row">

                                <div class="col-md-6">
                                    <div class="widget gray-bg p-xl">
                                        <ul class="list-unstyled m-t-md">
                                            <li>
                                                <span class="fa fa-shopping-cart m-r-xs"></span>
                                                <label>Ancien Service :</label>
                                                @Model.GD_AncienService :  @ViewBag.Ancien
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="widget lazur-bg p-xl">
                                        <ul class="list-unstyled m-t-md">
                                            <li>
                                                <span class="fa fa-shopping-cart m-r-xs"></span>
                                                <label>Service demandé :</label>
                                                @Model.GD_NouveauService :  @ViewBag.Nouveau
                                            </li>
                                        </ul>

                                    </div>
                                </div>
                            </div>

                            @if (ViewBag.Abonnement != null)
                            {
                                <div class="row">
                                    <div class="form-group col-md-6">
                                        <label class="col-md-5 control-label">Réf Abonnement TT :</label>

                                        <div class="col-md-7"><input type="text" class="form-control" name="DO_RefTelecom" maxlength="17" id="DO_RefTelecom" value="@ViewBag.Abonnement.DO_Ref"></div>
                                    </div>

                                    <div class="form-group col-md-6">
                                        <label class="col-md-4 control-label">Téléphone:</label>

                                        <div class="col-md-8">
                                            <input type="text" class="form-control" disabled name="aboTel" id="aboTel" value="@ViewBag.Abonnement.aboTel" maxlength="8">
                                        </div>

                                    </div>

                                </div>

                                <div class="row">
                                    <div class="progress">
                                        <div style="width:@Model.GD_Avancement%;" class="progress-bar">@Model.GD_Avancement %</div>
                                    </div>
                                </div>
                            }





                            <div class="row m-t-sm">
                                <div class="col-lg-12">
                                    <div class="panel blank-panel">
                                        <div class="panel-heading">
                                            <div class="panel-options">
                                                <ul class="nav nav-tabs">
                                                    <li class="active"><a href="#tab-1" data-toggle="tab">Généralité</a></li>

                                                    <li class=""><a href="#tab-6" data-toggle="tab">Remarques</a></li>
                                                    <li class=""><a href="#tab-4" data-toggle="tab">Documents</a></li>
                                                    <li class=""><a href="#tab-5" data-toggle="tab">Commercial</a></li>
                                                    <li class=""><a href="#tab-Suivi" data-toggle="tab">Suivi</a></li>


                                                </ul>
                                            </div>
                                        </div>




                                        <div class="panel-body">

                                            <div class="tab-content">
                                                <!-- Généralité-->

                                                <div class="tab-pane active " id="tab-1">
                                                    <form method="get" class="form-horizontal">
                                                        <div class="ibox float-e-margins">
                                                            <div class="ibox-content">
                                                                <div class="row">
                                                                    @if (ViewBag.Abonnement != null)
                                                                    {

                                                                        if ((User.IsInRole("Admin") || User.IsInRole("Modifier abonnement fils")) && ViewBag.cbMarqNouvAbo != null)
                                                                        {
                                                                            <h3>
                                                                                Réf Abonnement: #
                                                                                <a title="voir abonnement fils " href="/Abonnement/Modifier/@ViewBag.cbMarqNouvAbo" target="_blank">
                                                                                    @ViewBag.Abonnement.DO_Piece
                                                                                </a>
                                                                            </h3>
                                                                        }
                                                                        else
                                                                        {
                                                                            <h3>Réf Abonnement: #@ViewBag.Abonnement.DO_Piece</h3>

                                                                        }
                                                                    }


                                                                    @if (ViewBag.Abonnement != null)
                                                                    {

                                                                        <div class="row">
                                                                            @*<div class="col-md-6">*@
                                                                            <div class="form-group">
                                                                                <label class="col-sm-2 control-label">Intitulé</label>
                                                                                <div class="col-sm-10">
                                                                                    <span class="help-block m-b-none">
                                                                                        <input class="form-control" disabled="disabled" id="CT_Intitule" name="CT_Intitule" value="@ViewBag.Abonnement.CT_Intitule" />
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                            @*</div>*@

                                                                            @*<div class="col-md-6">*@
                                                                            <div class="form-group">
                                                                                <label class="col-sm-2 control-label">Identifiant </label>
                                                                                <div class="col-sm-10">
                                                                                    <span class="help-block m-b-none">
                                                                                        <input class="form-control" disabled="disabled" id="CT_Identifiant" name="CT_Identifiant" value="@ViewBag.Abonnement.CT_Identifiant" />
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                            @*</div>*@
                                                                        </div>



                                                                        <div class="form-group">
                                                                            <label class="col-sm-2 control-label">Adresse de facturation</label>
                                                                            <div class="col-sm-10">
                                                                                <span class="help-block m-b-none">
                                                                                    <textarea class="form-control" disabled="disabled" id="CT_Adresse" name="CT_Adresse">@ViewBag.Adresses</textarea>
                                                                                </span>
                                                                            </div>
                                                                        </div>


                                                                        <div class="form-group">

                                                                            <label class="col-sm-2 control-label">Contact</label>
                                                                            <div class="col-sm-10">
                                                                                <span class="help-block m-b-none">
                                                                                    <input class="form-control" disabled="disabled" id="CT_Contact" name="CT_Contact" value="@ViewBag.Abonnement.CT_Contact" />
                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="row">
                                                                            <div class="col-md-6">
                                                                                <div class="form-group">
                                                                                    <label class="col-sm-4 control-label">Téléphone client</label>

                                                                                    <div class="col-sm-8">
                                                                                        <span class="help-block m-b-none">
                                                                                            <input class="form-control" disabled="disabled" id="CT_Telephone" name="CT_Telephone" value="@ViewBag.Abonnement.CT_Telephone" />

                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                            <div class="col-md-6">
                                                                                <div class="form-group">
                                                                                    <label class="col-sm-4 control-label">Téléphone de contact</label>

                                                                                    <div class="col-sm-8">
                                                                                        <span class="help-block m-b-none">
                                                                                            <input class="form-control" disabled="disabled" id="CT_GSM" name="CT_GSM" value="@ViewBag.Abonnement.CT_GSM" />
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        <div class="form-group">

                                                                            <label class="col-sm-2 control-label">Adresse  </label>
                                                                            <div class="col-sm-10">
                                                                                <span class="help-block m-b-none">
                                                                                    <textarea class="form-control" disabled="disabled" id="CT_AdresseAbo" name="CT_AdresseAbo" value="@ViewBag.Abonnement.CT_AdresseAbo"> @ViewBag.Abonnement.CT_AdresseAbo</textarea>

                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group">

                                                                            <label class="col-sm-2 control-label">Adresse installation </label>
                                                                            <div class="col-sm-10">
                                                                                <span class="help-block m-b-none">
                                                                                    <textarea class="form-control" disabled="disabled" id="AB_AdresseI" name="AB_AdresseI" value="@ViewBag.Abonnement.AB_AdresseI"></textarea>
                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="row">
                                                                            <div class="col-md-6">
                                                                                <div class="form-group">
                                                                                    <label class="col-sm-4 control-label">Ville</label>

                                                                                    <div class="col-sm-8">
                                                                                        <span class="help-block m-b-none">
                                                                                            <input class="form-control" disabled="disabled" id="CT_Ville" name="CT_Ville" value="@ViewBag.Abonnement.CT_Ville" />

                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-6">

                                                                                <div class="form-group">
                                                                                    <label class="col-sm-4 control-label">Code Postal</label>

                                                                                    <div class="col-sm-8">
                                                                                        <span class="help-block m-b-none">
                                                                                            <input class="form-control" disabled="disabled" id="CT_CodePostal" name="CT_CodePostal" value="@ViewBag.Abonnement.CT_CodePostal" />
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>



                                                                        <div class="row">
                                                                            <div class="col-md-6">

                                                                                <div class="form-group">
                                                                                    <label class="col-sm-4 control-label">Gouvernorat</label>

                                                                                    <div class="col-sm-8">
                                                                                        <span class="help-block m-b-none">
                                                                                            <input Readonly="Readonly" class="form-control" id="CT_Ville" name="CT_Ville" type="text" value=@ViewBag.Abonnement.CT_Ville />
                                                                                        </span>
                                                                                    </div>
                                                                                </div>

                                                                            </div>
                                                                            <div class="col-md-6">

                                                                                <div class="form-group">
                                                                                    <label class="col-sm-4 control-label">code Région</label>

                                                                                    <div class="col-sm-8">
                                                                                        <span class="help-block m-b-none">
                                                                                            <input Readonly="Readonly" class="form-control" id="CT_CodeRegion" name="CT_CodeRegion" type="text" value=@ViewBag.Abonnement.CT_CodeRegion />
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-6">

                                                                                <div class="form-group">
                                                                                    <label class="col-sm-4 control-label">Ancienne Réf</label>

                                                                                    <div class="col-sm-8">
                                                                                        <span class="help-block m-b-none">
                                                                                            <input Readonly="Readonly" class="form-control" id="CT_CodeRegion" name="CT_CodeRegion" type="text" value=@ViewBag.ancienref />
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    }





                                                                </div>
                                                            </div>



                                                            <div class="form-group">
                                                                <label class="col-sm-2 control-label">Description </label>
                                                                <div class="col-sm-10">
                                                                    <span class="help-block m-b-none">
                                                                        @Html.TextAreaFor(model => model.GD_Description, new { @class = "form-control", @Readonly = "Readonly", @id = "GD_Description", name = "GD_Description" })
                                                                    </span>
                                                                </div>
                                                            </div>


                                                        </div>


                                                    </form>
                                                </div>
                                                <!-- FIN Généralité-->
                                                <!-- Remarques -->
                                                <div class="tab-pane" id="tab-6">
                                                    <div class="row">
                                                        @if (ViewBag.ListRemarque.Count == 0)
                                                        {
                                                            <p> <center>Aucune Remarque </center></p>
                                                        }
                                                        else
                                                        {
                                                            <div class="wrapper wrapper-content animated fadeInUp">
                                                                @foreach (var item in ViewBag.ListRemarque)
                                                                {



                                                                    <ul class="notes">
                                                                        <li>
                                                                            @if (@item.RQ_Sujet == "Nouvel Etat")
                                                                            {
                                                                                <div style="background:#ff9393 ">
                                                                                    <small>@item.RQ_Date</small>
                                                                                    <h4>@item.RQ_Sujet</h4>
                                                                                    <p>@item.RQ_Description</p>
                                                                                    <a href="/Demande/DeleteNote/@item.cbMarq"><i class="fa fa-trash-o "></i></a>
                                                                                </div>
                                                                            }
                                                                            else
                                                                            {
                                                                                <div style="background:#ffc ">
                                                                                    <small>@item.RQ_Date</small>
                                                                                    <h4>@item.RQ_Sujet</h4>
                                                                                    <p>@item.RQ_Description</p>
                                                                                    <a href="/Demande/DeleteNote/@item.cbMarq"><i class="fa fa-trash-o "></i></a>
                                                                                </div>
                                                                            }
                                                                        </li>

                                                                    </ul>

                                                                }
                                                            </div>
                                                        }
                                                    </div>
                                                    @********************************************* manel 26/09 ***********************************************************************************@
                                                    <button type="button" class="btn btn-warning btn-rounded  pull-right" data-toggle="modal" data-target="#NouvRemarque">
                                                        <i class="fa fa-pencil"></i>
                                                    </button>
                                                    @********************************************* manel 26/09 ***********************************************************************************@
                                                </div>
                                                <!-- Documents -->
                                                <div id="tab-4" class="tab-pane">
                                                    <div class="panel-body">
                                                        @*<button type="button" class="btn btn-warning btn-rounded  pull-right" data-toggle="modal" data-target="#AddDoc">
                                                                <i class="fa fa-pencil"></i>
                                                            </button>*@

                                                        <div id="tab-4" class="tab-pane">
                                                            <div class="panel-body">

                                                                <div class="table-responsive">
                                                                    @if (ViewBag.ListFiles.Count == 0)
                                                                    {
                                                                        <p> <center>Aucun fichier</center> </p>
                                                                    }
                                                                    else
                                                                    {
                                                                        <table class="table table-bordered table-stripped">
                                                                            <thead>



                                                                                <tr>
                                                                                    <th></th>
                                                                                    <th>
                                                                                        Intitulé Document
                                                                                    </th>


                                                                                    <th> Description </th>
                                                                                    <th>
                                                                                        Ajouté par
                                                                                    </th>
                                                                                    <th>
                                                                                        Date
                                                                                    </th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>


                                                                                @foreach (var item in ViewBag.ListFiles)
                                                                                {
                                                                                    <tr>
                                                                                        <td>

                                                                                            <a href=@item.Path target="_blank"> Voir </a>
                                                                                        </td>
                                                                                        <td>
                                                                                            @item.B_Intitule
                                                                                        </td>
                                                                                        <td>
                                                                                            @item.B_Description

                                                                                        </td>
                                                                                        <td> @item.cbCreateur</td>
                                                                                        <td> @item.cbModification</td>

                                                                                    </tr>
                                                                                }



                                                                            </tbody>
                                                                        </table>
                                                                    }
                                                                </div>



                                                            </div>
                                                        </div>


                                                    </div>

                                                </div>
                                                <!-- Commercial-->

                                                <div class="tab-pane" id="tab-5">
                                                    <div>
                                                        <table class="table table-striped table-hover" id="facture">
                                                            <thead>
                                                                <tr>
                                                                    <th>Statut</th>
                                                                    <th>N° Pièce</th>
                                                                    <th>Date</th>
                                                                    <th>Montant TTC</th>
                                                                    <th>Période</th>
                                                                    <th>Visualiser</th>

                                                                </tr>
                                                            </thead>
                                                            <tbody>


                                                                @foreach (var item in ViewBag.commercial)
                                                                {
                                                                    <tr class="gradeX">


                                                                        @if (@item.DO_Statut == 1)
                                                                        {
                                                                            <td><i class="label bg-info ">Payé</i></td>
                                                                        }
                                                                        else
                                                                        {
                                                                            <td><i class="label bg-warning">Non Payé</i></td>
                                                                        }
                                                                        <td>@item.DO_Piece</td>

                                                                        <td>@item.DO_Date.ToString("dd/MM/yyyy")</td>

                                                                        <td>@item.DO_totalTTC </td>

                                                                        @if (@item.DO_Provenance != 2)
                                                                        {

                                                                            <td>du @item.DO_DebutPeriod.ToString("dd/MM/yyyy")  au @item.DO_FinPeriod.ToString("dd/MM/yyyy")</td>
                                                                        }

                                                                        else
                                                                        {

                                                                            @*<td>@item.DO_Date.ToString("dd/MM/yyyy")</td>*@

                                                                            foreach (var periode in ViewBag.periodeavoir)
                                                                            {
                                                                                <td> @periode.DO_Date.ToString("dd/MM/yyyy")</td>
                                                                            }
                                                                        }
                                                                        <td>
                                                                            @if (@item.DO_Provenance != 2)
                                                                            {
                                                                                <a href="/GestionFactures/VisualiserFacture/@item.cbMarq" target="_blank" class="btn btn-outline btn-greenbee">
                                                                                    <i class="fa fa-eye"> Visualiser </i>
                                                                                </a>
                                                                            }

                                                                            else
                                                                            {
                                                                                <a href="/GestionFactures/VisualiserFactureAvoir/@item.cbMarq" target="_blank" class="btn btn-outline btn-greenbee">
                                                                                    <i class="fa fa-eye"> Visualiser </i>
                                                                                </a>
                                                                            }
                                                                        </td>


                                                                    </tr>
                                                                }


                                                            </tbody>
                                                        </table>
                                                    </div>

                                                </div>
                                                <!--Fin Commercial-->
                                                <div class="tab-pane" id="tab-Suivi">
                                                    <div id="vertical-timeline" class="vertical-container" style="overflow: scroll; width: inherit; height: 500px;">


                                                        @foreach (var item in ViewBag.ListAction)
                                                        {

                                                            <div class="vertical-timeline-block bg-muted">


                                                                <div class="vertical-timeline-icon lazur-bg">
                                                                    <i class="fa fa-dot-circle-o"></i>
                                                                </div>


                                                                <div class="vertical-timeline-content ">
                                                                    <div class="stream-panel">
                                                                        <div class="stream-info">
                                                                            <a href="#">

                                                                                <span>@item.cbCreateur</span>
                                                                                <span class="date">@item.cbModification</span>
                                                                            </a>
                                                                        </div>

                                                                        @item.AC_Commentaire .
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        }

                                                    </div>

                                                </div>
                                            </div>

                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            @if (Model.GD_Avancement == 80)
            {

                <div class="modal inmodal" id="ModifierAboMiseEnservice" tabindex="-1" role="dialog" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content animated flipInX">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Ok</span></button>
                            </div>
                            <div class="modal-body">

                                @*<div class="alert alert-success alert-dismissable hidden" id="alertAppro">
                                        <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
                                        La demande d'appro. à été envoyé avec succès ! une notification vous sera envoyée dès que l'article est disponible dans votre stock.
                                        <br />
                                        Cliquez <a class="alert-link" href="" id="hrefAppro"> ici </a> pour voir la demande d'appro. envoyée.
                                    </div>*@
                                <fieldset id="">
                                    <div class="form-group">
                                        @*<p class="text-info">
                                                                        Cet abonnement sera mis en service TT
                                                                        <small class="text-muted"> Un contrat sera généré à partir les informations entrées.  </small>
                                                                    </p>
                                                                    <hr />
                                                                        <div class="form-group">
                                                                            <h3 class="text-info float-e-margins m-l-lg">  Réservation matériel pour l'abonnement </h3>
                                                                            <label class="col-sm-2 control-label">
                                                                                Articles
                                                                            </label>
                                                                            <div class="col-sm-10">
                                                                                <select data-placeholder="Choisir des articles..."
                                                                                        id="ReservationArticle1" name="ReservationArticle1" class="form-control ">
                                                                                    @if (ViewBag.Materiel1 != null)
                                                                                    {
                                                                                        <option value="@ViewBag.Materiel1.AR_Ref">@ViewBag.Materiel1.AR_Design</option>
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        <option value="null">Aucun</option>
                                                                                    }
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                        @if (ViewBag.LotSerie1 != null)
                                                                        {
                                                                            <div class="form-group">
                                                                                <label class="col-sm-2 control-label">N° de série </label>
                                                                                <div class="col-sm-10" id="selectedLSSERIE">
                                                                                    <select class="form-control chosen-select" id="LotSerie1" name="LotSerie1" data-placeholder="Choisir les références...">


                                                                                        @if (ViewBag.LotSerie1 != null)
                                                                                        {
                                                                                            <option class="font-bold text-purplebee" selected value="@ViewBag.LotSerie1">@ViewBag.LotSerie1</option>

                                                                                        }
                                                                                        else
                                                                                        {

                                                                                        <optgroup label="Dépôt Siège" class="bg-purplebee-light">

                                                                                            @foreach (var item in ViewBag.LotSerie1)
                                                                                            {
                                                                                                <option class="font-bold text-purplebee" value="@item.LS_NoSerie">@item.LS_NoSerie</option>
                                                                                            }
                                                                                        </optgroup>


                                                                                        if (ViewBag.LotSerie1Depot2 != null)
                                                                                        {
                                                                                            <optgroup label="Dépôt Revendeur">
                                                                                                @foreach (var item in ViewBag.LotSerie1Depot2)
                                                                                                {
                                                                                                    <option class="font-bold text-greenbee" value="@item.LS_NoSerie">@item.LS_NoSerie</option>
                                                                                                }
                                                                                            </optgroup>
                                                                                        }
                                                                                        }
                                                                                    </select>
                                                                                </div>
                                                                            </div>
                                                                        }
                                                                        else
                                                                        {
                                                                            if (ViewBag.Materiel2 != null)
                                                                            {
                                                                                <div class="form-group">
                                                                                    <label class="col-md-4 control-label">
                                                                                        <p class="text-danger">  Cet article est en rupture de stock.</p>
                                                                                    </label>
                                                                                    <div class="col-md-6">
                                                                                        <button type="button" class="btn btn-xs btn-success " id="envoiedemandeAppro" onclick="DemandeApproAutomatique();">Envoyer une demande d'approvisonnement </button>
                                                                                    </div>
                                                                                </div>
                                                                            }
                                                                        }
                                                                        <div class="form-group">
                                                                            <label class="col-sm-2 control-label">
                                                                                Articles
                                                                            </label>
                                                                            <div class="col-sm-10">
                                                                                <select data-placeholder="Choisir des articles..."
                                                                                        id="ReservationArticle2" name="ReservationArticle2" class="form-control">
                                                                                    @if (ViewBag.Materiel2 != null)
                                                                                    {
                                                                                        <option value="@ViewBag.Materiel2.AR_Ref">@ViewBag.Materiel2.AR_Design</option>
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        <option value="null">Aucun</option>
                                                                                    }
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                        @if (ViewBag.LotSerie2 != null)
                                                                        {
                                                                            <div class="form-group">
                                                                                <label class="col-sm-2 control-label">N° de série </label>
                                                                                <div class="col-sm-10" id="selectedLSSERIE">
                                                                                    <select class="form-control chosen-select" id="LotSerie2" name="LotSerie2" data-placeholder="Choisir les références...">
                                                                                        @if (ViewBag.LotSerie2 != null)
                                                                                        {
                                                                                            <option class="font-bold text-purplebee" selected value="@ViewBag.LotSerie2">@ViewBag.LotSerie2</option>

                                                                                        }
                                                                                        else
                                                                                        {
                                                                                        <optgroup label="Dépôt Siège">
                                                                                            @foreach (var item in ViewBag.LotSerie2)
                                                                                            {
                                                                                                <option class="font-bold text-purplebee" value="@item.LS_NoSerie">@item.LS_NoSerie</option>
                                                                                            }
                                                                                        </optgroup>
                                                                                        if (ViewBag.LotSerie2Depot2 != null)
                                                                                        {
                                                                                            <optgroup label="Dépôt Revendeur">
                                                                                                @foreach (var item in ViewBag.LotSerie2Depot2)
                                                                                                {
                                                                                                    <option class="font-bold text-greenbee" value="@item.LS_NoSerie">@item.LS_NoSerie</option>
                                                                                                }
                                                                                            </optgroup>

                                                                                        }
                                            }
                                                                                    </select>
                                                                                </div>
                                                                            </div>
                                                                        }
                                                                        else
                                                                        {
                                                                            if (ViewBag.Materiel2 != null)
                                                                            {
                                                                                <div class="form-group">
                                                                                    <label class="col-md-4 control-label">
                                                                                        <p class="text-danger">  Cet article est en rupture de stock.</p>
                                                                                    </label>
                                                                                    <div class="col-md-6">
                                                                                        <button type="button" class="btn btn-xs btn-success " id="envoiedemandeAppro" onclick="DemandeApproAutomatique();">Envoyer une demande d'approvisonnement </button>
                                                                                    </div>
                                                                                </div>
                                                                            }
                                                                        }*@

                                        <hr />

                                        <div class="col-md-12 float-e-margins">

                                            <div class="form-group">
                                                <label class="col-sm-4 control-label">Date Validation Technique de la Migration</label>

                                                <div class="col-sm-6">
                                                    <input class="form-control" name="GD_DateValidation" id="GD_DateValidation" type="date" required />
                                                </div>
                                            </div>


                                            <div class="form-group">
                                                <label class="col-sm-4 control-label">Commentaires</label>

                                                <div class="col-sm-6">
                                                    <textarea class="form-control" name="AC_Notes6" id="AC_Notes6"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                                <button type="submit" class="btn btn-primary ladda-button " data-style="expand-right" @*id="MiseServiceTT"*@> Enregistrer les modifications </button>
                            </div>
                        </div>
                    </div>
                </div>
            }

            <!-- TimeLine-->

            @Html.Action("TimelineMigration", "Migration", new { id = Model.cbMarq })
            @*@if (ViewBag.Abonnement != null)
                {
                    <div class="m-b-md">
                        @if ((ViewBag.Abonnement.DO_Etape >= 3) && (ViewBag.Abonnement.DO_Imprim != 1))
                        {
                            <a class="btn bg-primary btn-xs btn-rounded" id="genererContrat" href="@Url.Action("ImprimerFacture", "Abonnement", new { id = @ViewBag.Abonnement.cbMarq })" target="_blank">Imprimer facture </a>
                        }
                        else
                        {
                            <a class="btn bg-primary btn-xs btn-rounded disabled" id="genererContrat" href="@Url.Action("ImprimerFacture", "Abonnement", new { id = @ViewBag.Abonnement.cbMarq })" target="_blank">Générer facture </a>
                        }

                        @if ((ViewBag.Abonnement.DO_Etape >= 3) && (ViewBag.Abonnement.DO_Imprim != 1))
                        {
                            <a class="btn bg-primary btn-xs btn-rounded" id="imprimerContrat" href="@Url.Action("ImprimerContrat", "Abonnement", new { id = @ViewBag.Abonnement.cbMarq })" target="_blank">Imprimer Contrat </a>
                        }
                        else
                        {
                            <a class="btn bg-primary btn-xs btn-rounded disabled" id="imprimerContrat" href="@Url.Action("ImprimerContrat", "Abonnement", new { id = @ViewBag.Abonnement.cbMarq })" target="_blank">Imprimer Contrat </a>
                        }
                    </div>

                }*@

        </div>
        <!-- Modal add new note -->
        <div class="modal inmodal" id="NouvRemarque" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content animated flipInY">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                        <h4 class="modal-title">Nouvelle Note</h4>
                    </div>
                    <div class="modal-body">
                        <fieldset class="form-horizontal">
                            <div class="form-group">
                                <label class="col-sm-4 control-label">Titre de la Note</label>
                                <div class="col-sm-8"><input type="text" class="form-control" required id="titreRemarque"></div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-4 control-label">Description </label>
                                <div class="col-sm-8">
                                    <textarea type="text" class="form-control" id="descRemarque"></textarea>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">Fermer</button>
                        <button type="button" class="btn btn-warning" onclick="SaveRemarque(@Model.cbMarq)"> Ajouter </button>

                    </div>
                </div>
            </div>
        </div>
        <!-- Modal add new   -->



        <div class="modal inmodal" id="TraiterMigration" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content animated flipInY">


                    @Html.HiddenFor(model => model.cbMarq)

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">Enregistrer les modifications </h4>
                    </div>
                    <div class="modal-body">
                        Voulez vous commencez le traitement de cette demande de migration ?
                        <div class="alert alert-info">
                            NB: Un nouvel abonnement sera crée.
                        </div>
                        <div class="form-group">
                            <label class="control-label">Commentaires</label>
                            <div class="">
                                <textarea type="text" id="Commentaires" name="Commentaires" class="form-control col-sm-pull-2"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                        <button type="submit" class="btn btn-purplebee" id="TraiterMigBtn" onclick="myFunction(@Model.cbMarq)">Enregistrer</button>
                    </div>

                </div>
            </div>
        </div>

        //AnnulerAnnulationMigration
        <div class="modal inmodal" id="AnnulerAnnulationMigration" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content animated flipInX">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">Enregistrer les modifications </h4>
                    </div>
                    @using (Html.BeginForm("AnnulerAnnulationMigration", "Migration", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
                    {

                        @Html.HiddenFor(model => model.cbMarq)
                        <div class="modal-body">
                            Voulez vous vraiment annuler l'annulation de cette demande ?
                            <div class="form-group">
                                <label class="control-label">Raisons</label>
                                <div class="">
                                    <textarea type="text" id="AC_Commentaire" name="AC_Commentaire" class="form-control col-sm-pull-2"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                            <button type="submit" class="btn btn-warning">Enregistrer </button>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Modal add new Demande  -->
        <div class="modal inmodal" id="RejeterDemande" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content animated flipInX">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">Enregistrer les modifications </h4>
                    </div>
                    @using (Html.BeginForm("RejetMigration", "Migration", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
                    {

                        @Html.HiddenFor(model => model.cbMarq)
                        <div class="modal-body">
                            Voulez vous vraiment rejeter cette demande ?
                            <div class="form-group">
                                <label class="control-label">Raisons</label>
                                <div class="">
                                    <textarea type="text" id="AC_Commentaire" name="AC_Commentaire" class="form-control col-sm-pull-2"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                            <button type="submit" class="btn btn-warning">Oui </button>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Modal add new Document   -->
        <div class="modal inmodal" id="AddDoc" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content animated flipInY">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">Attacher Document </h4>
                    </div>
                    <div class="modal-body">
                        <fieldset class="form-horizontal">


                            <div class="form-group">
                                <label class="col-sm-4 control-label">Intitulé  </label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" required id="titreDoc">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-4 control-label">Description  </label>
                                <div class="col-sm-8">
                                    <textarea type="text" class="form-control" required id="DescDoc"></textarea>
                                </div>
                            </div>

                            @*<input type="file" id="FileUpload1" />*@

                            <div class="form-group">
                                <label class="col-sm-4 control-label">Attacher Fichier  </label>
                                <div class="col-sm-8">
                                    <div class="fileinput fileinput-new" data-provides="fileinput">
                                        <span class="btn btn-default btn-file">
                                            <span class="fileinput-new">Selectionner un fichier </span>
                                            <span class="fileinput-exists">Changer</span><input type="file" id="FileUpload1">
                                        </span>
                                        <span class="fileinput-filename"></span>
                                        <a href="#" class="close fileinput-exists" data-dismiss="fileinput" style="float: none">&times;</a>
                                    </div>
                                </div>
                            </div>

                        </fieldset>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">Fermer</button>
                        <button type="button" class="btn btn-warning" onclick="SaveDocuments(@Model.cbMarq)">Ajouter</button>
                    </div>
                </div>
            </div>
        </div>

    }
</div>
<!-- Mainly scripts -->
<script src="~/js/jquery-3.1.1.min.js"></script>
<script src="~/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="~/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<script src="~/js/plugins/dataTables/datatables.min.js"></script>


<script>

    function myFunction(cbMarq) {

        //var comm= document.getElementById("#Commentaires").value();
        // console.log("=Commentaires="+$("#Commentaires").val());
        // console.log("cbmarq="+cbMarq);
 
        $.ajax({
            type: "Post",
            url: "/Migration/TraiterMigration?cbMarq=" + cbMarq + "&&Commentaires=" + $("#Commentaires").val(),
            success: function (result) {
                window.location = "/Migration/Modifier/@Model.cbMarq";
            }
        });
        document.getElementById("TraiterMigBtn").disabled = true;
    }



    function format(table_id) {
        return '<table id="table_id" cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;" class="table  table-hover">' +
          '<thead>'+
    '<th></th>'+
    '<th></th>'+
    '<th></th>'+
    '<th></th>'+

    '</thead>'+
       '</table>';
    }


    function sub_DataTable(vtask_id,table_id) {

        var subtable = $('#table_id').DataTable({
            "ajax": {
                "url": "/Migration/FactureLineJson?id="+vtask_id,
                "type": "get",
                "datatype": "json",
                "scrollX": false,
                "width": "98%"

            },

            "columns": [

                 { "data": "AR_Ref" },
                 { "data": "DL_Design" },
                 { "data": "DL_Qte" },
                { "data": "DL_totalTTC" }



            ]
        });
    }

$(document).ready(function () {



    //////////////////////////////////////////////////////////////////////

        @*var table = $("#facture").DataTable({
            "ajax": {

                "url": "/Migration/FactureJson?id=" + @Model.cbMarq,

                "type": "get",
                "datatype": "json",
                "scrollX": true,
                "scrollCollapse": false


            }*@
            //,
            //"columns": [
            //     {
            //         "className": "details-control",
            //         "orderable":  false,
            //         "data":       "cbMarq",
            //         "defaultContent": ''
            //     },
            //     { "data": "DO_Statut" },
            //     { "data": "DO_Piece" },
            //     { "data": "DO_Date" },
            //    { "data": "DL_totalTTC" }



            //],
            //"columnDefs": [

            //      {
            //          targets: [0],
            //          render: function (data, type, row) {

            //              return '<i class="fa fa-plus-circle"></i>';




            //          }

            //      },

            //     {
            //         targets: [1],
            //         render: function (data, type, row) {
            //             if (data ==1) {
            //                 return '<i class="label bg-info ">' + 'Payé' + '</i>';
            //             }
            //             else if (data == 0) {
            //                 return '<i class="label bg-warning">' + 'Non Payé' + '</i>';
            //             }




            //         }
            //     }


            //]



        //});


        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            // var target = $(e.target).attr("href"); // activated tab
            // alert (target);
            $($.fn.dataTable.tables(true)).css('width', '100%');
            $($.fn.dataTable.tables(true)).DataTable().columns.adjust().draw();
        });




        //   Add event listener for opening and closing details
        $('#facture tbody').on('click', 'td.details-control', function () {
            var tr = $(this).closest('tr');
            var row = table.row(tr);

            var data = table.row($(this)).data();

            if (row.child.isShown()) {
                // This row is already open - close it
                row.child.hide();
                tr.removeClass('shown');
            }
            else {
                var virtual_task_id = data["cbMarq"];
                var subtable_id = "subtable-"+virtual_task_id;
                row.child(format(subtable_id)).show(); /* HERE I format the new table */
                tr.addClass('shown');
                sub_DataTable(virtual_task_id, subtable_id); /*HERE I was expecting to load data*/
            }
        });





        //$('#facture').dataTable({
        //    "fnDrawCallback": function(oSettings) {
        //        if ($('#facture tr').length < 11) {
        //            $('.dataTables_paginate').hide();
        //        }
        //    }
        //});



    });

</script>
<script>
    function SaveDocuments(cbm) {
        /**************/
        var fileUpload = $("#FileUpload1").get(0);
        var files = fileUpload.files;
        // Create FormData object
        var fileData = new FormData();

        // Looping over all files and add it to FormData object
        for (var i = 0; i < files.length; i++) {
            fileData.append(files[i].name, files[i]);
        }

        // Adding one more key to FormData object
        //fileData.append('Bee', 'EasySales');


        $.ajax({
            type: "Post",
            url: "/Demande/SaveDocuments?OpId=" + cbm + "&&titreDoc=" + $("#titreDoc").val() + "&&DescDoc=" + $("#DescDoc").val(),
            contentType: false, // Not to set any content header
            processData: false, // Not to process data
            data: fileData,
            success: function (result) {
                window.location = "/demande/Details/@Model.cbMarq";
            }
        });
    }

    function SaveRemarque(cbm) {

        //alert(cbm);
        //$('#descRemarque').val($('#AC_Commentaire'));
        //$('#descRemarque').val();
        $.ajax({
            type: "get",
            url: "/Migration/SaveNote?OpId=" + cbm + "&&Sujet=" + $("#titreRemarque").val() + "&&Description=" + $("#descRemarque").val(),
            dataType: "json",
            success: function (msg) {

                window.location = "/Migration/Details/@Model.cbMarq";

            }
        });
    }


 function ModalShow(){
    var etape = @ViewBag.DO_Etape;
        if(etape != null){
            switch (etape)
                {
                    case 3: $("#ModifierAboMiseEnservice").modal(); $('.chosen-select', this).chosen('destroy').chosen(); break;
                    default: $("#ProcessAbonnement").modal(); break;
                }
        }
  }



</script>


<script>



    function TransfererMig() {

        $.ajax({
            type: "get",
            url: "/Demande/TransfererMig?cbmarq=" + @Model.cbMarq + "&&GD_Affecte=" + $("#GD_Affecte").val(),
            dataType: "json",
            success: function (msg) {

                window.location = "/Demande/Details/@Model.cbMarq";


            }
        });
    }
    function SaveDemande(cbm) {

        $.ajax({
            type: "get",
            url: "/Demande/SaveDemande?cbmarq="+cb+" &&GD_Etat="+$("#statutEtat").val()


            ,
            dataType: "json",
            success: function (msg) {

                window.location = "/demande/Details/@Model.cbMarq";


            }
        });
    }

    //******************************************************************************************************************* manel  27/09/2019*************************************************************************


    function Envoyer(id) {

        var slect = $('select#Selectionart').find("option:selected").val();
        if(slect!=null)
        {
        var f = {};
        // we are calling json method
        f.url= "/Migration/Envoyer?id=" + id + "&&nouvNumSerie=" + slect,

           f.type = "POST";
        f.dataType = "json";
        f.contentType = "application/json";
        f.success = function (response) {




        };

        $.ajax(f);

    }
    };

</script>

