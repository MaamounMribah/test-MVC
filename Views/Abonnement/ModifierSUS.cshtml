@model BeeProj.Models.ModelAboSUS
@{
    ViewBag.Title = "ModifierSUS";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<link href="~/css/plugins/chosen/bootstrap-chosen.css" rel="stylesheet">

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Liste des abonnements SUS </h2>
        <ol class="breadcrumb">
            <li>
                <a href="#">Acceuil</a>
            </li>
            <li>
                <a href="@Url.Action("ListeAbonnementSUS", "Abonnement")">Gestion des abonnements</a>
            </li>
            <li class="active">
                <strong>Détails abonnement </strong>
            </li>
        </ol>
    </div>

</div>
<div class="wrapper wrapper-content animated fadeInRight">
 
        @Html.HiddenFor(model => model.cbMarq)
    <div class="row">
        @if (ViewData.ModelState[""] != null && ViewData.ModelState[""].Errors.Count > 0)
        {
            <div class="alert alert-danger alert-dismissable">
                <button type="button" class="close " data-dismiss="alert"> × </button>
                @Html.ValidationSummary("", new { @class = "text-danger" })

            </div>
        }
        @if (Model.Resilie == 1)
        {
            <div class="alert alert-danger alert-dismissable">
                <p>L'abonnement a été  résilié. le @Model.DO_FinAbo.GetValueOrDefault().ToString("dd/MM/yyyy")</p>
            </div>
        }

        <div class="col-lg-9">
            <div class="wrapper wrapper-content animated fadeInUp">
                <div class="ibox">

                    <div class="ibox-content">

                        <div class="row">
                            <div class="progress">
                                <div style="width:@Model.A_Pourcent%;" class="progress-bar">@Model.A_Pourcent%</div>
                            </div>

                            <div class="form-group col-xs-5">
                                <label class="col-md-4 control-label">Réf Abonnement TT :</label>

                                <div class="col-md-8"><input type="text" class="form-control" name="DO_Ref" id="DO_Ref" disabled="disabled" value="@Model.DO_Ref"></div>
                            </div>

                            <div class="form-group col-xs-5">
                                <label class="col-md-4 control-label">Téléphone :</label>

                                <div class="col-md-8"><input type="text" class="form-control" name="aboTel" id="aboTel" disabled="disabled" value="@Model.aboTel"></div>
                            </div>

                            @if (Model.DO_Valide == 1)
                            {



                                <div class="form-group col-xs-2">
                                    <h1 class="label label-warning m-lg"><i class="fa fa-shopping-cart"></i> @Model.AR_Ref</h1>

                                </div>

                            }
                        </div>
                    </div>


                </div>


                <div class="ibox">
                    <div class="ibox-content">
                        <div class="row">
                            <div class="m-b-md">


                                @if (Model.DO_Etape == 12)
                                {
                                    <span class="label label-primary pull-right"><strong>Validé</strong> </span><br>
                                }
                                else
                                {
                                    <button type="button" class="btn bg-danger pull-right btn-rounded" id="showmodal">Enregistrer </button>
                                }

                                @if (Model.DO_Valide == 1 && ViewBag.MinFacture != null)
                                {
                                    <a class="btn btn-purplebee  dim" title="Imprimer Votre première Facture " href="@Url.Action("VisualiserFacture","GestionFactures", new { id = @ViewBag.MinFacture })" target="_blank">
                                        <i title="Imprimer Facture " class="fa fa-print"></i>
                                    </a>
                                }
                                @if (Model.Resilie == 1)
                                {
                                    <span class="label label-graybee">Resilié</span>
                                    <span class="label label-greenbee">Motif: @Model.Motif_Annulation</span>
                                    <br />

                                }
                                @if (Model.DO_Valide == 1 && Model.Resilie == 0 && User.IsInRole("Admin") || (User.IsInRole("ResiliationAbonnement")))
                                {
                                    @*<button type="button" title="Résilie la demande d'abonnement" class="btn btn-sm btn-outline btn-danger pull-right  m-l-sm" data-toggle="modal" data-target="#ResilieAbo">
                <i class="fa fa-times-circle "></i>
                Résilier l'abonnement
            </button>*@
                                    <button type="button" class="btn bg-danger pull-right "
                                            title="Résilie la demande d'abonnement" data-toggle="modal" data-target="#ResilieAbo">
                                        Résilier l'abonnement
                                    </button>

                                }
                                @if (Model.Resilie == 1 && (User.IsInRole("Admin")))
                                {
                                    @*<button type="button" title="Annuler la demande d'abonnement" class="btn btn-sm btn-outline
                                                btn-greenbee pull-right  m-l-sm AnnulerResiliation">
                                        <i class="fa fa-trash "></i> Annuler la résiliation
                                    </button>*@
                                    <button type="button" class="btn btn-greenbee pull-right  AnnulerResiliation"
                                            title="Résilie la demande d'abonnement" >
                                        <i class="fa fa-trash "></i> Annuler la résiliation
                                    </button>
                                }
                            </div>





                            <div class="modal inmodal" id="ModifierAbo" tabindex="-1" role="dialog" aria-hidden="true">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content animated flipInX">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Ok</span></button>
                                        </div>
                                        @using (Html.BeginForm("ModifierSUS", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
                                        {
                                            @Html.HiddenFor(model => model.cbMarq)


                                            <div class="modal-body">
                                                <p> Voulez-vous vraiment enregistrer les modifications? </p>
                                                <div class="form-group">
                                                    <label class="control-label">Commentaires</label>
                                                    <div class="">
                                                        <textarea type="text" id="AC_Notes" name="AC_Notes" class="form-control col-sm-pull-2"></textarea>
                                                    </div>
                                                </div>


                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>


                                                <button type="submit" class="btn btn-primary">Enregistrer les modifications </button>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>


                            <div class="modal inmodal" id="AnnulerAbo" tabindex="-1" role="dialog" aria-hidden="true">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content animated flipInX">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Ok</span></button>
                                        </div>





                                        <div class="modal-body">

                                            Voulez-vous vraiment Annuler cet abonnement?
                                            <div class="form-group">
                                                <label class="control-label">Commentaires</label>
                                                <div class="">
                                                    <textarea type="text" id="AC_Notes" name="AC_Notes" class="form-control col-sm-pull-2"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-white" data-dismiss="modal">Non</button>
                                            <button type="submit" class="btn btn-primary">Oui </button>


                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal inmodal" id="ValiderAbo" tabindex="-1" role="dialog" aria-hidden="true">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content animated flipInX">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Ok</span></button>
                                        </div>
                                        <div class="modal-body">

                                            Voulez-vous vraiment Valider cet abonnement?
                                            <div class="form-group">
                                                <label class="control-label">Commentaires</label>
                                                <div class="">
                                                    <textarea type="text" id="AC_Notes" name="AC_Notes" class="form-control col-sm-pull-2"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-white" data-dismiss="modal">Non</button>
                                            <button type="submit" class="btn btn-primary">Oui </button>

                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modal inmodal" id="validerAbonement" tabindex="-1" role="dialog" aria-hidden="true">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content animated flipInX">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Ok</span></button>
                                            <h4 class="modal-title">Validation et paiement </h4>
                                        </div>
                                        <div class="modal-body">
                                            <div class="modal-body">
                                                <fieldset id="SubmitForm" class="float-e-margins">

                                                    <div class="row">
                                                        <p class="text-danger">Confirmation du client .</p>
                                                        <div class="form-group float-e-margins">
                                                            <input id="Valider" name="Valider" value="0" class="hidden" />
                                                            <div class="row">
                                                                <div class="ibox float-e-margins">
                                                                    <div class="ibox-content">
                                                                        <form class="form-horizontal">
                                                                            <div class="form-group">
                                                                                <label class="col-lg-4 control-label">Choisir votre mode de paiement </label>
                                                                                <div class="col-lg-8">
                                                                                    @Html.DropDownListFor(m => m.cbindice, ViewBag.ModeReglementAgence as SelectList, new { @name = "cbindice", @id = "cbindice", @class = "form-control chosen-select" })
                                                                                </div>
                                                                            </div>
                                                                            <div id="ifospayement" style="display:none">
                                                                                <div class="form-group">
                                                                                    <label class="col-lg-4 control-label">Identifiant *</label>
                                                                                    <div class="col-lg-8">
                                                                                        <input type="text" class="form-control" name="identifiantpay" id="identifiantpay" placeholder="N° Chèque,Référence de paiement TPE , N° Compte du client," />
                                                                                    </div>
                                                                                </div>
                                                                                <div class="form-group">
                                                                                    <label class="col-lg-4 control-label">Libellé</label>
                                                                                    <div class="col-lg-8">
                                                                                        <input type="text" class="form-control" name="libelle" id="libelle" placeholder="Nom de la banque,N° Ordre de virement" />
                                                                                    </div>
                                                                                </div>
                                                                                <div class="form-group">
                                                                                    <label class="col-lg-4 control-label">Description</label>
                                                                                    <div class="col-lg-8">
                                                                                        <input type="text" class="form-control" name="description" id="description" placeholder="Titulaire du Chèque" />
                                                                                    </div>
                                                                                </div>
                                                                                <div class="form-group">
                                                                                    <label class="col-lg-4 control-label">Date Echéance </label>
                                                                                    <div class="col-lg-8">
                                                                                        <input type="text" pattern="\d{1,2}/\d{1,2}/\d{4}" class="form-control" name="dateecheance" id="dateecheance" placeholder="Date d'échéance du chèque (format : jj/mm/aaaa)" />
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <hr />
                                                                            <div class="form-group">
                                                                                <label class="col-lg-4 control-label">Attachement scan contrat</label>
                                                                                <div class="col-lg-8">
                                                                                    <div class="fileinput fileinput-new input-group" data-provides="fileinput">
                                                                                        <div class="form-control" data-trigger="fileinput">
                                                                                            <i class="glyphicon glyphicon-file fileinput-exists"></i>
                                                                                            <span class="fileinput-filename"></span>
                                                                                        </div>
                                                                                        <span class="input-group-addon btn btn-default btn-file">
                                                                                            <span class="fileinput-new">Selectionner</span>
                                                                                            <span class="fileinput-exists">Changer</span>
                                                                                            <input type="file" name="FileContact" id="FileContact" accept="image/png, image/jpeg" required />
                                                                                        </span>
                                                                                        <a href="#" class="input-group-addon btn btn-default fileinput-exists" data-dismiss="fileinput">Supprimer</a>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="form-group">
                                                                                <label class="col-lg-4 control-label">Commentaires</label>
                                                                                <div class="col-lg-8">
                                                                                    <textarea type="text" id="AC_Notes5" name="AC_Notes5" class="form-control col-sm-pull-2"></textarea>
                                                                                </div>
                                                                            </div>
                                                                        </form>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="reset" class="btn btn-white" data-dismiss="modal">Annuler</button>
                                                                <button type="submit" class="btn btn-primary"><i class="fa fa-money"></i>Valider et payer </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </fieldset>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">

                            <div class="col-lg-5">

                                <dl class="dl-horizontal">

                                    <dt>Ajouté par : </dt>
                                    <dd>@Model.cbCreateur</dd>
                                </dl>
                                <dl class="dl-horizontal">

                                    <dt>Date de création </dt>
                                    <dd>@Model.DO_Date</dd>
                                </dl>
                            </div>
                            <div class="col-lg-7" id="cluster_info">
                                <dl class="dl-horizontal">
                                    <dt>Agence </dt>
                                    <dd> <a href=# class="text-navy font-bold">@Model.A_Code</a>  </dd>

                                    @if (Model.DO_Valide == 1)
                                    {
                                        <dt>Articles  </dt>
                                        foreach (var item in ViewBag.ArticlesAttribues)
                                        {
                                            <dd> <i class="fa fa-shopping-cart"></i> @item.AR_Ref </dd>
                                        }
                                    }
                                    <dt>Solde abonnement </dt>
                                    <dd>
                                        @if (@ViewBag.Soldeabonn != null)
                                        {
                                            @String.Format("{0:N3}", @ViewBag.Soldeabonn)
                                        }
                                        else
                                        {
                                            @String.Format("{0:N3}", 0)
                                        }
                                    </dd>
                                </dl>
                            </div>
                        </div>
                        <div class="row m-t-sm">
                            <div class="col-lg-12">
                                <div class="panel blank-panel">
                                    <div class="panel-heading">
                                        <div class="panel-options">
                                            <ul class="nav nav-tabs">
                                                <li class="active"><a href="#tab-1" data-toggle="tab">Généralité</a></li>

                                                <li class=""><a href="#tab-4" data-toggle="tab">Documents</a></li>
                                                <li class=""><a href="#tab-5" data-toggle="tab">Commercial</a></li>
                                                <li class=""><a href="#ArticlesEnSUS" data-toggle="tab">Articles en SUS</a></li>
                                                <li class=""><a href="#tab-remarque" data-toggle="tab">Remarques</a></li>

                                                <li class=""><a href="#tab-Suivi" data-toggle="tab">Suivi</a></li>


                                            </ul>
                                        </div>
                                    </div>

                                    <div class="panel-body">

                                        <div class="tab-content">
                                            <!-- Généralité-->

                                            <div class="tab-pane active " id="tab-1">
                                                <form method="get" class="form-horizontal">
                                                    <div class="row">

                                                        <div class="ibox float-e-margins">
                                                            <div class="ibox-title">
                                                                <div class="ibox-tools">
                                                                    <a class="collapse-link">
                                                                        <i class="fa fa-chevron-up text-navy"></i>
                                                                    </a>


                                                                </div>
                                                            </div>

                                                            <div class="ibox-content">
                                                                <div class="row">
                                                                    <h3>Réf Abonnement: #@Model.DO_Piece</h3>

                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="col-sm-2 control-label">Intitulé</label>
                                                                                <div class="col-sm-10">
                                                                                    <span class="help-block m-b-none">
                                                                                        @Html.TextBoxFor(model => model.CT_Intitule, new { @class = "form-control", @Readonly = "Readonly", @id = "CT_Intitule", @name = "CT_Intitule" })
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="col-sm-2 control-label">Identifiant </label>
                                                                                <div class="col-sm-10">
                                                                                    <span class="help-block m-b-none">
                                                                                        @Html.TextBoxFor(model => model.CT_Identifiant, new { @class = "form-control", @Readonly = "Readonly", @id = "CT_Identifiant", @name = "CT_Identifiant" })
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <br />


                                                                    <div class="form-group">

                                                                        <label class="col-sm-2 control-label">Adresse de facturation</label>
                                                                        <div class="col-sm-10">
                                                                            <span class="help-block m-b-none">
                                                                                @Html.TextAreaFor(model => model.CT_Adresse, new { @class = "form-control", @Readonly = "Readonly", @name = "CT_Adresse", @id = "CT_Adresse" })


                                                                            </span>
                                                                        </div>
                                                                    </div>


                                                                    <div class="form-group">

                                                                        <label class="col-sm-2 control-label">Contact</label>
                                                                        <div class="col-sm-10">
                                                                            <span class="help-block m-b-none">
                                                                                @Html.TextAreaFor(model => model.CT_Contact, new { @class = "form-control", @Readonly = "Readonly", @name = "CT_Contact", @id = "CT_Contact" })


                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="col-sm-4 control-label">Téléphone client</label>

                                                                                <div class="col-sm-8">
                                                                                    <span class="help-block m-b-none">
                                                                                        <input Readonly="Readonly" class="form-control" id="CT_Telephone" name="CT_Telephone" type="text" value=@Model.CT_Telephone />
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="col-sm-4 control-label">Téléphone de contact</label>

                                                                                <div class="col-sm-8">
                                                                                    <span class="help-block m-b-none">
                                                                                        <input Readonly="Readonly" class="form-control" id="CT_GSM" name="CT_GSM" type="text" value=@Model.CT_GSM />
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-group">

                                                                        <label class="col-sm-2 control-label">Adresse installation </label>
                                                                        <div class="col-sm-10">
                                                                            <span class="help-block m-b-none">
                                                                                @Html.TextAreaFor(model => model.CT_AdresseAbo, new { @class = "form-control", @Readonly = "Readonly", @name = "CT_AdresseAbo", @id = "CT_AdresseAbo" })


                                                                            </span>
                                                                        </div>
                                                                    </div>

                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="col-sm-4 control-label">Ville</label>

                                                                                <div class="col-sm-8">
                                                                                    <span class="help-block m-b-none">
                                                                                        @Html.TextBoxFor(model => model.CT_Ville, new { @class = "form-control", @Readonly = "Readonly", @id = "CT_Ville", @name = "CT_Ville" })
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6">

                                                                            <div class="form-group">
                                                                                <label class="col-sm-4 control-label">Code Postal</label>

                                                                                <div class="col-sm-8">
                                                                                    <span class="help-block m-b-none">
                                                                                        @Html.TextBoxFor(model => model.CT_CodePostal, new { @class = "form-control", @Readonly = "Readonly", @name = "CT_CodePostal", @id = "CT_CodePostal" })




                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>



                                                                    <div class="row">
                                                                        <div class="col-md-6">

                                                                            <div class="form-group">
                                                                                <label class="col-sm-4 control-label">Gouvernorat</label>

                                                                                <div class="col-sm-8">
                                                                                    <span class="help-block m-b-none">
                                                                                        <input Readonly="Readonly" class="form-control" id="CT_Ville" name="CT_Ville" type="text" value=@Model.CT_Ville />
                                                                                    </span>
                                                                                </div>
                                                                            </div>

                                                                        </div>
                                                                        <div class="col-md-6">

                                                                            <div class="form-group">
                                                                                <label class="col-sm-4 control-label">code Région</label>

                                                                                <div class="col-sm-8">
                                                                                    <span class="help-block m-b-none">
                                                                                        <input Readonly="Readonly" class="form-control" id="CT_CodeRegion" name="CT_CodeRegion" type="text" value=@Model.CT_CodeRegion />
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>






                                                                </div>
                                                            </div>
                                                        </div>






                                                    </div>
                                                </form>

                                            </div>
                                            <!-- Documents -->
                                            <div id="tab-4" class="tab-pane">
                                                <div class="panel-body">
                                                    <button type="button" class="btn btn-warning btn-rounded  pull-right" data-toggle="modal" data-target="#AddDoc">
                                                        <i class="fa fa-pencil"></i>
                                                    </button>

                                                    <div id="tab-4" class="tab-pane">
                                                        <div class="panel-body">

                                                            <div class="table-responsive">
                                                                @if (ViewBag.ListFiles.Count == 0)
                                                                {
                                                                    <p> Aucun fichier </p>
                                                                }
                                                                else
                                                                {
                                                                    <table class="table table-bordered table-stripped">
                                                                        <thead>



                                                                            <tr>
                                                                                <th></th>
                                                                                <th>
                                                                                    Intitulé Document
                                                                                </th>


                                                                                <th> Description </th>

                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>

                                                                            @if (ViewBag.ListFiles.Count == 0)
                                                                            {
                                                                                <h3>Aucun attachement. </h3>

                                                                            }
                                                                            else
                                                                            {
                                                                                foreach (var item in ViewBag.ListFiles)
                                                                                {
                                                                                    <tr>
                                                                                        <td>

                                                                                            <a href=@item.Path target="_blank"> @item.Path </a>
                                                                                        </td>
                                                                                        <td>
                                                                                            @item.B_Intitule
                                                                                        </td>
                                                                                        <td>
                                                                                            @item.B_Description

                                                                                        </td>

                                                                                    </tr>
                                                                                }
                                                                            }



                                                                        </tbody>
                                                                    </table>
                                                                }
                                                            </div>


                                                        </div>
                                                    </div>


                                                </div>

                                            </div>

                                            <!-- Commercial-->

                                            <div class="tab-pane" id="tab-5">

                                                @if (ViewBag.listeFactures == null)
                                                {
                                                    <p>Aucune Facture </p>

                                                }
                                                else
                                                {
                                                    <table class="table table-striped">
                                                        <thead>
                                                            <tr>
                                                                <th>Type Document</th>
                                                                <th>N° Pièce</th>
                                                                <th>Date </th>
                                                                <th>Référence</th>
                                                                <th>Montant HT</th>
                                                            </tr>
                                                        </thead>

                                                        <tbody>


                                                            @foreach (var item in ViewBag.listeFactures)
                                                            {
                                                                <tr>
                                                                    <td>
                                                                        @*('0: En Cours,1: Réglé; 2: Versé; 3: Validé')*@
                                                                        @if (item.DO_Statut == 0)
                                                                        {
                                                                            <span class="label label-default"><i class="fa fa-check"></i> En Cours</span>
                                                                        }
                                                                        else if (item.DO_Statut == 1)
                                                                        {
                                                                            <span class="label label-success"><i class="fa fa-check"></i> Payée</span>

                                                                        }
                                                                        else if (item.DO_Statut == 2)
                                                                        {
                                                                            <span class="label label-info"><i class="fa fa-check"></i> Versée</span>
                                                                        }
                                                                        else
                                                                        {
                                                                            <span class="label label-danger"><i class="fa fa-check"></i> Validée</span>
                                                                        }

                                                                    </td>
                                                                    <td>
                                                                        @item.DO_Piece
                                                                    </td>
                                                                    <td>
                                                                        @item.DO_Date
                                                                    </td>
                                                                    <td>@item.DO_Ref</td>
                                                                    <td>
                                                                        @item.DO_totalTTC
                                                                    </td>

                                                                </tr>

                                                            }



                                                        </tbody>
                                                    </table>
                                                }
                                            </div>

                                            <div class="tab-pane" id="ArticlesEnSUS">
                                                Aucun article
                                                <table class="table table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>Référence Article</th>
                                                            <th>Designation</th>
                                                            <th>Référence TT </th>
                                                            <th>Montant TTC</th>

                                                        </tr>
                                                    </thead>

                                                    <tbody>

                                                        @foreach (var item in ViewBag.ArticlesSus)
                                                        {
                                                            <tr>
                                                                <td>
                                                                    <span class="label label-warning"><i class="fa fa-check"></i> @item.AR_Ref</span>
                                                                </td>
                                                                <td>
                                                                    @item.DL_Design
                                                                </td>
                                                                <td>
                                                                    @item.DO_Ref
                                                                </td>
                                                                <td>
                                                                    @item.DL_MontantTTC
                                                                </td>

                                                            </tr>

                                                        }
                                                    </tbody>
                                                </table>

                                            </div>



                                            <div class="tab-pane" id="tab-Suivi">
                                                <div class="row" style="overflow:scroll;height:500px;">
                                                    <div class="ibox ">

                                                        <div class="ibox-content">

                                                            <div class="activity-stream full-height-scroll">
                                                                <table class="table table-striped">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>Statut</th>
                                                                            <th>Détails</th>
                                                                            <th>Date </th>
                                                                            <th>Utilisateur</th>

                                                                            <th>Notes</th>
                                                                        </tr>
                                                                    </thead>

                                                                    <tbody>

                                                                        @foreach (var item in ViewBag.ListAction)
                                                                        {
                                                                            <tr>
                                                                                <td>
                                                                                    @if (item.AC_Etat == 0)
                                                                                    {
                                                                                        <span class="label label-warning-light"><i class="fa fa-history"></i></span>


                                                                                    }
                                                                                    else if (item.AC_Etat == 1)
                                                                                    {

                                                                                        <span class="label label-primary"><i class="fa fa-history"></i></span>

                                                                                    }
                                                                                    else if (item.AC_Etat == 2)
                                                                                    {
                                                                                        <span class="label label-warning"><i class="fa fa-history"></i></span>


                                                                                    }
                                                                                    else if (item.AC_Etat == 3)
                                                                                    {
                                                                                        <span class="label label-success"><i class="fa fa-history"></i></span>


                                                                                    }
                                                                                    else if (item.AC_Etat == 4)
                                                                                    {
                                                                                        <span class="label label-danger"><i class="fa fa-history"></i></span>


                                                                                    }
                                                                                    else if (item.AC_Etat == 5)
                                                                                    {
                                                                                        <span class="label label-danger"><i class="fa fa-history"></i></span>


                                                                                    }
                                                                                    else
                                                                                    {

                                                                                        <span class="label label-primary"><i class="fa fa-warning"></i></span>

                                                                                    }
                                                                                </td>

                                                                                <td>@item.AC_Commentaire </td>
                                                                                <td>@item.cbModification</td>
                                                                                <td>@item.cbCreateur</td>

                                                                                <td>
                                                                                    @item.AC_Notes
                                                                                </td>

                                                                            </tr>

                                                                        }
                                                                    </tbody>
                                                                </table>

                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>



                                            </div>





                                            <!-- Remarques -->

                                            <div class="tab-pane" id="tab-remarque">
                                                <div class="row">
                                                    @if (ViewBag.ListRemarque.Count == 0)
                                                    {
                                                        <p> Aucune Remarque </p>
                                                    }
                                                    else
                                                    {
                                                        <div class="wrapper wrapper-content animated fadeInUp">
                                                            @foreach (var item in ViewBag.ListRemarque)
                                                            {



                                                                <ul class="notes">
                                                                    <li>
                                                                        @if (@item.RQ_Sujet == "Nouvel Etat")
                                                                        {
                                                                            <div style="background:#ff9393 ">
                                                                                <small>@item.RQ_Date</small>
                                                                                <h4>@item.RQ_Sujet</h4>
                                                                                <p>@item.RQ_Description</p>
                                                                                @*<a href="#"><i class="fa fa-trash-o "></i></a>*@
                                                                            </div>
                                                                        }
                                                                        else
                                                                        {
                                                                            <div style="background:#ffc ">
                                                                                <small>@item.RQ_Date</small>
                                                                                <h4>@item.RQ_Sujet</h4>
                                                                                <p>@item.RQ_Description</p>
                                                                                @*<a href="#"><i class="fa fa-trash-o "></i></a>*@
                                                                            </div>
                                                                        }
                                                                    </li>

                                                                </ul>

                                                            }
                                                        </div>
                                                    }
                                                </div>
                                                <button type="button" class="btn btn-warning btn-rounded  pull-right" data-toggle="modal" data-target="#NouvRemarque">
                                                    <i class="fa fa-pencil"></i>
                                                </button>
                                            </div>
                                        </div>

                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-3">

            <div class="ibox">


                <div class="ibox-content">

                    @*<div id="using_json"></div>*@

                    <!-- ETATAPE_OP ET_DESCRIPION cbmarq-->

                    <div id="vertical-timeline" class="vertical-container">



                        <div class="vertical-timeline-block ">



                            @if (Model.DO_Etape == 10)
                            {

                                <div class="vertical-timeline-icon label-danger">
                                    <i class="fa fa-level-down" data-toggle="modal" data-target="#detailsEtape"></i>
                                </div>
                            }
                            else
                            {

                                <div class="vertical-timeline-icon label-primary">
                                    <i class="fa fa-level-down"></i>
                                </div>
                            }
                            <div class="vertical-timeline-content ">
                                <h2>Nouveau</h2>
                            </div>
                        </div>




                        <div class="vertical-timeline-block  ">

                            @if (Model.DO_Etape == 11)
                            {

                                <div class="vertical-timeline-icon label-danger">
                                    <i class="fa fa-level-down"></i>
                                </div>
                            }
                            else
                            {

                                <div class="vertical-timeline-icon label-primary">
                                    <i class="fa fa-level-down"></i>
                                </div>
                            }

                            <div class="vertical-timeline-content ">
                                <h2>En Cours </h2>
                            </div>
                        </div>



                        <div class="vertical-timeline-block  ">
                            @if (Model.DO_Etape == 12)
                            {

                                <div class="vertical-timeline-icon label-danger">
                                    <i class="fa fa-level-down"></i>
                                </div>
                            }
                            else
                            {

                                <div class="vertical-timeline-icon label-primary">
                                    <i class="fa fa-level-down"></i>
                                </div>
                            }
                            <div class="vertical-timeline-content ">
                                <h2>Clôturé</h2>
                            </div>
                        </div>
                    </div>
                </div>


            </div>

        </div>


    </div>
</div>
<div class="modal inmodal" id="ResilieAbo" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated fadeIn">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Choisir motif de résiliation</h4>
            </div>
            @using (Html.BeginForm("ResilieAbonnement", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
            {
                <div class="modal-body">
                    @Html.HiddenFor(model => model.cbMarq)
                    <div class="form-group">
                        <label class="control-label">Motif</label>
                        <div class="">
                            <select class="col-md-6 form-control chosen-select Motif_Annulation" id="Motif_Annulation" name="Motif_Annulation">
                                <option class="font-bold" value="Aucun motif"> Aucun motif </option>
                                @if (ViewBag.MotifResiliation != null)
                                {
                                    foreach (var item in ViewBag.MotifResiliation)
                                    {
                                        <option class="font-bold" value="@item.Motif"> @item.Motif </option>
                                    }
                                }
                            </select>

                        </div>
                    </div>



                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Non</button>
                    <button type="submit" class="btn btn-purplebee ladda-button">Oui </button>
                </div>
            }
        </div>
    </div>
</div>
<!-- Modal add new note -->

<div class="modal inmodal" id="NouvRemarque" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                <h4 class="modal-title">Nouvelle Note</h4>
            </div>
            <div class="modal-body">
                <fieldset class="form-horizontal">

                    <div class="form-group">
                        <label class="col-sm-4 control-label">Titre de la Note</label>
                        <div class="col-sm-8"><input type="text" class="form-control" required id="titreRemarque"></div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Description </label>
                        <div class="col-sm-8">

                            <textarea type="text" class="form-control" id="descRemarque"></textarea>
                        </div>
                    </div>

                </fieldset>
            </div>e
            <div class="modal-footer">
                <button type="button" class="btn btn-white" data-dismiss="modal">Fermer</button>
                <button type="button" class="btn btn-warning" onclick="SaveRemarque(@Model.cbMarq)">Ajouter</button>
            </div>
        </div>
    </div>
</div>
<script src="~/js/jquery-3.1.1.min.js"></script>
<!-- Chosen -->
<script src="~/js/plugins/chosen/chosen.jquery.js"></script>
<script>

    $(document).ready(function () {
        $("#validerAb").addClass('hidden');
        if(@Model.DO_Etape == 12){
            $("#validerAb").removeClass('hidden');
        }
    //document.getElementById("DO_Etape").selectedIndex = ;
        var doetapee =@Model.DO_Etape;

        $('#DO_Etape').val(doetapee)
        $('#DO_Etape').trigger("chosen:updated");
        if($("#DO_Ref").val().length != 0){
            $("#DO_Ref").attr('disabled', true);
        }
        if($("#aboTel").val().length != 0){
            $("#aboTel").attr('disabled', true);
        }
        $('.chosen-select').chosen({width: "100%"});
    });
    $('#validerAb').click(function () {
        $('#Valider').val(1);
        $("#validerAbonement").modal();
    });
    $("#showmodal").click(function () {
        var etape =  @Model.DO_Etape;
        switch(etape){
            case 10: $("#ModifierAbo").modal();break;
            case 11: $("#ModifierAbo").modal();break;
            case 12: $("#ModifierAbo").modal();break;
        }
    });
    function SaveRemarque(cbm) {
    $.ajax({
        type: "get",
        url: "/Abonnement/SaveNote?OpId=" + cbm + "&&Sujet=" + $("#titreRemarque").val() + "&&Description=" + $("#descRemarque").val(),
        dataType: "json",
        success: function (msg) {
            window.location = "/Abonnement/Details/@Model.cbMarq";
        }
    });
}

     $('.AnnulerResiliation').click(function () {
        swal({
            title: "Êtes vous sûr ?",
            text: "Cet abonnement sera Valider.",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Oui, Valider",
            closeOnConfirm: false
        }, function () {
            $.ajax({
                type: "get",
                url: "/Abonnement/AnnulerResiliation?cbMarq=@Model.cbMarq",
                dataType: "json",
                success: function (msg) {
                    if(msg=="1")
                    {
                        swal("Abonnement validé!", "Abonnement terminé.", "success");
                        location.reload();
                    }else
                    {

                        swal("Abonnement n'est pas validé!", "une erreur c produit , Abonnement reste résilié/Annuler. :)", "error");
                        location.reload();
                    }


                }
            });
        });
    });



</script>




