@model BeeProj.Models.EngagementModel

@{
    ViewBag.Title = "Modifier abonnement";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!-- Toastr style -->
<link href="~/css/plugins/toastr/toastr.min.css" rel="stylesheet">
<link href="~/css/plugins/datapicker/datepicker3.css" rel="stylesheet" />
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<link href="~/css/plugins/chosen/bootstrap-chosen.css" rel="stylesheet">
<link href="~/css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">
<link href="~/css/plugins/iCheck/custom.css" rel="stylesheet">
<!-- Sweet Alert -->
<link href="~/css/plugins/sweetalert/sweetalert.css" rel="stylesheet">
<!-- Ladda style -->
<link href="~/css/plugins/ladda/ladda-themeless.min.css" rel="stylesheet">
<link href="~/css/plugins/touchspin/jquery.bootstrap-touchspin.min.css" rel="stylesheet">
<link href="~/css/plugins/jasny/jasny-bootstrap.min.css" rel="stylesheet">
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Liste des abonnements</h2>
        <ol class="breadcrumb">
            <li>
                <a href="#">Acceuil</a>
            </li>
            <li>
                <a href="@Url.Action("ListeAbonnement", "Abonnement")">Gestion des abonnements</a>
            </li>
            <li class="active">
                <strong>Modification abonnement </strong>
            </li>
        </ol>
    </div>

</div>
<div class="wrapper wrapper-content animated fadeInRight">

    @if (ViewBag.AlerteSuspension)
    {
        <div class="alert alert-danger">
            Alerte de résiliation. Cet abonnement a <strong>@ViewBag.NbFactureNonpayes</strong> factures non payées !!
        </div>
    }
    @*@if (Model.DO_Etape == 2 && (Model.DO_RefTT== null || Model.CT_Telephone== null))
        {
            <div class="alert alert-warning alert-dismissable">
                <p class="text-danger">Merci de renseigner les champs: Numéro fixe et Référence TT de l'abonnement .</p>
            </div>

        }*@

    @if (TempData["MSG"] != null)
    {
        <div class="alert alert-warning alert-dismissable">
            <button type="button" class="close " data-dismiss="alert"> × </button>
            <p class="text-danger">@TempData["MSG"]</p>
        </div>

    }
    @if (TempData["MSG123"] != null)
    {
        <div class="alert alert-warning alert-dismissable">
            <button type="button" class="close " data-dismiss="alert"> × </button>
            <p class="text-danger">@TempData["MSG123"]</p>
        </div>
    }
    @if (TempData["MSGNS123"] != null)
    {
        <div class="alert alert-warning alert-dismissable">
            <button type="button" class="close " data-dismiss="alert"> × </button>
            <p class="text-danger">@TempData["MSGNS123"]</p>
        </div>
    }
   
    @if (ViewBag.Article == 0)
    {
        <div class="alert alert-success">
            <p>Cet abonnement requiet un paiement spécial. </p>
        </div>
    }

    @if (ViewData.ModelState[""] != null && ViewData.ModelState[""].Errors.Count > 0)
    {
        <div class="alert alert-warning alert-dismissable">
            <button type="button" class="close " data-dismiss="alert"> × </button>
            @Html.ValidationSummary("", new { @class = "text-danger" })
        </div>
    }
    @if (ViewBag.VerifierNumero != null)
    {
        <div class="alert alert-danger alert-dismissable">
            <button type="button" class="close " data-dismiss="alert">×</button>
            <p>@ViewBag.VerifierNumero</p>
        </div>
    }

    @if (ViewBag.ErreurFacture != null)
    {
        <div class="alert alert-danger alert-dismissable">
            <button type="button" class="close " data-dismiss="alert">×</button>
            <p>@ViewBag.ErreurFacture</p>
        </div>
    }
    @if (ViewBag.AucunArticleLie != null)
    {
        <div class="alert alert-info alert-dismissable">
            <button type="button" class="close " data-dismiss="alert">×</button>
            <p>@ViewBag.AucunArticleLie</p>
        </div>
    }

    @if (Model.DO_FinAbo != Convert.ToDateTime("01/01/1900") && Model.Resilie == 0)
    {
        <div class="alert alert-info alert-dismissable">
            <p>L'abonnement est terminé. le @Model.DO_FinAbo.GetValueOrDefault().ToString("dd/MM/yyyy")</p>
        </div>
    }

    @if (Model.Resilie == 1)
    {
        <div class="alert alert-danger alert-dismissable">
            <p>L'abonnement a été  résilié. le @Model.DO_FinAbo.GetValueOrDefault().ToString("dd/MM/yyyy")</p>
        </div>
    }


    @if (TempData["MSGNS"] != null)
    {
        <div class="alert alert-warning alert-dismissable">
            <button type="button" class="close " data-dismiss="alert"> × </button>
            <p class="text-danger">@TempData["MSGNS"]</p>
        </div>

    }

    @if (TempData["MSGBR"] != null)
    {
        <div class="alert alert-warning alert-dismissable">
            <button type="button" class="close " data-dismiss="alert"> × </button>
            <p class="text-danger">@TempData["MSGBR"]</p>
        </div>

    }
    @if (TempData["MSGBRR"] != null)
    {
        <div class="alert alert-warning alert-dismissable">
            <button type="button" class="close " data-dismiss="alert"> × </button>
            <p class="text-danger">@TempData["MSGBRR"]</p>
        </div>

    }
    @if (TempData["MSGAn"] != null)
    {
        <div class="alert alert-warning alert-dismissable">
            <button type="button" class="close " data-dismiss="alert"> × </button>
            <p class="text-danger">@TempData["MSGAn"]</p>
        </div>

    }
    @if (TempData["MSGRetourResiliation"] != null)
    {
        <div class="alert alert-warning alert-dismissable">
            <button type="button" class="close " data-dismiss="alert"> × </button>
            <p class="text-danger">@TempData["MSGRetourResiliation"]</p>
        </div>

    }
    @if (ViewBag.changement != null)
    {
        <div class="alert alert-success alert-dismissable">
            <button type="button" class="close " data-dismiss="alert"> × </button>
            @ViewBag.changement
        </div>
    }
    <div class="row">
        <div class="col-lg-9">
            <div class="wrapper wrapper-content animated fadeInUp">

                <div class="ibox">


                    <div class="ibox-content">
                        @*<code id="is_suspendu_container" class="pull-right"></code>*@


                        @if (Model.TypeAbonnement == 9)
                        {
                            <div class="alert alert-warning alert-dismissable">
                                <button type="button" class="close " data-dismiss="alert"> × </button>
                                Cet abonnement a été crée par la Poste Tunisienne.
                            </div>
                        }
                        @if (Model.TypeAbonnement == 2)
                        {
                            <div class="alert alert-warning alert-dismissable">
                                <button type="button" class="close " data-dismiss="alert"> × </button>
                                Cet abonnement a été crée suite à une migration débit.
                            </div>
                        }

                        @if (Model.TypeAbonnement == 5)
                        {
                            <div class="alert alert-warning alert-dismissable">
                                <button type="button" class="close " data-dismiss="alert"> × </button>
                                Cet abonnement a été crée suite à une demande de transfert de ligne.
                            </div>
                        }
                        @if (Model.AP_APPRO != null)
                        {<div class="row">
                                <div class="alert alert-info alert-dismissable">
                                    <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
                                    Une demande d'appro. à été envoyée.  une notification vous sera envoyée dès que l'article est disponible dans votre stock.

                                    Cliquez <a class="alert-link" href="@Url.Action("DetailDemandeAppro", "Interne", new { id = Model.AP_APPRO })"> ici </a> pour voir la demande d'appro. envoyée.
                                </div>
                            </div>
                        }

                        @if (Model.DO_Statut == 5 || Model.DO_Statut == 6)
                        {
                            <div class="alert alert-info alert-dismissable">
                                <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
                                N.B: Vérifier la solvabilité du client et mettre à jour le statut de l'abonnement.
                            </div>
                        }


                        <br />


                        <div class="row">
                            @if (ViewBag.AtteintSeuil)
                            {
                                <div class="alert alert-danger">
                                    <strong>Vous avez atteint le seuil des paiement non versés! Merci d'effectuer vos versements.</strong>

                                </div>
                            }
                            @if (ViewBag.AtteintDateBorEnPaiement)
                            {
                                <div class="alert alert-danger">
                                    <strong>Vous avez atteint le nombre de jours pour bloquer le paiement.</strong>

                                </div>
                            }
                            @using (Html.BeginForm("SaveRefandTel", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
                            {

                                @Html.HiddenFor(model => model.cbMarq)



                                <div class="progress progress-striped">
                                    <div style="width: @Model.A_Pourcent%;" aria-valuemax="100" aria-valuemin="0"
                                         aria-valuenow="50" role="progressbar" class="progress-bar progress-bar-navy-light active">
                                        <span class="sr-only">@Model.A_Pourcent%</span>
                                    </div>
                                </div>

                                <div class="form-group col-xs-6">
                                    <label class="col-md-6 control-label">Réf Abonnement TT:</label>

                                    <div class="col-md-6"><input type="text" class="form-control" maxlength="17" name="DO_Ref" id="DO_Ref" value="@Model.DO_Ref"></div>
                                </div>

                                <div class="form-group col-xs-4">
                                    <label class="col-md-4 control-label">Téléphone:</label>

                                    <div class="col-md-8">
                                        <input type="text" class="form-control" data_mask="99999999" name="aboTel" id="aboTel" value="@Model.aboTel" maxlength="8">
                                    </div>

                                </div>

                                if ((User.IsInRole("Admin") || User.IsInRole("SaveRefandTel")))
                                {
                                    <div class="form-group col-xs-2">
                                        <button class="btn btn-danger btn-circle btn-outline" type="submit">
                                            <i class="fa fa-edit"></i>
                                        </button>
                                    </div>
                                }

                            }
                            @if ((Model.TypeAbonnement != 2 || (ViewBag.TypeMigre == 1)) || (Model.TypeAbonnement == 2 || (ViewBag.TypeMigre == 0)))
                            {

                                if (Model.DO_Valide == 0 && Model.DO_Etape <= 5 && Model.DO_Etape != 8 && (User.IsInRole("Admin") || User.IsInRole("ChangerParametreAbonnement")))
                                {
                                    <button type="button" class="btn btn-sm btn-outline btn-purplebee pull-right  m-l-sm"
                                            title="changer informations abonnements"
                                            data-toggle="modal"
                                            data-target="#ChangerInformationAbonnement">

                                        <i class="fa fa-pencil"></i>
                                        changer informations abonnements
                                    </button>
                                    <br />

                                }
                            }
                            <br />

                        </div>

                        <div class="row">
                            @*manel*@
                            @if (Model.TypeAbonnement == 9)
                            {

                                <a class="btn btn-purplebee  dim" title="Imprimer Facture" data-toggle="modal" data-target="#ListeFactures">
                                    <i title="Imprimer Facture " class="fa fa-print"></i>
                                </a>
                                <a class="btn btn-purplebee dim" title="Imprimer Contrat" href="@Url.Action("ImprimerContrat","Abonnement", new { id = @Model.cbMarq  })" target="_blank">
                                    <i title="Imprimer Contrat" class="fa fa-edit"></i>
                                </a>

                            }


                            @*manel*@

                            @if ((Model.DO_Etape > 4 && Model.DO_Etape != 8))
                            {
                                @*manel*@
                                if (Model.DO_Valide == 1 && Model.TypeAbonnement != 9)
                                {

                                    <a class="btn btn-purplebee  dim" title="Imprimer Facture" data-toggle="modal" data-target="#ListeFactures">
                                        <i title="Imprimer Facture " class="fa fa-print"></i>
                                    </a>
                                }


                                else if (Model.DO_Etape == 5 @*&& Model.DO_Statut == 1*@ && Model.TypeAbonnement != 9 && Model.Resilie == 0 && (User.IsInRole("Admin") || User.IsInRole("Paiement et Livraison")))
{

if (!ViewBag.AtteintSeuil)
{
if (ViewBag.Article == 0)
{
                        <a class="btn btn-purplebee dim" title="Paiement et livraison" href=@Url.Action("PaiementSpecial", "Abonnement", new { id = Model.cbMarq })>Paiement&Livraison</a>
                    }
                    else
                    {
                        <a class="btn btn-purplebee  dim" title="Paiement et livraison" data-toggle="modal"
                           data-target="#ModifierAboPaiementLivraisons">
                            Paiement&Livraison
                        </a>
                    }
                }
            }
           else if (!ViewBag.AtteintDateBorEnPaiement)
            {
                if (ViewBag.Article == 0)
                {
                        <a class="btn btn-purplebee dim" title="Paiement et livraison" href=@Url.Action("PaiementSpecial", "Abonnement", new { id = Model.cbMarq })>Paiement&Livraison</a>
                    }
                    else
                    {
                        <a class="btn btn-purplebee  dim" title="Paiement et livraison" data-toggle="modal"
                           data-target="#ModifierAboPaiementLivraisons">
                            Paiement&Livraison
                        </a>
                    }
                }
            }
            else if (Request.IsAuthenticated && (User.IsInRole("Admin")) && Model.DO_Etape < 7
            && Model.TypeAbonnement != 9 && Model.Resilie == 0)
            {

            }

                            }

                            @if ((User.IsInRole("Admin") || User.IsInRole("RetourEtapeReservation")) && Model.DO_Etape == 5 && Model.DO_Statut == 1 && Model.TypeAbonnement != 9 && Model.Resilie == 0)
                            {
                                <button type="button" title="Retour à l'étape précedente" class="btn btn-sm btn-outline btn-greenbee pull-right  m-l-sm" data-toggle="modal" data-target="#RetourEtape">
                                    <i class="fa fa-arrow-circle-o-right"></i>Retour
                                </button>
                            }
                            @if ((User.IsInRole("Admin") || User.IsInRole("RetourEtapeFacturation")) && Model.DO_Etape == 6 && Model.DO_Statut == 3 && Model.TypeAbonnement != 9 && Model.Resilie == 0)
                            {
                                <button type="button" title="Retour a l'etape précedente" class="btn btn-sm btn-outline btn-greenbee pull-right  m-l-sm" data-toggle="modal" data-target="#RetourEtapeFact">
                                    <i class="fa fa-arrow-circle-o-right"></i>Retour
                                </button>
                            }
                            @if ((Model.DO_Etape >= 5 && Model.DO_Statut >= 1) || Model.TypeAbonnement == 9)
                            {

                                <a class="btn btn-purplebee  dim" title="Imprimer les BL" data-toggle="modal" data-target="#ListeBL">
                                    <i title="Imprimer BL " class="fa fa-files-o"></i>
                                </a>
                            }



                            @if (Model.DO_Etape > 5 && Model.TypeAbonnement != 9)
                            {
                                <a class="btn btn-purplebee dim" title="Imprimer Contrat" href="@Url.Action("ImprimerContrat","Abonnement", new { id = @Model.cbMarq  })" target="_blank">
                                    <i title="Imprimer Contrat" class="fa fa-edit"></i>
                                </a>
                            }
                            @if (Model.DO_Valide == 1 && Model.Resilie == 0 && User.IsInRole("Admin") || (User.IsInRole("SuspensionAbonnement")))
                            {
                                if (Model.DO_Valide == 1 && Model.DO_FinAbo == Convert.ToDateTime("01/01/1900"))
                                {
                                    <button class="btn btn-warning btn-sm suspendrefacturation">Suspendre la facturation</button>
                                }
                                else
                                {
                                    <button class="btn btn-success btn-sm reactiverfacturation">Réactiver la facturation</button>
                                }
                            }


                            @if (Model.DO_Etape > 5 && Model.Resilie == 0 && User.IsInRole("Admin") || (User.IsInRole("ResiliationAbonnement")))
                            {
                                <button type="button" title="Résilie la demande d'abonnement" class="btn btn-sm btn-outline btn-danger pull-right  m-l-sm" data-toggle="modal" data-target="#ResilieAbo">
                                    <i class="fa fa-times-circle "></i>
                                    Résilier l'abonnement
                                </button>

                            }

                            @if (Model.Resilie == 0 && (User.IsInRole("Admin") || (User.IsInRole("ChangementDateContrat"))))
                            {
                                <button type="button" data-toggle="modal" data-target="#Changerdatecontrat" title="Modifier date contrat"
                                        class="btn btn-sm btn-outline btn-purplebee pull-right ">
                                    Changer date contrat
                                </button>
                            }

                            @if (Model.DO_Etape > 5 && Model.Resilie == 0 && User.IsInRole("Admin") || (User.IsInRole("Activation radius")))
                            {
                                <button type="button" title="Activation modem" class="btn btn-sm btn-success" data-toggle="modal" data-target="#ActiverRadius">
                                    <i class="fa fa-spinner "></i>
                                    Activer le modem
                                </button>

                            }

                            <button type="button" class="btn btn-sm btn-outline btn-purplebee pull-right" data-toggle="modal" data-target="#ShowListeReglements">
                                <i title="Reçu de paiement" class="fa fa-check">Reçu </i>
                            </button>
                        </div>


                    </div>
                </div>



                @using (Html.BeginForm("Modifier", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
                {

                    @Html.HiddenFor(model => model.cbMarq)
                    <div class="ibox">

                        <div class="ibox-content">
                            <div class="row">

                                <div class="col-md-6">
                                    <h3>Réf Abonnement: #@Model.DO_Piece</h3>



                                </div>
                                <div class="col-md-6">

                                    @if (Model.Resilie == 0 && Model.DO_Valide == 1 && (User.IsInRole("Admin") || (User.IsInRole("RemiseAbonnement"))))
                                    {

                                        <button type="button" data-toggle="modal" data-target="#AppliquerRemise" title="Modifier remise abonnement "
                                                class="btn btn-sm btn-outline btn-purplebee pull-right ">
                                            <i class="fa fa-percent "></i> Appliquer une remise
                                        </button>
                                    }

                                    @if (Model.Resilie == 0 && Model.DO_Valide == 1 && (User.IsInRole("Admin") || (User.IsInRole("ChangerParametreAbonnement"))))
                                    {
                                        @*if (ViewBag.DO_Cloture == 1 && Request.IsAuthenticated && (User.IsInRole("Admin") || User.IsInRole("Changement Periodicite")))*@
                                        <button type="button" data-toggle="modal" data-target="#ChangementPeriodiciteModel" title="Modifier paramètre abonnement "
                                                class="btn btn-sm btn-outline btn-greenbee pull-right ">
                                            <i class="fa fa-money "></i> Modifier les paramètres de l'abonnement
                                        </button>
                                    }

                                    @if (Model.TypeAbonnement != 2 || (ViewBag.TypeMigre == 1))
                                    {
                                        if (Model.DO_Etape <= 5 && (User.IsInRole("Admin") || User.IsInRole("AnnulerAbonnement")))
                                        {
                                            <button type="button" title="Annuler la demande d'abonnement" class="btn btn-sm btn-outline btn-danger pull-right  m-l-sm" data-toggle="modal" data-target="#AnnulerAbo">
                                                <i class="fa fa-trash "></i> Annuler l'abonnement
                                            </button>
                                        }

                                        if (Model.DO_Etape == 4 && Model.TypeAbonnement == 2)
                                        {
                                            <button type="button" class="btn btn-sm btn-outline btn-danger pull-right" id="showmodal">

                                                <i class="fa fa-save"></i>Enregistrer
                                            </button>
                                        }
                                        if ((User.IsInRole("Admin") || @ViewBag.test == true) && Model.TypeAbonnement != 2)
                                        {
                                            if (Model.DO_Etape == 4)
                                            {


                                                <button type="button" data-toggle="modal" data-target="#ModifierAboMiseEnservice"
                                                        class="btn btn-sm btn-outline btn-danger pull-right ">
                                                    <i class="fa fa-save "></i> Enregistrer
                                                </button>
                                            }
                                        }
                                        if (Model.DO_Etape < 4)
                                        {
                                            <button type="button" class="btn btn-sm btn-outline btn-danger pull-right" id="showmodal">

                                                <i class="fa fa-save"></i>Enregistrer
                                            </button>
                                        }

                                    }



                                    @if (Model.Resilie == 1 && (User.IsInRole("Admin") || User.IsInRole("AnnulerResiliation")))
                                    {
                                        <button type="button" title="Annuler la demande d'abonnement" class="btn btn-sm btn-outline
                                                btn-greenbee pull-right  m-l-sm AnnulerResiliation">
                                            <i class="fa fa-trash "></i> Annuler la résiliation
                                        </button>
                                    }
                                </div>
                                <div class="modal inmodal" id="ModifierAboFrais" tabindex="-1" role="dialog" aria-hidden="true">
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content animated flipInX">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Ok</span></button>
                                            </div>
                                            <div class="modal-body">

                                                <div class="form-group">
                                                    <label class="col-sm-5 control-label">Frais d'installation ? </label>

                                                    <div class="col-sm-7">

                                                        @if (ViewBag.HasFraisInst)
                                                        {
                                                            <input class="checkbox-inline i-checks" type="radio" checked value=true id="HasFraisInstallation" name="HasFraisInstallation"> <span>Oui </span>
                                                            <input class="checkbox-inline i-checks" type="radio" value=false id="HasFraisInstallation" name="HasFraisInstallation"> <span> Non </span>

                                                        }
                                                        else
                                                        {
                                                            <input class="checkbox-inline i-checks" type="radio" value=true id="HasFraisInstallation" name="HasFraisInstallation"> <span>Oui </span>
                                                            <input class="checkbox-inline i-checks" type="radio" value=false checked id="HasFraisInstallation" name="HasFraisInstallation"> <span> Non </span>
                                                        }

                                                    </div>
                                                </div>


                                                <div class="form-group">
                                                    <label class="control-label">Commentaires</label>
                                                    <div class="">
                                                        <textarea type="text" id="AC_Notes" name="AC_Notes" class="form-control col-sm-pull-2"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>


                                                <button type="submit" class="btn btn-primary ladda-button " data-style="expand-right">Enregistrer les modifications </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal inmodal" id="ModifierAbo" tabindex="-1" role="dialog" aria-hidden="true">
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content animated flipInX">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Ok</span></button>
                                            </div>
                                            <div class="modal-body">

                                                Voulez-vous vraiment enregistrer les modifications?
                                                <div class="form-group">
                                                    <label class="control-label">Commentaires</label>
                                                    <div class="">
                                                        <textarea type="text" id="AC_Notes1" name="AC_Notes1" class="form-control col-sm-pull-2"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>


                                                <button type="submit" class="btn btn-primary ladda-button " data-style="expand-right">Enregistrer les modifications </button>





                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal inmodal" id="ModifierAboChangerDebit" tabindex="-1" role="dialog" aria-hidden="true">
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content animated flipInX">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Ok</span></button>
                                            </div>
                                            <div class="modal-body">

                                                <div class="alert alert-warning">
                                                    Vous pouvez changer le débit de cet abonnement.
                                                </div>
                                                <select class="col-md-6 form-control chosen-search " id="DebitAbonnement" name="DebitAbonnement">

                                                    @if (ViewBag.listeDebitsDispo != null)
                                                    {
                                                        foreach (var item in ViewBag.listeDebitsDispo)
                                                        {
                                                            if (ViewBag.ArtPACKService.AR_Ref == item.AR_Ref)
                                                            {
                                                                <option class="font-bold" value="@item.AR_Ref" selected="selected"> Débit: @item.D_Debit @item.AR_Ref  @item.AR_Design </option>

                                                            }
                                                            else
                                                            {
                                                                <option class="font-bold" value="@item.AR_Ref"> Débit: @item.D_Debit - Article: @item.AR_Ref @item.AR_Design </option>
                                                            }
                                                        }
                                                    }
                                                </select>
                                                Voulez-vous vraiment enregistrer les modifications?
                                                <div class="form-group">
                                                    <label class="control-label">Commentaires</label>
                                                    <div class="">
                                                        <textarea type="text" id="AC_Notes2" name="AC_Notes2" class="form-control col-sm-pull-2"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                                                <button type="submit" class="btn btn-primary ladda-button " data-style="expand-right">Enregistrer les modifications </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>



                                <div class="col-lg-12">
                                    <div class="form-group col-xs-5">
                                        <label class="col-md-4 control-label">Statut:</label>

                                        <div class="col-md-8">
                                            @if (Model.DO_Etape == 0)
                                            {
                                                <select class="chosen-select form-control" id="DO_Statut" name="DO_Statut">
                                                    @if (Model.DO_Statut == 0)
                                                    {
                                                        <option value=0> Saisi</option>
                                                        <option value=5> Faisabilité technique</option>
                                                        <option value=6> Solvabilité Client </option>
                                                        <option value=7> Validation Client </option>
                                                    }
                                                    else if (Model.DO_Statut == 1)
                                                    {
                                                        <option value=0> Saisi</option>
                                                        <option value=5> Faisabilité technique</option>
                                                        <option value=6> Solvabilité Client </option>
                                                        <option value=7> Validation Client </option>
                                                    }
                                                    else if (Model.DO_Statut == 5)
                                                    {
                                                        <option value=0> Saisi</option>
                                                        <option value=5 selected="selected"> Faisabilité technique</option>
                                                        <option value=6> Solvabilité Client </option>
                                                        <option value=7> Validation Client </option>
                                                    }
                                                    else if (Model.DO_Statut == 7)
                                                    {
                                                        <option value=0> Saisi</option>
                                                        <option value=5> Faisabilité technique</option>
                                                        <option value=6> Solvabilité Client </option>
                                                        <option value=7 selected="selected"> Validation Client </option>
                                                    }

                                                    else if (Model.DO_Statut == 6)
                                                    {
                                                        <option value=0> Saisi</option>
                                                        <option value=5> Faisabilité technique</option>
                                                        <option value=6 selected="selected"> Solvabilité Client </option>
                                                        <option value=7> Validation Client </option>
                                                    }


                                                    @*else
                                                        {
                                                        @*<option value=1> En Cours</option>
                                                        <option value=2> En Attente</option>
                                                        <option value=3> Validé</option>
                                                        }
                                                    *@




                                                </select>
                                            }
                                            else
                                            {
                                                <input Readonly="Readonly" class="form-control hidden" id="DO_Statut"
                                                       name="DO_Statut" type="text" value=1 />

                                                if (Model.Resilie == 1)
                                                {
                                                    <span class="label label-danger">Résilié</span>
                                                    <br />
                                                    <br />
                                                    <button class="btn btn-danger btn-circle btn-outline" type="button" data-toggle="modal" data-target="#ChangerMotifResiliation">
                                                        <i class="fa fa-edit"></i>
                                                    </button>
                                                }
                                                else if (Model.DO_Etape == 7)
                                                {
                                                    <span class="label label-greenbee">Validé</span>

                                                }
                                                else if (Model.DO_Etape == 8)
                                                {
                                                    <span class="label label-graybee">Annulé</span>
                                                    <span class="label label-greenbee">Motif: @Model.Motif_Annulation</span>
                                                    <br />
                                                    <br />
                                                    <button class="btn btn-danger btn-outline" type="button" data-toggle="modal" data-target="#ChangerMotifAnnulation">
                                                        <i class="fa fa-edit"></i>
                                                    </button>
                                                }
                                                else if (Model.DO_Etape == 0)
                                                {
                                                    <span class="label label-info">Nouveau</span>

                                                }
                                                else if ((Model.DO_Etape != 8) && (Model.Resilie != 1) && (Model.Migre == 1))
                                                {

                                                    <span class="label label-success">Migré</span>
                                                }
                                                else
                                                {

                                                    <span class="label label-purplebee">En cours</span>
                                                }
                                            }

                                        </div>
                                    </div>
                                </div>
                            </div>



                            @*maneeeeeeeeeeel paiement et livraison 17/02/2020*@
                            @if (Model.DO_Etape == 5 && Model.DO_Statut == 1 && Model.TypeAbonnement != 9)
                            {
                                <div class="modal inmodal" id="ModifierAboPaiementLivraisons" tabindex="-1" role="dialog" aria-hidden="true">
                                    <div class="modal-dialog modal-lg">
                                        <div class="modal-content animated flipInX">

                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Ok</span></button>
                                                <h4 class="modal-title"> Paiement et livraison </h4>
                                            </div>
                                            <div class="modal-body">

                                                <div class="alert alert-success alert-dismissable hidden" id="alertAppro">
                                                    <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
                                                    La demande d'appro. à été envoyé avec succès !
                                                    une notification vous sera envoyée dès que l'article est disponible dans votre stock.

                                                    <br /> Cliquez <a class="alert-link" href="" id="hrefAppro"> ici </a> pour voir la demande d'appro. envoyée.
                                                </div>

                                                <fieldset id="">
                                                    <div class="form-group">
                                                        <p class="text-info">
                                                            Voulez vous vraiment confirmer la livraison des matériels !
                                                            <small class="text-muted"> Un contrat sera généré à partir les informations entrées. ainsi des bon de sortie </small>
                                                        </p>
                                                        <hr />
                                                        <div class="form-group">
                                                            <label class="col-sm-4 control-label">
                                                                Articles réservés pour cet abonnement
                                                            </label>
                                                            @foreach (var item in ViewBag.ArtPACK)
                                                            {
                                                                <div class="col-sm-8">
                                                                    @if (item.AR_Type == 0 && item.LS_NoSerie != null)
                                                                    {
                                                                        <strong class="text-success">@item.DL_Design :</strong> <strong> @item.LS_NoSerie </strong>

                                                                    }
                                                                </div>

                                                            }
                                                        </div>

                                                        <div class="form-group">
                                                            <label class="col-md-4 control-label">Total abonnement</label>

                                                            <div class="col-md-8">
                                                                @if (Model.DO_MontantTTC == null)
                                                                {
                                                                    <p> 0 TDN </p>
                                                                }
                                                                else
                                                                {
                                                                    <input type="text" class="form-control" disabled value="@String.Format("{0:N3}", (decimal)(Model.DO_MontantTTC)) TND">
                                                                }
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <label class="col-md-4 control-label">Total Règlements </label>
                                                            <div class="col-md-8">

                                                                <input type="text" class="form-control" disabled value="@String.Format("{0:N3}", (decimal)(ViewBag.ReglementsTotal)) TND">


                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label class="col-md-4 control-label">Net à payer  </label>
                                                            <div class="col-md-8">

                                                                <input type="text" class="form-control" disabled value="@String.Format("{0:N3}", (decimal)(ViewBag.NetAPayer)) TND">


                                                            </div>
                                                        </div>
                                                        <hr />
                                                        <div class="form-group">
                                                            <label class="col-lg-4 control-label">Choisir votre mode de paiement * </label>
                                                            <div class="col-lg-8">
                                                                <select class="col-lg-8 form-control chosen-search " id="cbIndice" name="cbIndice" required>
                                                                    <option class="font-bold" value="2"> Choisir </option>
                                                                    @foreach (var item in ViewBag.ModeReglementAgence)
                                                                    {
                                                                        <option class="font-bold" value="@item.Value">@item.Text</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>


                                                        <div id="ifospayement" style="display:none">
                                                            <div class="form-group">
                                                                <label class="col-lg-4 control-label">Identifiant *</label>
                                                                <div class="col-lg-8">
                                                                    <input type="text" class="form-control" name="identifiantpay" id="identifiantpay" placeholder="N° Chèque,Référence de paiement TPE , N° Compte du client," />
                                                                </div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label class="col-lg-4 control-label">Libellé</label>
                                                                <div class="col-lg-8">
                                                                    <input type="text" class="form-control" name="libelle" id="libelle" placeholder="Nom de la banque,N° Ordre de virement" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label class="col-lg-4 control-label">Description</label>
                                                                <div class="col-lg-8">
                                                                    <input type="text" class="form-control" name="description" id="description" placeholder="Titulaire du Chèque" maxlength="17" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label class="col-lg-4 control-label">Date Echéance </label>
                                                                <div class="col-lg-8">
                                                                    <input type="text" pattern="\d{1,2}/\d{1,2}/\d{4}" class="form-control" name="dateecheance" id="dateecheance" placeholder="Date d'échéance du chèque (format : jj/mm/aaaa)" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <hr />
                                                        <div class="col-md-12 float-e-margins">
                                                            <div class="form-group">
                                                                <label class="col-sm-4 control-label">Commentaires</label>

                                                                <div class="col-sm-6">
                                                                    <textarea class="form-control" name="AC_Notes6" id="AC_Notes6"></textarea>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </fieldset>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>

                                                <button class="btn btn-primary ladda-button ladda-button-demo" data-style="expand-right"
                                                        type="submit">
                                                    Confirmer
                                                </button>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                            <div class="row">

                                <div class="col-lg-5">

                                    <dl class="dl-horizontal">

                                        <dt>Ajouté par : </dt>
                                        <dd><strong>@Model.cbCreateur </strong></dd>
                                        <dt>Agence Création: </dt>
                                        <dd>
                                            @Model.A_IntCreation
                                            @if (User.IsInRole("ChangeAgenceCreation") || User.IsInRole("Admin"))
                                            {
                                                <button type="button" class="btn btn-graybee" data-toggle="modal" title="Change Agence Creation"
                                                        data-target="#ChangeAgenceCreation">
                                                    <i class="fa fa-edit"></i>
                                                </button>
                                            }
                                        </dd>

                                    </dl>

                                    <dl class="dl-horizontal">
                                        <dt>Fréquence de paiement</dt>
                                        <dd>@Model.Abo_Freq Mois</dd>
                                    </dl>
                                    <dl class="dl-horizontal">
                                        <dt>Date de création </dt>
                                        <dd>@Model.DO_Date.GetValueOrDefault().ToString("dd/MM/yyyy")</dd>
                                    </dl>

                                    <dl class="dl-horizontal">

                                        <dt>Service </dt>

                                        <dd>

                                            @if (ViewBag.ArtPACK.Count != 0)
                                            {
                                                foreach (var item in ViewBag.ArtPACK)
                                                {
                                                    if (item.AR_Type == 1)
                                                    {
                                                        <h1 class="label text-white" style="background-color:#61C3A5">
                                                            <i class="fa fa-shopping-cart text-white"></i>
                                                            @item.AR_Ref : @item.DL_Design

                                                        </h1>
                                                    }
                                                }

                                            }

                                        </dd>


                                    </dl>
                                    <dl class="dl-horizontal">
                                        <dt> Remise  1°ere facture </dt>
                                        <dd>
                                            <span> @String.Format("{0:N2}", ViewBag.ArtPACKService.DL_Remise02REM_Valeur) %</span>
                                        </dd>
                                    </dl>
                                    @if (Model.DO_Valide == 1)
                                    {
                                        <dl class="dl-horizontal">
                                            <dt>Remise n°eme factures </dt>


                                            <dd>
                                                <span>
                                                    @String.Format("{0:N2}", ViewBag.ArtPACKService.DL_RemiseValeur) %
                                                </span>
                                                @if (ViewBag.ArtPACKService.DL_DateFinRemise != null)
                                                {
                                                <dt>Date fin remise </dt>
                                                <dd>
                                                    <span> @ViewBag.ArtPACKService.DL_DateFinRemise.ToString("dd/MM/yyyy")</span>
                                                </dd>
                                            }

                                                </dd>

                                            </dl>
                                        }
                                    <dl class="dl-horizontal">
                                        <dt>Frais Installation </dt>
                                        <dd>
                                            @if (ViewBag.HasFraisInst)
                                            {
                                                <div class="font-bold text-success"><i class="fa fa-check"></i> Oui </div>
                                            }
                                            else
                                            {
                                                <div class="font-bold text-warning"><i class="fa fa-remove"></i> Non  </div>
                                            }
                                        </dd>
                                    </dl>

                                    <dl class="dl-horizontal">
                                        <dt>Code GPS </dt>
                                        <dd>
                                            @Model.CodeGPS
                                            <button type="button" class="btn btn-graybee" data-toggle="modal" title="Modifier code GPS"
                                                    data-target="#ChangerCodeGPS">
                                                <i class="fa fa-map-marker"></i>
                                            </button>
                                        </dd>

                                    </dl>
                                    <dl class="dl-horizontal">
                                        <dt>Solde durant engagement</dt>
                                        <dd>
                                            <div class="font-bold text-purplebee">
                                                
                                                @if (@ViewBag.SoldeTotal != null)
                                                {
                                                    @String.Format("{0:N3}", @ViewBag.SoldeTotal)
                                                }
                                                else
                                                {
                                                    @String.Format("{0:N3}", 0)
                                                }
                                            </div>
                                        </dd>
                                    </dl>

                                    <dl class="dl-horizontal">
                                        <dt>Solde actuel</dt>
                                        <dd>
                                            <div class="font-bold text-purplebee">
                                                @if (@ViewBag.Soldeabonn != null)
                                                {
                                                    @String.Format("{0:N3}", @ViewBag.Soldeabonn)
                                                }
                                                else
                                                {
                                                    @String.Format("{0:N3}", 0)
                                                }

                                            </div>
                                        </dd>
                                    </dl>
                                </div>
                                <div class="col-lg-7" id="cluster_info">
                                    <dl class="dl-horizontal">
                                        <dt>Agence </dt>
                                        <dd> <a href=# class="text-navy font-bold">@Model.A_IntituleAcq</a>  </dd>
                                    </dl>
                                    <dl class="dl-horizontal">

                                        <dt>Agence Livraison  </dt>
                                        <dd>
                                            <form role="form" class="form-inline">
                                                <div class="form-group col-md-6">
                                                    @ViewBag.AgenceLivraisonInt
                                                </div>


                                                @if (ViewBag.listeBL == null || ViewBag.listeBL.Count == 0)
                                                {
                                                    <div class="form-group col-md-4">
                                                        <button type="button" class="btn btn-graybee" data-toggle="modal" data-target="#ChangeAgenceLivraison" title="Modifier Agence Livraison">
                                                            <i class="fa fa-edit"></i>
                                                        </button>
                                                    </div>
                                                }
                                                <div class="form-group col-md-2"></div>
                                            </form>

                                        </dd>
                                    </dl>

                                    <dl class="dl-horizontal">
                                        <dt>Date fin engagement </dt>
                                        <dd>
                                            @ViewBag.DateFinEngagement
                                            <button type="button" class="btn btn-graybee" data-toggle="modal" title="Changer Date Fin Engagement"
                                                    data-target="#ChangerDateFinEnga">
                                                <i class="fa fa-edit"></i>
                                            </button>
                                        </dd>
                                    </dl>
                                    <dl class="dl-horizontal">
                                        <dt>Période engagement </dt>
                                        <dd>
                                            @ViewBag.PeriodeEngage Mois

                                            @if (User.IsInRole("ChangerPeriodeEngage") || User.IsInRole("Admin"))
                                            {
                                                <button type="button" class="btn btn-graybee" data-toggle="modal"
                                                        data-target="#ChangePeriodeEngage" title="Modifier Periode Engagement">
                                                    <i class="fa fa-edit"></i>
                                                </button>
                                            }
                                        </dd>

                                    </dl>

                                    <dl class="dl-horizontal">
                                        @if (ViewBag.DetailsAbo.DO_DateContrat != null)
                                        {
                                            <dt>Date de contrat </dt>


                                            <dd>@ViewBag.DetailsAbo.DO_DateContrat.ToString("dd/MM/yyyy") </dd>

                                        }
                                    </dl>
                                    @if (ViewBag.ConventionClient != null)
                                    {
                                        <dl class="dl-horizontal">
                                            <dt>Convention </dt>
                                            <dd>
                                                @if (ViewBag.ConventionClient != null)
                                                {
                                                    @ViewBag.ConventionClient
                                                }
                                            </dd>
                                            <dt>Société </dt>
                                            <dd>

                                                @if (ViewBag.IntituleSte != null)
                                                {
                                                    @ViewBag.IntituleSte
                                                }
                                            </dd>

                                        </dl>
                                    }

                                    @if (ViewBag.EtatStock != null)
                                    {
                                        <dl class="dl-horizontal">
                                            <dt>Etat de stock </dt>
                                            @foreach (var item in ViewBag.EtatStock)
                                            {
                                                if (item.QteDispo == 0)
                                                {
                                                    <dd>
                                                        <label class="text-purplebee">
                                                            @item.AR_DesignMatriel :

                                                        </label> <i class="text-danger"> non disponible</i>
                                                    </dd>
                                                }
                                                else
                                                {
                                                    <dd><label class="text-purplebee"> @item.AR_DesignMatriel :</label> @item.QteDispo disponible(s)  </dd>
                                                }

                                            }
                                            @*@String.Format("{0:N3}", item.QteDispo)*@
                                        </dl>
                                    }
                                    <dl class="dl-horizontal">
                                        <dt>Prise en charge livraison </dt>
                                        <dd>
                                            @if (ViewBag.Livraison != null)

                                            {
                                                if (ViewBag.Livraison)
                                                {
                                                    <div class="font-bold text-success"><i class="fa fa-check"></i> Oui </div>
                                                }
                                                else
                                                {
                                                    <div class="font-bold text-warning"><i class="fa fa-remove"></i> Non  </div>
                                                }
                                            }
                                            else
                                            {
                                                <div class="font-bold text-success"><i class="fa fa-check"></i> Oui </div>
                                            }


                                            @if (User.IsInRole("Admin") || User.IsInRole("ChangerPriseChargeLivraison"))
                                            {
                                                <button type="button" class="btn btn-graybee" data-toggle="modal"
                                                        data-target="#ChangeLivraison">
                                                    <i class="fa fa-edit"></i>
                                                </button>
                                            }
                                        </dd>
                                    </dl>
                                    <dl class="dl-horizontal">
                                        <dt>Date mise en service </dt>
                                        <dd>

                                            <code class="alert-warning">@ViewBag.Dateservice</code>
                                            @if (Model.DO_Etape == 6)
                                            {
                                                <button type="button" class="btn btn-graybee" data-toggle="modal" title="Changer Date mise en service"
                                                        data-target="#ChangementDateService">
                                                    <i class="fa fa-edit"></i>
                                                </button>
                                            }

                                        </dd>
                                    </dl>
                                    <dl class="dl-horizontal">
                                        <dt>Date 1ere connexion </dt>
                                        <dd>
                                            <code class="alert-warning">@ViewBag.DO_PremiereConnexion</code>
                                        </dd>
                                    </dl>
                                </div>
                            </div>

                            <div class="row m-t-sm">
                                <div class="col-lg-12">
                                    <div class="panel blank-panel">
                                        <div class="panel-heading">
                                            <div class="panel-options">
                                                <ul class="nav nav-tabs">
                                                    <li class="active"><a href="#tab-1" data-toggle="tab">Généralité</a></li>
                                                    <li class=""><a href="#tab-4" data-toggle="tab">Documents</a></li>
                                                    <li class=""><a href="#tab-5" data-toggle="tab">Commercial</a></li>
                                                    <li class=""><a href="#ReglementsClient" data-toggle="tab">Reglements</a></li>
                                                    <li class=""><a href="#ArticlesEnSUS" data-toggle="tab">Articles en SUS</a></li>
                                                    <li class=""><a href="#ArticlesMateriel" data-toggle="tab">Matériel </a></li>
                                                    <li class=""><a href="#ServicesInclus" data-toggle="tab">Services inclus </a></li>
                                                    <li class=""><a href="#tab-remarque" data-toggle="tab">Remarques</a></li>
                                                    <li class=""><a href="#tab-Suivi" data-toggle="tab">Suivi</a></li>

                                                </ul>
                                            </div>
                                        </div>

                                        <div class="panel-body">
                                            <div class="tab-content">
                                                <!-- Généralité-->
                                                <div class="tab-pane active " id="tab-1">
                                                    <form method="get" class="form-horizontal">
                                                        <div class="ibox float-e-margins">
                                                            <div class="ibox-title">
                                                                <div class="ibox-tools">
                                                                    <a class="collapse-link">
                                                                        <i class="fa fa-chevron-up text-navy"></i>
                                                                    </a>
                                                                </div>
                                                            </div>
                                                            <div class="ibox-content">
                                                                <div class="row">
                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="col-sm-4 control-label">Nom et prénom</label>
                                                                                <div class="col-sm-8">
                                                                                    <span class="help-block m-b-none">
                                                                                        @Html.TextBoxFor(model => model.CT_Intitule, new { @class = "form-control", @id = "CT_Intitule", @name = "CT_Intitule" })
                                                                                    </span>
                                                                                    <span class="pull-left">
                                                                                        <a href="/Structure/DetailsClient/@ViewBag.CbmarqClient" target="_blank">
                                                                                            Informations client
                                                                                        </a>
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="col-sm-4 control-label">Identifiant </label>
                                                                                <div class="col-sm-8">
                                                                                    <span class="help-block m-b-none">
                                                                                        @Html.TextBoxFor(model => model.CT_Identifiant, new { @class = "form-control", @Readonly = "Readonly", @id = "CT_Identifiant", @name = "CT_Identifiant" })
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <br />
                                                                    <div class="form-group">
                                                                        <label class="col-sm-2 control-label">Contact</label>
                                                                        <div class="col-sm-10">
                                                                            @Html.TextBoxFor(model => model.CT_Contact, new { @class = "form-control", @name = "CT_Contact", @id = "CT_Contact" })
                                                                        </div>
                                                                    </div>
                                                                    <div class="row">
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="col-sm-4 control-label">Téléphone client</label>
                                                                                <div class="col-sm-8">
                                                                                    @*<span class="help-block m-b-none">
                                                                                            <input class="form-control" id="CT_Telephone" name="CT_Telephone" type="text" value=@Model.CT_Telephone />
                                                                                        </span>*@
                                                                                    <ul>
                                                                                        @if (ViewBag.numerostelephone != null)
                                                                                        {
                                                                                            foreach (var item in ViewBag.numerostelephone)
                                                                                            {
                                                                                                <li class="text-greenbee">
                                                                                                    <strong>@item.CT_Telephone</strong>@if (@item.CT_Telephone1 != null)
                                                                                                    {<strong>/ @item.CT_Telephone1</strong>}
                                                                                                </li>
                                                                                            }
                                                                                        }

                                                                                    </ul>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <div class="form-group">
                                                                                <label class="col-sm-4 control-label">Téléphone de contact</label>
                                                                                <div class="col-sm-8">

                                                                                    <ul>
                                                                                        @if (ViewBag.Contacttelephone != null)
                                                                                        {
                                                                                            foreach (var item in ViewBag.Contacttelephone)
                                                                                            {

                                                                                                <li class="text-greenbee">
                                                                                                    <strong>@item.CT_Telephone1</strong>@if (@item.CT_Telephone2 != null)
                                                                                                    {<strong>/ @item.CT_Telephone2</strong>}
                                                                                                </li>
                                                                                            }
                                                                                        }


                                                                                    </ul>


                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>


                                                                    @if (ViewBag.AdressesClient != null)
                                                                    {
                                                                        foreach (var i in ViewBag.AdressesClient)
                                                                        {

                                                                            <div class="form-group">
                                                                                <label class="col-sm-2 control-label">Adresse </label>

                                                                                <div class="col-sm-10">
                                                                                    <select class="form-control chosen-select" id="ID_CTAdresse" name="ID_CTAdresse">
                                                                                        @foreach (var item in ViewBag.Adresses)
                                                                                        {

                                                                                            if (item.cbMarq == Model.idAdresseClient)
                                                                                            {
                                                                                                <option value=@item.cbMarq selected>@item.LI_Intitule</option>
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                <option value=@item.cbMarq>@item.LI_Intitule</option>
                                                                                            }
                                                                                        }
                                                                                    </select>

                                                                                </div>
                                                                            </div>
                                                                            <div class="form-group">
                                                                                <label class="col-sm-2 control-label">Adresse Installaion</label>

                                                                                <div class="col-sm-10">
                                                                                    <select class="form-control chosen-select" id="CT_AdresseInst" name="CT_AdresseInst">
                                                                                        @foreach (var item in ViewBag.Adresses)
                                                                                        {

                                                                                            if (item.cbMarq == Model.CT_AdresseInst)
                                                                                            {
                                                                                                <option value=@item.cbMarq selected>@item.LI_Intitule</option>
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                <option value=@item.cbMarq>@item.LI_Intitule</option>
                                                                                            }
                                                                                        }
                                                                                    </select>

                                                                                </div>
                                                                            </div>
                                                                            <div class="form-group">
                                                                                <label class="col-sm-2 control-label">Adresse facturation </label>
                                                                                <div class="col-sm-10">
                                                                                    <select class="form-control chosen-select" id="CT_AdresseFacture" name="CT_AdresseFacture">
                                                                                        @foreach (var item in ViewBag.Adresses)
                                                                                        {
                                                                                            if (item.cbMarq == Model.CT_AdresseFacture)
                                                                                            {
                                                                                                <option value=@item.cbMarq selected>@item.LI_Intitule</option>
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                <option value=@item.cbMarq>@item.LI_Intitule</option>
                                                                                            }
                                                                                        }
                                                                                    </select>
                                                                                </div>
                                                                            </div>
                                                                            <div class="form-group">
                                                                                <label class="col-sm-2 control-label">Complément Adresse </label>
                                                                                <div class="col-sm-10">
                                                                                    <span class="help-block m-b-none">
                                                                                        <input class="form-control" id="CT_Complement" disabled name="CT_Complement" value="@i.LI_Complement" maxlength="34" />
                                                                                    </span>
                                                                                </div>
                                                                            </div>
                                                                            <div class="row">
                                                                                <div class="col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="col-sm-4 control-label">Région</label>
                                                                                        <div class="col-sm-8">
                                                                                            @foreach (var item in ViewBag.CodesRegions)
                                                                                            {
                                                                                                if (item.R_CodeRegion == i.LI_CodeRegion)
                                                                                                {
                                                                                                    <input class="form-control" id="CT_Gouvernorat" name="CT_Gouvernorat" type="text" value="@item.R_Intitule" Readonly />
                                                                                                }
                                                                                            }
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="col-sm-4 control-label">Gouvernorat</label>
                                                                                        <div class="col-sm-8">
                                                                                            <input class="form-control" id="CT_Gouvernorat" name="CT_Gouvernorat" type="text" value="@i.LI_Gouvernorat" Readonly />
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="row">
                                                                                <div class="col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="col-sm-4 control-label">Ville</label>

                                                                                        <div class="col-sm-8">
                                                                                            <span class="help-block m-b-none">
                                                                                                <input class="form-control" id="CT_Ville" name="CT_Ville" type="text" value="@i.LI_Ville" Readonly />

                                                                                            </span>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="col-sm-4 control-label">Cité</label>
                                                                                        <div class="col-sm-8">

                                                                                            <input class="form-control" id="CT_Localite" name="CT_Localite" type="text" value="@i.LI_Localite" Readonly />

                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="row">
                                                                                <div class="col-md-6">
                                                                                    <div class="form-group">
                                                                                        <label class="col-sm-4 control-label">Code Postal</label>
                                                                                        <div class="col-sm-8">
                                                                                            <span class="help-block m-b-none">
                                                                                                <input class="form-control" id="CT_CodePostal" name="CT_CodePostal" type="text" value="@i.LI_CodePostal" Readonly />
                                                                                            </span>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        }

                                                                    }


                                                                </div>
                                                            </div>
                                                        </div>
                                                        @if (Model.DO_Etape < 3)
                                                        {

                                                            <button type="button" class="btn btn-greenbee  pull-right ladda-button" title="Modifier adresse" onClick="EnregistrerAdre(@Model.cbMarq);">
                                                                <i class="fa fa-pencil">Enregistrer les modifications </i>
                                                            </button>
                                                        }
                                                    </form>

                                                </div>                    <!-- Documents -->
                                                <div id="tab-4" class="tab-pane">
                                                    <div class="panel-body">
                                                        <div class="table-responsive">


                                                            <a href=@Url.Action("ImprimerRecuAbonnement/" + @Model.cbMarq, "Abonnement") target="_blank" class="pull-right">
                                                                Reçu demande abonnement
                                                            </a>


                                                            @if (ViewBag.ListFiles.Count == 0)
                                                            {
                                                                <p> Aucun fichier </p>
                                                            }
                                                            else
                                                            {
                                                                <table class="table table-bordered table-stripped">
                                                                    <thead>
                                                                        <tr>
                                                                            <th></th>
                                                                            <th>
                                                                                Intitulé Document
                                                                            </th>
                                                                            <th> Description </th>

                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>

                                                                        @if (ViewBag.ListFiles.Count == 0)
                                                                        {
                                                                            <p>Aucun attachement. </p>
                                                                        }
                                                                        else
                                                                        {
                                                                            foreach (var item in ViewBag.ListFiles)
                                                                            {
                                                                                <tr>
                                                                                    <td>
                                                                                        <a href="@item.Path" target="_blank"> Voir </a>
                                                                                    </td>
                                                                                    <td>
                                                                                        @item.B_Intitule
                                                                                    </td>
                                                                                    <td>
                                                                                        @item.B_Description
                                                                                    </td>
                                                                                </tr>
                                                                            }
                                                                        }
                                                                    </tbody>
                                                                </table>
                                                            }
                                                        </div>
                                                    </div>

                                                    <button type="button" class="btn btn-warning btn-rounded  pull-right" data-toggle="modal" data-target="#AddDoc">
                                                        <i class="fa fa-pencil"></i>
                                                    </button>
                                                </div>
                                                <!-- Commercial-->
                                                <div class="tab-pane" id="tab-5">

                                                    @if (ViewBag.listeFactures == null)
                                                    {
                                                        <p>Aucune Facture </p>

                                                    }
                                                    else
                                                    {
                                                        <table class="table table-striped">
                                                            <thead>
                                                                <tr>
                                                                    <th>Type Document</th>
                                                                    <th>N° Pièce</th>
                                                                    <th>Date </th>
                                                                    <th>Référence</th>
                                                                    <th>Montant TTC</th>
                                                                    <th></th>
                                                                </tr>
                                                            </thead>


                                                            <tbody>
                                                                @foreach (var item in ViewBag.listeFactures)
                                                                {

                                                                    <tr>
                                                                        <td>
                                                                            @if (item.DO_Statut == 0)
                                                                            {
                                                                                <span class="label label-default"><i class="fa fa-check"></i> En Cours</span>
                                                                            }
                                                                            else if (item.DO_Statut == 1)
                                                                            {
                                                                                <span class="label label-success"><i class="fa fa-check"></i> Payée</span>

                                                                            }
                                                                            else if (item.DO_Statut == 2)
                                                                            {
                                                                                <span class="label label-info"><i class="fa fa-check"></i> Versée</span>
                                                                            }
                                                                            else
                                                                            {
                                                                                <span class="label label-danger"><i class="fa fa-check"></i> Validée</span>
                                                                            }

                                                                        </td>
                                                                        <td>
                                                                            @item.DO_Piece
                                                                        </td>
                                                                        <td>
                                                                            @item.DO_Date.ToString("dd/MM/yyyy")
                                                                        </td>
                                                                        <td>@item.DO_Ref</td>

                                                                        <td>
                                                                            @String.Format("{0:N3}", item.DO_totalTTC) TND
                                                                        </td>

                                                                        <td>

                                                                            @if (@item.DO_Provenance != 2)
                                                                            {
                                                                                <a href="/GestionFactures/VisualiserFacture/@item.cbMarq" target="_blank" class="btn btn-outline btn-greenbee">
                                                                                    <i class="fa fa-eye"> Visualiser </i>
                                                                                </a>
                                                                            }

                                                                            else
                                                                            {
                                                                                <a href="/GestionFactures/VisualiserFactureAvoir/@item.cbMarq" target="_blank" class="btn btn-outline btn-greenbee">
                                                                                    <i class="fa fa-eye"> Visualiser </i>
                                                                                </a>
                                                                            }
                                                                        </td>
                                                                    </tr>

                                                                }
                                                            </tbody>
                                                        </table>
                                                    }


                                                </div>
                                                <!-- Commercial-->
                                                <div class="tab-pane" id="ReglementsClient">

                                                    @if (ViewBag.Reglements == null)
                                                    {
                                                        <p>Aucune Avance   </p>

                                                    }
                                                    else
                                                    {
                                                        <table class="table table-striped">
                                                            <thead>
                                                                <tr>

                                                                    <th>N° Pièce</th>
                                                                    <th>Montant </th>
                                                                    <th>Date </th>
                                                                    <th>Voir reçu </th>

                                                                </tr>
                                                            </thead>

                                                            <tbody>


                                                                @foreach (var item in ViewBag.Reglements)
                                                                {

                                                                    <tr>
                                                                        <td>
                                                                            @item.DO_Piece
                                                                        </td>
                                                                        <td>
                                                                            @String.Format("{0:N3}", (decimal)(item.DO_MontantTTC))
                                                                        </td>
                                                                        <td>
                                                                            @item.DO_Date
                                                                        </td>
                                                                        @*<td>
                                                                                <a href="/DocumentsAbonnements/RecuReglementAb"+@item.cbMarq".pdf" target="_blank"> Voir </a>
                                                                            </td>*@

                                                                    </tr>
                                                                }
                                                            </tbody>
                                                        </table>
                                                    }


                                                </div>

                                                <!-- Articles Materiel -->
                                                <div class="tab-pane" id="ArticlesMateriel">
                                                    @if (ViewBag.ArtPACK.Count == 0)
                                                    {
                                                        <p>Aucun Matériel réservé pour cet abonnement. </p>
                                                    }
                                                    else if (Model.Resilie == 1)
                                                    {
                                                        <table class="table table-striped">
                                                            <thead>
                                                                <tr>
                                                                    <th>Référence Article</th>
                                                                    <th>Designation</th>
                                                                    <th>Numéro Série </th>
                                                                    <th>Depot Retour </th>
                                                                    <th>Action</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                @foreach (var item1 in ViewBag.reservationmat)
                                                                {
                                                                    if (item1.AR_Type == 0 && item1.LS_NoSerie != null)
                                                                    {
                                                                        <tr>
                                                                            <td>
                                                                                <span class="label label-greenbee">
                                                                                    <i class="fa fa-shopping-cart"></i> @item1.AR_Ref
                                                                                </span>
                                                                            </td>
                                                                            <td>
                                                                                @item1.DL_Design
                                                                            </td>

                                                                            <td>
                                                                                @item1.LS_NoSerie
                                                                            </td>
                                                                            <td>
                                                                                @if (ViewBag.ListOfAgences != null)
                                                                                {
                                                                                    <select class="form-control chosen-select" name="A_CodeLivraison" id="A_CodeLivraison">

                                                                                        @foreach (var item in ViewBag.ListOfAgences)
                                                                                        {
                                                                                            if (item.Value == Model.A_CodeLivraison)
                                                                                            {
                                                                                                <option value="@item.Value" Selected>@item.Text</option>
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                <option value="@item.Value">@item.Text</option>
                                                                                            }
                                                                                        }
                                                                                    </select>
                                                                                }


                                                                            </td>
                                                                            <td>
                                                                                @if (item1.DL_Someil == 0 && item1.DL_Valorise == 0)
                                                                                {
                                                                                    <div class="form-group col-md-4">
                                                                                        <button type="button" class="btn btn-graybee" title="Retour matériels" onClick="BonRetourLigneMateriel(@item1.cbMarq);">
                                                                                            <i class="fa fa-edit"></i>
                                                                                        </button>
                                                                                    </div>
                                                                                }
                                                                                else if (ViewBag.bonretour != null)
                                                                                {
                                                                                    if (item1.DL_Someil == 0 && item1.DL_Valorise == 1)
                                                                                    {
                                                                                        <span>Materiel retourné</span>
                                                                                    }
                                                                                }


                                                                            </td>
                                                                        </tr>
                                                                    }
                                                                }
                                                            </tbody>
                                                        </table>

                                                    }
                                                    else
                                                    {
                                                        <table class="table table-striped">
                                                            <thead>
                                                                <tr>
                                                                    <th>Référence Article</th>
                                                                    <th>Designation</th>
                                                                    <th>Numéro Série </th>
                                                                    <th>Statut </th>
                                                                    <th><center>Action</center></th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                @foreach (var item in ViewBag.ArtPACK)
                                                                {
                                                                    if (item.AR_Type == 0 && item.AR_Ref != "FRAIS_INSTALLATION" && item.AR_Ref != "FRAIS_RACCORDEMENT" && item.AR_Ref != "FRAIS_DEMENAGEMENT")
                                                                    {
                                                                        <tr>
                                                                            <td>
                                                                                <span class="label label-greenbee">
                                                                                    <i class="fa fa-shopping-cart"></i> @item.AR_Ref
                                                                                </span>
                                                                            </td>
                                                                            <td>
                                                                                @item.DL_Design
                                                                            </td>
                                                                            <td>
                                                                                <input type="text" id="LS_NoSerie" name="LS_NoSerie" value="@item.LS_NoSerie" hidden />

                                                                                @item.LS_NoSerie
                                                                            </td>
                                                                            <td>

                                                                                @if (item.TypeAbonnement != 1)
                                                                                {

                                                                                    if (ViewBag.StatutLotSerie != null)
                                                                                    {
                                                                                        int i = 0;


                                                                                        foreach (var item2 in ViewBag.StatutLotSerie)
                                                                                        {


                                                                                            if (item.LS_NoSerie == item2.LS_NoSerie && item2.StatutArticle != null && i == 0)
                                                                                            {

                                                                                                if (ViewBag.ListOfStatutNS != null)
                                                                                                {

                                                                                                    @*<input type="text" id="ValueOfNS" name="ValueOfNS" value="@item.LS_NoSerie" hidden />*@
                                                                                                    <select class="form-control chosen-select" name="ListOfStatutNS" id="ListOfStatutNS">

                                                                                                        @foreach (var item3 in ViewBag.ListOfStatutNS)
                                                                                                        {

                                                                                                            if (item3.Intitule == item2.StatutArticle)
                                                                                                            {
                                                                                                                <option value="@item3.cbMarq" selected>@item3.Intitule</option>
                                                                                                            }
                                                                                                            else
                                                                                                            {
                                                                                                                <option value="@item3.cbMarq">@item3.Intitule</option>
                                                                                                            }


                                                                                                        }
                                                                                                    </select>

                                                                                                    i = i + 1;

                                                                                                }
                                                                                            }
                                                                                        }

                                                                                        if (i == 0)
                                                                                        {
                                                                                            if (ViewBag.ListOfStatutNS != null)
                                                                                            {

                                                                                                @*<input type="text" id="ValueOfNS" name="ValueOfNS" value="@item.LS_NoSerie" hidden />*@
                                                                                                <select class="form-control chosen-select" name="ListOfStatutNS" id="ListOfStatutNS">

                                                                                                    @foreach (var item3 in ViewBag.ListOfStatutNS)
                                                                                                    {

                                                                                                        if (item3.isDefaut == true)
                                                                                                        {
                                                                                                            <option value="@item3.cbMarq" selected>@item3.Intitule</option>
                                                                                                        }
                                                                                                        else
                                                                                                        {
                                                                                                            <option value="@item3.cbMarq">@item3.Intitule</option>
                                                                                                        }


                                                                                                    }
                                                                                                </select>



                                                                                            }
                                                                                        }



                                                                                    }
                                                                                }


                                                                            </td>

                                                                            <td>
                                                                                @*<center>
                                                                                    <button type="button" class="btn btn-purplebee ladda-button ladda-button-demo" onclick="Changer(this)">
                                                                                    <span class="glyphicon glyphicon-pencil"></span>
                                                                                     Modifier
                                                                                    </button>
                                                                                    </center>*@
                                                                                <div class="form-group col-md-4">
                                                                                    <button type="button" class="btn btn-graybee" title="Modifier statut" onclick="ChangerStatutNS(this)">
                                                                                        <i class="fa fa-edit"></i>
                                                                                    </button>
                                                                                </div>
                                                                            </td>


                                                                        </tr>
                                                                    }
                                                                }
                                                            </tbody>
                                                        </table>
                                                    }
                                                </div>




                                                <!-- Services en sus -->
                                                <div class="tab-pane" id="ArticlesEnSUS">
                                                    <div class="alert alert-warning">
                                                        Prenez en considération, si vous rajouter des abonnement en SUS sur cet abonnement, un nouvel abonnement SUS sera créer.
                                                        Seulement si vous rajouter les SUS le même jour que la création de cet abonnement en cours.
                                                    </div>


                                                    <button type="button" class="btn btn-warning btn-rounded  pull-right" data-toggle="modal" data-target="#AjouterAboSus">
                                                        <i class="fa fa-pencil"></i>
                                                    </button>


                                                    @if (ViewBag.ArticlesSus.Count == 0)
                                                    {
                                                        <p>Aucun article en SUS </p>
                                                    }
                                                    else
                                                    {
                                                        <table class="table table-striped">
                                                            <thead>
                                                                <tr>
                                                                    <th>Référence Article</th>
                                                                    <th>Designation</th>
                                                                    <th>Référence TT </th>
                                                                    <th>Montant TTC</th>

                                                                </tr>
                                                            </thead>

                                                            <tbody>


                                                                @foreach (var item in ViewBag.ArticlesSus)
                                                                {
                                                                    <tr>
                                                                        <td>
                                                                            <span class="label label-warning"><i class="fa fa-check"></i> @item.AR_Ref</span>
                                                                        </td>
                                                                        <td>
                                                                            @item.DL_Design
                                                                        </td>
                                                                        <td>
                                                                            @item.DO_Ref
                                                                        </td>
                                                                        <td>
                                                                            @item.DL_MontantTTC
                                                                        </td>
                                                                        <td>
                                                                            @*<button class="btn btn-sm" type="button"><i class="fa fa-remove"></i></button>*@
                                                                        </td>
                                                                    </tr>
                                                                }

                                                            </tbody>
                                                        </table>
                                                    }
                                                </div>
                                                <!-- Services inclus -->
                                                <div class="tab-pane" id="ServicesInclus">
                                                    @if (ViewBag.ServicesInclus.Count == 0)
                                                    {
                                                        <p>Aucun service inclu </p>
                                                    }
                                                    else
                                                    {
                                                        <table class="table table-striped">
                                                            <thead>
                                                                <tr>
                                                                    <th>Référence Article</th>
                                                                    <th>Designation</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                @foreach (var item in ViewBag.ServicesInclus)
                                                                {
                                                                    <tr>
                                                                        <td>
                                                                            <span class="label label-warning"><i class="fa fa-check"></i> @item.AR_Ref</span>
                                                                        </td>
                                                                        <td>
                                                                            @item.DL_Design
                                                                        </td>
                                                                        <td>
                                                                        <td>
                                                                            @*<button class="btn btn-sm" type="button"><i class="fa fa-remove"></i></button>*@
                                                                        </td>
                                                                    </tr>
                                                                }
                                                            </tbody>
                                                        </table>
                                                    }
                                                </div>
                                                <!-- suivis-->
                                                <div class="tab-pane" id="tab-Suivi">
                                                    <div class="row" style="overflow:scroll;height:500px;">
                                                        <div class="ibox ">

                                                            <div class="ibox-content">

                                                                <div class="activity-stream full-height-scroll">
                                                                    <table class="table table-striped">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Statut</th>
                                                                                <th>Détails</th>
                                                                                <th>Date </th>
                                                                                <th>Utilisateur</th>

                                                                                <th>Notes</th>
                                                                            </tr>
                                                                        </thead>

                                                                        <tbody>

                                                                            @foreach (var item in ViewBag.ListAction)
                                                                            {
                                                                                <tr>
                                                                                    <td>
                                                                                        @if (item.AC_Etat == 0)
                                                                                        {
                                                                                            <span class="label label-warning-light"><i class="fa fa-history"></i></span>


                                                                                        }
                                                                                        else if (item.AC_Etat == 1)
                                                                                        {

                                                                                            <span class="label label-primary"><i class="fa fa-history"></i></span>

                                                                                        }
                                                                                        else if (item.AC_Etat == 2)
                                                                                        {
                                                                                            <span class="label label-warning"><i class="fa fa-history"></i></span>


                                                                                        }
                                                                                        else if (item.AC_Etat == 3)
                                                                                        {
                                                                                            <span class="label label-success"><i class="fa fa-history"></i></span>


                                                                                        }
                                                                                        else if (item.AC_Etat == 4)
                                                                                        {
                                                                                            <span class="label label-danger"><i class="fa fa-history"></i></span>


                                                                                        }
                                                                                        else if (item.AC_Etat == 5)
                                                                                        {
                                                                                            <span class="label label-danger"><i class="fa fa-history"></i></span>


                                                                                        }
                                                                                        else
                                                                                        {

                                                                                            <span class="label label-primary"><i class="fa fa-warning"></i></span>

                                                                                        }
                                                                                    </td>

                                                                                    <td>@item.AC_Commentaire </td>
                                                                                    <td>@item.cbModification</td>
                                                                                    <td>@item.cbCreateur</td>

                                                                                    <td>
                                                                                        @item.AC_Notes
                                                                                    </td>

                                                                                </tr>

                                                                            }
                                                                        </tbody>
                                                                    </table>

                                                                </div>
                                                            </div>

                                                        </div>
                                                    </div>



                                                </div>
                                                <!-- Remarques -->
                                                <div class="tab-pane" id="tab-remarque">
                                                    <div class="row full-height-scroll" style="overflow:scroll;height:500px;">
                                                        @if (ViewBag.ListRemarque.Count == 0)
                                                        {
                                                            <p> Aucune Remarque </p>
                                                        }
                                                        else
                                                        {
                                                            <div class="wrapper wrapper-content animated fadeInUp full-height-scroll" style="overflow:scroll;height:500px;">
                                                                @foreach (var item in ViewBag.ListRemarque)
                                                                {



                                                                    <ul class="notes ">
                                                                        <li>

                                                                            <div style="background:#ffc ">
                                                                                <small>@item.RQ_Date</small>
                                                                                <h4>@item.RQ_Sujet</h4>
                                                                                <p>@item.RQ_Description</p>
                                                                                <p style="margin-left:60%;margin-top:15%">@item.cbCreateur</p>

                                                                                @if (User.IsInRole("Admin") || User.IsInRole("Supprimer remarque"))
                                                                                {
                                                                                    <button type="button" class="btn btn-graybee" title="Supprimer remarque" onClick="SupprimerRemarque(@item.cbMarq);">
                                                                                        <i class="fa fa-trash"></i>
                                                                                    </button>
                                                                                }
                                                                            </div>

                                                                        </li>

                                                                    </ul>

                                                                }
                                                            </div>
                                                        }
                                                    </div>
                                                    <button type="button" class="btn btn-warning btn-rounded  pull-right" data-toggle="modal" data-target="#NouvRemarque">
                                                        <i class="fa fa-pencil"></i>
                                                    </button>
                                                </div>
                                            </div>

                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>






                }
            </div>
        </div>
        <div class="col-lg-3">


            @Html.Action("TimelineAbonnement", "Abonnement", new { id = Model.cbMarq })
        </div>
    </div>
    @using (Html.BeginForm("RetourMatrielMigration", "Abonnement", FormMethod.Post, new { id = "popupForm" }))
    {
        @Html.HiddenFor(model => model.cbMarq)
        <div class="modal inmodal" id="RetourMatrielMigration" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content animated flipInX">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Ok</span></button>
                    </div>
                    @if (User.IsInRole("AffectationMaterielAbonnement") || User.IsInRole("Admin"))
                    {

                        <div class="modal-body">
                            <fieldset id="SubmitForm" class="form-horizontal bordered-row">
                                <div class="row">

                                    <p class="text-info">
                                        Veuillez retourner les Matériels liée a l'ancien Abonnement ,
                                        <small class="text-muted"> Avant la reservation du NV matériels.  </small>
                                    </p>
                                    <hr />
                                    @if (TempData["MSGNS"] != null)
                                    {
                                        <br />
                                        <div class="alert alert-warning alert-dismissable">
                                            <button type="button" class="close " data-dismiss="alert"> × </button>
                                            <p class="text-danger">@TempData["MSGNS"]</p>
                                        </div>

                                    }


                                    @if (TempData["MSGBRR"] != null)
                                    {
                                        <br />
                                        <div class="alert alert-warning alert-dismissable">
                                            <button type="button" class="close " data-dismiss="alert"> × </button>
                                            <p class="text-danger">@TempData["MSGBRR"]</p>
                                        </div>

                                    }
                                    @if (ViewBag.listeMaterielAncienABo != null)
                                    {
                                        int i = 0;
                                        @*<h3 class="text-info float-e-margins m-l-lg">  matériel liée  pour l'ancien abonnement </h3>*@
                                        foreach (var kk in ViewBag.listeMaterielAncienABo)
                                        {

                                            <div class="form-group">

                                                <label class="col-sm-2 control-label">
                                                    Articles
                                                </label>
                                                <div class="col-sm-10">
                                                    <i class="fa fa-shopping-cart"></i> @kk.DL_Design
                                                </div>
                                            </div>

                                            <div class="form-group">

                                                <label class="col-sm-2 control-label">N° de série</label>

                                                <div class="col-sm-10" id="seleckIE">
                                                    <input type="text" class="form-control" id="LotSerie[@i]" name="LotSerie[@i]">

                                                </div>

                                            </div>

                                            i = i + 1;
                                        }
                                    }
                                </div>

                                <div class="modal-footer">

                                    <button type="submit" class="btn btn-greenbee ladda-button ladda-button-demo" name="cmd"><i class="fa fa-check"></i>&nbsp;Enregistrer les modifications</button>
                                </div>


                            </fieldset>

                        </div>
                    }
                    else
                    {

                        <div class="modal-body">
                            <div class="alert alert-warning">
                                Vous ne pouvez pas réserver de matériel.
                            </div>
                        </div>

                    }

                </div>
            </div>
        </div>


    }
    @using (Html.BeginForm("ReservationMateriels", "Abonnement", FormMethod.Post, new { id = "popupForm" }))
    {
        @Html.HiddenFor(model => model.cbMarq)
        <div class="modal inmodal" id="ModifierAboMiseEnservice" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content animated flipInX">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Ok</span></button>
                    </div>
                    @if (User.IsInRole("AffectationMaterielAbonnement") || User.IsInRole("Admin"))
                    {

                        <div class="modal-body">
                            <div class="alert alert-success alert-dismissable hidden" id="alertAppro">
                                <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
                                La demande d'appro. à été envoyé avec succès ! une notification vous sera envoyée dès que l'article est disponible dans votre stock.

                                <br /> Cliquez <a class="alert-link" href="" id="hrefAppro"> ici </a> pour voir la demande d'appro. envoyée.
                            </div>

                            <fieldset id="SubmitForm" class="form-horizontal bordered-row">
                                <div class="row">
                                    <div class="alert alert-success alert-dismissable hidden" id="alertAppro">
                                        <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
                                        La demande d'appro. à été envoyé avec succès ! une notification vous sera envoyée dès que l'article est disponible dans votre stock.

                                        <br /> Cliquez <a class="alert-link" href="" id="hrefAppro"> ici </a> pour voir la demande d'appro. envoyée.
                                    </div>
                                    <p class="text-info">
                                        Cet abonnement sera mis en service TT
                                        <small class="text-muted"> Un contrat sera généré à partir les informations entrées.  </small>
                                    </p>
                                    <hr />

                                    @if (Model.DO_Valide == 1)
                                    {
                                        <div class="alert alert-warning">
                                            <p>  Les articles attachés à cet abonnement : </p>
                                            <br />
                                            @foreach (var item in ViewBag.ArticlesAttribues)
                                            {
                                                <i class="fa fa-shopping-cart"></i> @item.AR_Ref
                                                <br />
                                            }

                                        </div>
                                    }
                                    else
                                    {
                                        if (ViewBag.ArticleAr_ref.Count != 0)
                                        {
                                            int i = 0;
                                            if (ViewBag.MaterielLies.Count != 0)
                                            {

                                                <h3 class="text-info float-e-margins m-l-lg"> Réservation matériel pour l'abonnement </h3>
                                               foreach (var kk in ViewBag.MaterielLies)
                                                //foreach (var kk in ViewBag.List)
                                                {
                                                    if ((kk.AR_SuiviStock == 3 || kk.AR_SuiviStock == 2))
                                                    {
                                                        <div class="form-group">

                                                            <label class="col-sm-2 control-label">
                                                                Articles
                                                            </label>
                                                            <div class="col-sm-10">
                                                                <select data-placeholder="Choisir des articles..."
                                                                        id="ReservationMateriel[@i]" name="ReservationMateriel[@i]" class="form-control">
                                                                    @if (ViewBag.MaterielLies != null)
                                                                    {

                                                                        <option value="@kk.AR_Ref">@kk.AR_Design</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="null">Aucun</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>
                                                        if (kk.AR_SuiviStock == 3)
                                                        {
                                                        <div class="form-group">

                                                            <label class="col-sm-2 control-label">N° de série</label>

                                                            <div class="col-sm-10" id="seleckIE">
                                                                <select class="form-control chosen-select" id="LotSerie[@i]" name="LotSerie[@i]" data-placeholder="Choisir les références...">


                                                                    @if (ViewBag.NumMaterielsReservesLies.Count != 0)
                                                                    {
                                                                        for (var j = 0; j < ViewBag.NumMaterielsReservesLies.Count; j++)
                                                                        {
                                                                            if (ViewBag.NumMaterielsReservesLies[j].AR_Ref == kk.AR_Ref)
                                                                            {
                                                                                <option style="background-color:#4D57A6;" class="text-white form-control" selected="selected" value="@ViewBag.NumMaterielsReservesLies[j].LS_NoSerie">@ViewBag.NumMaterielsReservesLies[j].LS_NoSerie</option>

                                                                            }

                                                                        }

                                                                    }
                                                                    @if (ViewBag.LotSerieDepotLies.Count != 0)
                                                                    {

                                                                        <optgroup label="Dépôt Revendeur">
                                                                            @if (ViewBag.LotSerieDepotLies[i].LS_NoSerie != null)
                                                                            {
                                                                                foreach (var item in ViewBag.LotSerieDepotLies[i].LS_NoSerie)
                                                                                {
                                                                                    if (item.AR_Ref == kk.AR_Ref)
                                                                                    {
                                                                                        <option class="font-bold text-greenbee" value="@item.LS_NoSerie">@item.LS_NoSerie</option>
                                                                                    }
                                                                                }
                                                                            }
                                                                        </optgroup>
                                                                    }

                                                                    @*@if (ViewBag.LotSerieDepotLies.Count != 0)
        {

            <optgroup label="Dépôt Revendeur">
                @if (ViewBag.LotSerieDepotLies[i].LS_NoSerie != null)
                {
                    foreach (var item in ViewBag.LotSerieDepotLies[i].LS_NoSerie)
                    {
                        if (item.AR_Ref == kk.AR_Ref)
                        {
                            <option class="font-bold text-greenbee" value="@item.LS_NoSerie">@item.LS_NoSerie</option>
                        }
                    }
                }
            </optgroup>
        }*@
                                                                    @*@if (ViewBag.LotSerieLies != null)
        {
            <optgroup label="Dépôt Siège" class="bg-purplebee-light">
                @if (ViewBag.LotSerieLies[i].LS_NoSerie != null)
                {
                    foreach (var aa in ViewBag.LotSerieLies[i].LS_NoSerie)
                    {
                        <option class="font-bold text-purplebee" value="@aa.LS_NoSerie">@aa.LS_NoSerie</option>
                    }
                }
            </optgroup>
        }*@
                                                                    @if (ViewBag.LotSerieLies != null)
                                                                    {
                                                                        <optgroup label="Dépôt Siège" class="bg-purplebee-light">
                                                                            @if (ViewBag.LotSerieLies[i].LS_NoSerie != null)
                                                                            {
                                                                                foreach (var aa in ViewBag.LotSerieLies[i].LS_NoSerie)
                                                                                {
                                                                                    <option class="font-bold text-purplebee" value="@aa.LS_NoSerie">@aa.LS_NoSerie</option>
                                                                                }
                                                                            }
                                                                        </optgroup>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>

                                                        }
                                                        if (ViewBag.MaterielLies.Count == 0)
                                                        {
                                                            <div class="form-group">
                                                                <label class="col-md-4 control-label">
                                                                    <p class="text-danger">  Cet article est en rupture de stock.</p>
                                                                </label>
                                                                <div class="col-md-6">
                                                                    <button type="button" class="btn btn-xs btn-success " id="envoiedemandeAppro" onclick="DemandeApproAutomatique();">Envoyer une demande d'approvisonnement </button>
                                                                </div>
                                                            </div>
                                                        }
                                                    }
                                                    i = i + 1;
                                                }
                                            }
                                            if (ViewBag.MaterielLiesProp.Count != 0)
                                            {
                                                int j = 0;
                                                <div class="form-group">

                                                    <label class="col-sm-2 control-label">
                                                        Articles Proposition
                                                    </label>
                                                    <div class="col-sm-10">
                                                        @if (ViewBag.MaterielLiesProp != null)
                                                        {
                                                        <select data-placeholder="Choisir des articles..." class="form-control" id="arRef" name="arRef[@j]">

                                                            <option>---Choisir--</option>
                                                            @foreach (var kk in ViewBag.MaterielLiesProp)
                                                            {
                                                            <option value="@kk.AR_Ref">@kk.AR_Design</option>

                                                            }
                                                        </select>
                                                                }


                                                            
                                                        </div>
                                                </div>
                                                <div class="form-group" id="NumSerieDep">


                                                </div>
                                                i = i + 1;
                                            }
                                        }
                                        else
                                        {
                                            <span> @ViewBag.AucunArticleLie</span>
                                        }

                                    }

                                </div>

                                <br />
                                <br />
                                <div class="col-md-12 float-e-margins">

                                    <div class="form-group">
                                        <label class="col-lg-4 control-label">Commentaires</label>
                                        <div class="col-lg-8">
                                            <textarea type="text" id="AC_Notes5" name="AC_Notes6" class="form-control col-sm-pull-2"></textarea>
                                        </div>
                                    </div>

                                </div>
                                <div class="modal-footer">

                                    <button type="submit" class="btn btn-greenbee ladda-button ladda-button-demo" name="cmd"><i class="fa fa-check"></i>&nbsp;Enregistrer les modifications</button>
                                </div>


                            </fieldset>

                        </div>


                    }
                    else
                    {

                        <div class="modal-body">
                            <div class="alert alert-warning">
                                Vous ne pouvez pas réserver de matériel.
                            </div>
                        </div>

                    }

                </div>
            </div>
        </div>


    }


    <!-- Modal add new note -->
    <div class="modal inmodal" id="ChangeAgenceLivraison" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content animated bounceIn">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                    <h4 class="modal-title">Changement Agence Livraison</h4>
                </div>
                @using (Html.BeginForm("ChangerAgenceLivraison", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
                {
                    <div class="modal-body">
                        @Html.HiddenFor(model => model.cbMarq)
                        <fieldset class="form-horizontal">
                            <i>Etes vous sur de vouloir changer l'agence livraison de cet abonnement  ?</i>
                            <div class="form-group ">
                                <select class="form-control chosen-select" name="A_CodeLivraison" id="A_CodeLivraison">

                                    @foreach (var item in ViewBag.ListOfAgences)
                                    {
                                        if (item.Value == Model.A_CodeLivraison)
                                        {
                                            <option value="@item.Value">@item.Text</option>
                                        }
                                        else
                                        {
                                            <option value="@item.Value">@item.Text</option>
                                        }
                                    }
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">Remarque </label>
                                <div class="col-sm-10">
                                    <textarea type="text" class="form-control" id="RemarqueChangement"></textarea>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                        <button type="submit" class="btn btn-warning">Oui </button>
                    </div>
                }
            </div>
        </div>
    </div>



    <div class="modal inmodal" id="ChangePeriodeEngage" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content animated bounceIn">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                    <h4 class="modal-title">Changement période de l'engagement</h4>
                </div>
                @using (Html.BeginForm("ChangerPeriodeEngage", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
                {
                    <div class="modal-body">
                        @Html.HiddenFor(model => model.cbMarq)
                        <fieldset class="form-horizontal">
                            <i>Etes vous sur de vouloir changer la période d'engagement pour cet abonnement ?</i>
                            <div class="form-group ">
                                <select class="form-control m-b" name="Periode_Engage" id="Periode_Engage">
                                    @if (ViewBag.Periode_Engage == 12)
                                    {
                                        <option value=12 selected>12 Mois</option>
                                        <option value=24>24 Mois</option>
                                    }
                                    else
                                    {
                                        <option value=12>12 Mois</option>
                                        <option value=24 selected>24 Mois</option>
                                    }

                                </select>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">Remarque </label>
                                <div class="col-sm-10">
                                    <textarea type="text" class="form-control" id="RemarqueChangement"></textarea>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                        <button type="submit" class="btn btn-warning">Oui </button>
                    </div>
                }
            </div>
        </div>
    </div>

</div>

@if (Model.DO_Valide == 1)
{

    <div class="modal inmodal" id="validerAbonement" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content animated flipInX">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Ok</span></button>
                    <h4 class="modal-title">Validation et paiement </h4>
                </div>
                @using (Html.BeginForm("ValiderPayerAbonnement", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
                {
                    <div class="modal-body">
                        @Html.HiddenFor(model => model.cbMarq)
                        <div class="modal-body">
                            <fieldset id="SubmitForm" class="float-e-margins">

                                <div class="row">
                                    <div class="form-group float-e-margins">
                                        <input id="Valider" name="Valider" value="0" class="hidden" />
                                        <div class="row">
                                            <div class="ibox float-e-margins">
                                                <div class="ibox-content">
                                                    <form class="form-horizontal">

                                                        <div class="alert alert-info alert-dismissable">
                                                            <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
                                                            En validant cet abonnement, vous confirmez la sortie des matériels attachés à cet abonnement.
                                                            @foreach (var item in ViewBag.ArtPACK)
                                                            {
                                                                if (item.AR_Type == 0 && item.AR_Ref != "FRAIS_INSTALLATION")
                                                                {
                                                                    <span class="label label-purplebee-light">
                                                                        @item.DL_Design
                                                                    </span>

                                                                    <span> N° Série: </span> @item.LS_NoSerie
                                                                    <br />

                                                                }
                                                            }
                                                            Liste des factures


                                                            <br /><strong>Net à payer : </strong><h3 class="label label-warning">@ViewBag.Facture TND </h3>


                                                        </div>

                                                        <div class="form-group">
                                                            <label class="col-lg-4 control-label">Choisir votre mode de paiement </label>
                                                            <div class="col-lg-8">
                                                                @*@Html.DropDownListFor(m => m.cbindice, ViewBag.ModeReglementAgence as SelectList, new { @name = "cbindice", @id = "cbindice", @class = "form-control chosen-select" })*@
                                                                <select class="col-lg-8 form-control chosen-search " id="cbIndice" name="cbIndice">
                                                                    <option class="font-bold" value="2"> Choisir </option>
                                                                    @foreach (var item in ViewBag.ModeReglementAgence)
                                                                    {
                                                                        <option class="font-bold" value="@item.Value">@item.Text</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>


                                                        <div id="ifospayement" style="display:none">
                                                            <div class="form-group">
                                                                <label class="col-lg-4 control-label">Identifiant *</label>
                                                                <div class="col-lg-8">
                                                                    <input type="text" class="form-control" name="identifiantpay" id="identifiantpay" placeholder="N° Chèque,Référence de paiement TPE , N° Compte du client," />
                                                                </div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label class="col-lg-4 control-label">Libellé</label>
                                                                <div class="col-lg-8">
                                                                    <input type="text" class="form-control" name="libelle" id="libelle" placeholder="Nom de la banque,N° Ordre de virement" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label class="col-lg-4 control-label">Description</label>
                                                                <div class="col-lg-8">
                                                                    <input type="text" class="form-control" name="description" id="description" placeholder="Titulaire du Chèque" maxlength="17" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label class="col-lg-4 control-label">Date Echéance </label>
                                                                <div class="col-lg-8">
                                                                    <input type="text" pattern="\d{1,2}/\d{1,2}/\d{4}" class="form-control" name="dateecheance" id="dateecheance" placeholder="Date d'échéance du chèque (format : jj/mm/aaaa)" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <hr />

                                                        <div class="form-group">
                                                            <label class="col-lg-4 control-label">Attachement scan contrat</label>
                                                            <div class="col-lg-8">
                                                                <div class="fileinput fileinput-new input-group" data-provides="fileinput">
                                                                    <div class="form-control" data-trigger="fileinput">
                                                                        <i class="glyphicon glyphicon-file fileinput-exists"></i>
                                                                        <span class="fileinput-filename"></span>
                                                                    </div>
                                                                    <span class="input-group-addon btn btn-default btn-file">
                                                                        <span class="fileinput-new">Selectionner</span>
                                                                        <span class="fileinput-exists">Changer</span>
                                                                        <input type="file" name="FileContact" id="FileContact" accept="image/png, image/jpeg" />
                                                                    </span>
                                                                    <a href="#" class="input-group-addon btn btn-default fileinput-exists" data-dismiss="fileinput">Supprimer</a>
                                                                </div>
                                                            </div>
                                                        </div>


                                                        <div class="form-group">
                                                            <label class="col-lg-4 control-label">Commentaires</label>
                                                            <div class="col-lg-8">
                                                                <textarea type="text" id="AC_Notes5" name="AC_Notes5" class="form-control col-sm-pull-2"></textarea>
                                                            </div>
                                                        </div>



                                                        <div class="form-group has-warning">
                                                            <label class="col-md-4 control-label">Total Facture </label>

                                                            <div class="col-md-8">
                                                                <input type="text" class="form-control" disabled value="@ViewBag.TotalFacture TND">
                                                            </div>
                                                        </div>


                                                        <div class="form-group has-success">
                                                            <label class="col-md-4 control-label">Total Règlements </label>
                                                            <div class="col-md-8">
                                                                @if (ViewBag.Reglements == null)
                                                                {
                                                                    <p> 0 TDN </p>
                                                                }
                                                                else
                                                                {
                                                                    <input type="text" class="form-control" disabled value="@String.Format("{0:N3}", (decimal)(ViewBag.ReglementsTotal)) TND">
                                                                }
                                                            </div>
                                                        </div>







                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="reset" class="btn btn-white" data-dismiss="modal">Annuler</button>
                                            <button type="submit" class="btn btn-primary ladda-button"><i class="fa fa-money"></i>Valider et payer </button>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>

}

<!-- Modal add new note -->
<div class="modal inmodal" id="NouvRemarque" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                <h4 class="modal-title">Nouvelle Note</h4>
            </div>
            <div class="modal-body">
                <fieldset class="form-horizontal">

                    <div class="form-group">
                        <label class="col-sm-4 control-label">Titre de la Note</label>
                        <div class="col-sm-8"><input type="text" class="form-control" required id="titreRemarque"></div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Description </label>
                        <div class="col-sm-8">

                            <textarea type="text" class="form-control" id="descRemarque"></textarea>
                        </div>
                    </div>

                </fieldset>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-white" data-dismiss="modal">Fermer</button>
                <button type="button" class="btn btn-warning" onclick="SaveRemarque(@Model.cbMarq)">Ajouter</button>
            </div>
        </div>
    </div>
</div>

<div class="modal inmodal" id="ShowListeReglements" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                <h4 class="modal-title">Liste des règlements </h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <form role="form">
                        <div class="form-group">
                            @if (ViewBag.ShowListeReglements == null)
                            {
                                <p>Aucune Facture </p>

                            }
                            else
                            {
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Statut</th>
                                            <th>Référence</th>
                                            <th>Date </th>
                                            <th>Montant TTC</th>
                                            <th>Type</th>
                                            <th>Action</th>
                                            <th>Voir </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in ViewBag.ShowListeReglements)
                                        {

                                            <tr>
                                                <td>
                                                    @if (item.DO_Statut == 1)
                                                    {
                                                        <span class="label label-default"><i class="fa fa-check"></i> Non versé</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="label label-success"><i class="fa fa-check"></i> Versé</span>

                                                    }


                                                </td>
                                                <td>
                                                    @item.DO_Piece
                                                </td>
                                                <td>
                                                    @item.DO_Date.ToString("dd/MM/yyyy")
                                                </td>
                                                <td>
                                                    @String.Format("{0:N3}", item.DO_MontantTTC) TND
                                                </td>

                                                <td>
                                                    @if (item.DO_ModeRegl == 2)
                                                    {
                                                        <span class="bg-greenbee">ESPECE </span>

                                                    }
                                                    else if (item.DO_ModeRegl == 1)
                                                    {
                                                        <span class="bg-greenbee">CHEQUE </span>
                                                    }
                                                    else if (item.DO_ModeRegl == 9)
                                                    {
                                                        <span class="bg-greenbee">CARTE BANCAIRE </span>

                                                    }
                                                    else if (item.DO_ModeRegl == 4)
                                                    {
                                                        <span class="bg-greenbee">VIREMENT BANCAIRE </span>

                                                    }
                                                    else if (item.DO_ModeRegl == 5)
                                                    {
                                                        <span class="bg-greenbee">GARANTIE </span>

                                                    }
                                                    else
                                                    {
                                                        <span class="bg-greenbee"> -  </span>

                                                    }
                                                </td>

                                                <td>
                                                    @if (Request.IsAuthenticated && (User.IsInRole("Admin") || User.IsInRole("Generer Contre Recu")))
                                                    {
                                                        if (item.DO_PieceContreRecu == null)
                                                        {
                                                            <div class="form-group col-md-4">
                                                                <button type="button" class="btn btn-graybee" title="Générer contre reçu" onClick="ContreRecuParReglement(@item.cbMarq);">
                                                                    <i class="fa fa-edit"></i>
                                                                </button>
                                                            </div>
                                                        }
                                                        else
                                                        {
                                                            <span class="label label-success">contre reçu générée</span>
                                                        }
                                                    }
                                                </td>

                                                <td>
                                                    <a class="btn btn-greenbee btn-circle btn-outline" title="voir le reçu de paiement "
                                                       href="@Url.Action("ImpressionRecu","GestionFactures", new { id = item.cbMarq })" target="_blank">
                                                        <i title="Imprimer Reçu " class="fa fa-print"></i>
                                                    </a>

                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            }

                        </div>
                    </form>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-greenbee" data-dismiss="modal">Fermer</button>
            </div>
        </div>
    </div>
</div>

<div class="modal inmodal" id="ListeFactures" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                <h4 class="modal-title">Liste des factures</h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <form role="form">
                        <div class="form-group">
                            @if (ViewBag.listeFactures == null)
                            {
                                <p> Aucune Facture </p>

                            }
                            else
                            {
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Type Document</th>
                                            <th>N° Pièce</th>
                                            <th>Date</th>
                                            <th>Référence</th>
                                            <th>Montant TTC</th>
                                            <th>Voir</th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        @foreach (var item in ViewBag.listeFactures)
                                        {

                                            <tr>
                                                <td>
                                                    @if (item.DO_Statut == 0)
                                                    {
                                                        <span class="label label-default"><i class="fa fa-check"></i> En Cours</span>
                                                    }
                                                    else if (item.DO_Statut == 1)
                                                    {
                                                        <span class="label label-success"><i class="fa fa-check"></i> Payée</span>

                                                    }
                                                    else if (item.DO_Statut == 2)
                                                    {
                                                        <span class="label label-info"><i class="fa fa-check"></i> Versée</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="label label-danger"><i class="fa fa-check"></i> Validée</span>
                                                    }

                                                </td>
                                                <td>
                                                    @item.DO_Piece
                                                </td>
                                                <td>
                                                    @item.DO_Date.ToString("dd/MM/yyyy")
                                                </td>
                                                <td>@item.DO_Ref</td>

                                                <td>
                                                    @String.Format("{0:N3}", item.DO_totalTTC) TND
                                                </td>

                                                <td>

                                                    @if (item.DO_Provenance == 2)
                                                    {
                                                        <a class="btn btn-purplebee btn-circle   btn-outline" title="voir la facture"
                                                           href="@Url.Action("VisualiserFactureAvoir","GestionFactures", new { id = item.cbMarq })" target="_blank">
                                                            <i title="Imprimer Facture " class="fa fa-print"></i>
                                                        </a>
                                                    }
                                                    else
                                                    {
                                                        <a class="btn btn-purplebee btn-circle   btn-outline" title="voir la facture"
                                                           href="@Url.Action("VisualiserFacture","GestionFactures", new { id = item.cbMarq })" target="_blank">
                                                            <i title="Imprimer Facture " class="fa fa-print"></i>
                                                        </a>
                                                    }

                                                </td>
                                            </tr>

                                        }
                                    </tbody>
                                </table>
                            }

                        </div>
                    </form>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-greenbee" data-dismiss="modal">Fermer</button>
            </div>
        </div>
    </div>
</div>

<!--AjouterAboSus-->
<div class="modal inmodal" id="AjouterAboSus" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                <h4 class="modal-title">Ajouter des articles en SUS</h4>
            </div>
            <div class="modal-body">
                <div class="row">

                    <form role="form">
                        <div class="form-group">
                            <label> Liste des services en SUS</label>

                            <select data-placeholder="Choisir des articles liés..." class="chosen-select" multiple style="width:350px;" tabindex="4" id="ArticleSUSList" name="ArticleSUSList">
                                @foreach (var item in ViewBag.ArticlesSusDispo)
                                {
                                    <option value = "@item.AR_Ref" > @item.AR_Design </option >
                                }
                            </select>

                        </div>
                    </form>
                </div>

            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-white" data-dismiss="modal">Fermer</button>
                <button type="button" class="btn btn-warning" onclick="SaveArticlesSUS();">Ajouter</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal add new Document   -->
<div class="modal inmodal" id="AddDoc" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Attacher Document</h4>
            </div>
            <div class="modal-body">
                <fieldset class="form-horizontal">


                    <div class="form-group">
                        <label class="col-sm-4 control-label">Intitulé</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" required id="titreDoc">


                        </div>


                    </div>



                    <div class="form-group">
                        <label class="col-sm-4 control-label">Description</label>
                        <div class="col-sm-8">
                            <textarea type="text" class="form-control" required id="DescDoc"></textarea>


                        </div>


                    </div>

                    @*<input type="file" id="FileUpload1" />*@

                    <div class="form-group">
                        <label class="col-sm-4 control-label">Attacher Fichier  </label>
                        <div class="col-sm-8">
                            <div class="fileinput fileinput-new" data-provides="fileinput">
                                <span class="btn btn-default btn-file">
                                    <span class="fileinput-new">Selectionner un fichier </span>
                                    <span class="fileinput-exists">Changer</span>

                                    <input type="file" id="FileUpload1" accept="image/gif, image/jpeg">


                                </span>
                                <span class="fileinput-filename"></span>
                                <a href="#" class="close fileinput-exists" data-dismiss="fileinput" style="float: none">&times;</a>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-white" data-dismiss="modal">Fermer</button>
                <button type="button" class="btn btn-warning" onclick="SaveDocuments(@Model.cbMarq)">Ajouter</button>
            </div>
        </div>
    </div>
</div>

@*Modal Changement date contrat*@
<div class="modal inmodal" id="Changerdatecontrat" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                <h4 class="modal-title"> Changement date contrat  </h4>
            </div>
            @using (Html.BeginForm("ChangementDateContrat", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
            {
                <div class="modal-body">
                    @Html.HiddenFor(model => model.cbMarq)
                    <fieldset class="form-horizontal">
                        <div class="form-group">
                            <label class="col-md-4 control-label">Changement date contrat </label>
                            <div class="col-md-8">
                                <input type="date" pattern="\d{1,2}/\d{1,2}/\d{4}" class="form-control" name="DO_DebutAbo" id="DO_DebutAbo">
                            </div>
                        </div>
                    </fieldset>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-purplebee  ladda-button">Valider</button>
                </div>
            }
        </div>
    </div>
</div>

@*Modal Changement date fin engagement*@
<div class="modal inmodal" id="ChangerDateFinEnga" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                <h4 class="modal-title"> Changement Date Fin Engagement </h4>
            </div>
            @using (Html.BeginForm("ChangementDateFinEngagement", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
            {
                <div class="modal-body">
                    @Html.HiddenFor(model => model.cbMarq)
                    <fieldset class="form-horizontal">
                        <div class="form-group">
                            <label class="col-md-4 control-label">Changement Date Fin Engagement </label>
                            <div class="col-md-8">
                                <input type="date" pattern="\d{1,2}/\d{1,2}/\d{4}" class="form-control" name="DO_DebutAbo" id="DO_DebutAbo">
                            </div>
                        </div>
                    </fieldset>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-purplebee  ladda-button">Valider</button>
                </div>
            }
        </div>
    </div>
</div>
@*Modal Changement date service*@
<div class="modal inmodal" id="ChangementDateService" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                <h4 class="modal-title"> Changement Date mise en service </h4>
            </div>
            @using (Html.BeginForm("ChangementDateService", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
            {
                <div class="modal-body">
                    @Html.HiddenFor(model => model.cbMarq)
                    <fieldset class="form-horizontal">
                        <div class="form-group">
                            <label class="col-md-4 control-label">Changement Date mise en service </label>
                            <div class="col-md-8">
                                <input type="date" pattern="\d{1,2}/\d{1,2}/\d{4}" class="form-control" name="AB_DebutPeriod" id="AB_DebutPeriod">
                            </div>
                        </div>
                    </fieldset>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-purplebee  ladda-button">Valider</button>
                </div>
            }
        </div>
    </div>
</div>
<!-- Modal changer code gps -->
<div class="modal inmodal" id="ChangerCodeGPS" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated bounceIn">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                <h4 class="modal-title">Changement code GPS</h4>
            </div>
            @using (Html.BeginForm("ChangerCodeGPS", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
            {
                <div class="modal-body">
                    @Html.HiddenFor(model => model.cbMarq)
                    <fieldset class="form-horizontal">
                        <i>Etes vous sur de vouloir changer le code GPS ?</i>

                        <div class="row">
                            <div class="form-group">
                                <label class="col-md-4 control-label">Code GPS <sup>*</sup></label>
                                <div class="col-md-8">
                                    <div class="input-group">
                                        <span class="input-group-btn">
                                            <a href="https://www.tunisietelecom.tn/Fr/R%C3%A9seau/myaddress-code" class="btn btn-purplebee" target="_blank">Me localiser</a>
                                        </span>
                                        <input type="text" class="form-control" name="CodeGPS" id="CodeGPS" required value="@Model.CodeGPS">
                                    </div>
                                </div>
                            </div>

                        </div>
                    </fieldset>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-warning">Oui </button>
                </div>
            }
        </div>
    </div>
</div>

<div class="modal inmodal" id="ActiverRadius" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated fadeIn">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Radius</h4>
            </div>
            @using (Html.BeginForm("RecallRadiusAbonnement", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
            {
                <div class="modal-body">
                    @Html.HiddenFor(model => model.cbMarq)
                    <div class="form-group">
                        <h3>Vous voulez réactiver le modem ?</h3>
                        <input id="id" name="id" value="@Model.cbMarq" hidden />
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Non</button>
                    <button type="submit" class="btn btn-purplebee ladda-button">Oui </button>
                </div>
            }
        </div>
    </div>
</div>

<div class="modal inmodal" id="ResilieAbo" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated fadeIn">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Choisir motif de résiliation</h4>
            </div>
            @using (Html.BeginForm("ResilieAbonnement", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
            {
                <div class="modal-body">
                    @Html.HiddenFor(model => model.cbMarq)
                    <div class="form-group">
                        <label class="control-label">Motif</label>
                        <div class="">
                            <select class="col-md-6 form-control chosen-select Motif_Annulation" id="Motif_Annulation" name="Motif_Annulation">
                                <option class="font-bold" value="Aucun motif"> Aucun motif </option>
                                @if (ViewBag.MotifResiliation != null)
                                {
                                    foreach (var item in ViewBag.MotifResiliation)
                                    {
                                        <option class="font-bold" value="@item.Motif"> @item.Motif </option>
                                    }
                                }
                            </select>

                        </div>
                    </div>



                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Non</button>
                    <button type="submit" class="btn btn-purplebee ladda-button">Oui </button>
                </div>
            }
        </div>
    </div>
</div>
<!-- Modal Changement periodicite paiement    -->
<div class="modal inmodal" id="ChangementPeriodiciteModel" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                <i class="fa fa-refresh modal-icon"></i>
                <h4 class="modal-title">Modifier les paramètres de l'abonnement </h4>
            </div>
            @using (Html.BeginForm("ChangerParametreAbonnement", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
            {


                @Html.HiddenFor(model => model.cbMarq)
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="fa fa-info fa-fw"></i>  Notez que tout changement de périodicité ou de prix ne sera pris en considération qu'à partir la prochaine facture.
                    </div>

                    <div class="form-group">
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Changement de fréquence de paiement</label>

                            <div class="col-sm-8">
                                <select class="form-control m-b" name="Frequence" id="Frequence">
                                    @switch (Model.Abo_Freq)
                                    {
                                        case 1:
                                            <option value=1 selected>Mensuelle</option>
                                            <option value=3>Trimestrielle</option>
                                            <option value=6>Semestrielle </option>
                                            <option value=12>Annuelle</option>
                                            <option value=24>24 Mois</option>

                                            break;
                                        case 3:
                                            <option value=1>Mensuelle</option>
                                            <option value=3 selected> Trimestrielle</option>
                                            <option value=6>Semestrielle </option>
                                            <option value=12>Annuelle</option>
                                            <option value=24>24 Mois</option>

                                            break;
                                        case 6:
                                            <option value=1>Mensuelle</option>
                                            <option value=3>Trimestrielle</option>
                                            <option value=6 selected> Semestrielle </option>
                                            <option value=12>Annuelle</option>
                                            <option value=24>24 Mois</option>

                                            break;
                                        case 12:
                                            <option value=1>Mensuelle</option>
                                            <option value=3>Trimestrielle</option>
                                            <option value=6>Semestrielle </option>
                                            <option value=12 selected>Annuelle</option>
                                            <option value=24>24 Mois</option>

                                            break;
                                        case 24:
                                            <option value=1>Mensuelle</option>
                                            <option value=3>Trimestrielle</option>
                                            <option value=6>Semestrielle </option>
                                            <option value=12>Annuelle</option>
                                            <option value=24 selected>24 Mois</option>

                                            break;
                                    }

                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">Période d'engagement</label>

                            <div class="col-sm-8">
                                <select class="form-control m-b" name="Periode_Engage" id="Periode_Engage">
                                    @if (ViewBag.Periode_Engage == 12)
                                    {
                                        <option value=12 selected>12 Mois</option>
                                    }
                                    else
                                    {
                                        <option value=24 selected>24 Mois</option>
                                    }

                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-4 control-label">Prix HT de l'offre </label>

                            <div class="col-sm-8">
                                <div class="input-group m-b">
                                    <span class="input-group-addon">$</span>
                                    <input type="text" pattern="\d*([,\/]?\d+)" class="form-control" name="DL_Prix" id="DL_Prix" value="@ViewBag.ArtPACKService.DL_PrixUnitaire">
                                    <span class="input-group-addon">HT</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-4 control-label">Notes </label>

                            <div class="col-sm-8">
                                <div class="input-group m-b">
                                    <textarea placeholder="Commentaires " class="form-control" id="CommentaireChangement" name="CommentaireChangement"></textarea>
                                </div>
                            </div>
                        </div>


                    </div>


                </div>


                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Fermer</button>
                    <button type="submit" class="btn btn-purplebee ladda-button" id="ValiderChangFreq">Valider </button>
                </div>
            }

        </div>
    </div>
</div>

<!--Confirmation facturation-->

@*<div class="modal inmodal" id="ModifierAboConfirmerFact" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                <h4 class="modal-title"> Facturation </h4>
            </div>
            <div class="modal-body">
                <fieldset class="form-horizontal">
                    <div class="alert alert-info">
                        <code>pour générer la  première facture ,aller à la liste en instance de facturation. <a href="/ListeAboEnInstanceFacturation/Index"> clic ici</a></code>

                    </div>
                </fieldset>
            </div>
        </div>

    </div>
</div>*@




<div class="modal inmodal" id="AnnulerAbo" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated fadeIn">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Choisir motif d'annulation</h4>
            </div>
            @using (Html.BeginForm("AnnulerAbonnement", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
            {
                <div class="modal-body">
                    @Html.HiddenFor(model => model.cbMarq)
                    <div class="form-group">
                        <label class="control-label">Motif</label>
                        <div class="">
                            <select class="col-md-6 form-control chosen-select Motif_Annulation" id="Motif_Annulation" name="Motif_Annulation">
                                <option class="font-bold" value="Aucun motif"> Aucun motif </option>

                                @if (ViewBag.liste != null)
                                {
                                    foreach (var item in ViewBag.Motifannulation)
                                    {
                                        <option class="font-bold" value="@item.Motif"> @item.Motif </option>
                                    }
                                }
                            </select>

                        </div>
                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Non</button>
                    <button type="submit" class="btn btn-purplebee ladda-button">Oui </button>
                </div>
            }
        </div>
    </div>
</div>


<!-- Modal generer facture  -->
<div class="modal inmodal" id="ChangerInformationAbonnement" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                <h4 class="modal-title"> Changement information abonnement  </h4>
            </div>
            @using (Html.BeginForm("ValiderChangementDebit", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
            {
                <div class="modal-body">
                    @Html.HiddenFor(model => model.cbMarq)


                    <fieldset class="form-horizontal">
                        @if (ViewBag.PrixSusPeriode.Count != 0)
                        {
                            <div class="alert alert-info">
                                Pour les abonnements SUS, vous pouvez payer selon une périodicité différente .
                            </div>
                            <div class="form-group">
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered table-hover dataTables-example" id="listeAbo">
                                        <thead>
                                            <tr>
                                                @* AR_Ref, string AR_Design, decimal? Prix, decimal? Prix1, decimal? Prix2, decimal? Prix3, short? Periodicite)*@
                                                <th>Article </th>
                                                <th>Période </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var item in ViewBag.PrixSusPeriode)
                                            {
                                                <tr class="gradeX">
                                                    <td rowspan="4" style="vertical-align : middle;" class="center-orientation"><span class="label bg-purplebee ">@item.AR_Design</span></td>
                                                </tr>
                                                <tr>
                                                    <td>Paiement normal : @String.Format("{0:N2}", item.Prix * Model.Abo_Freq) DT </td>
                                                </tr>
                                                <tr>
                                                    @* <td><li><i class="fa fa-circle text-danger"></i> @*Paiement Trimestriel : @String.Format("{0:N2}", item.Prix)    <input type="checkbox" /></li></td>*@
                                                    <td>Paiement Semestriel : @String.Format("{0:N2}", item.Prix2 * 6) DT </td>
                                                </tr>
                                                <tr>
                                                    <td>Paiement Annuel : @String.Format("{0:N2}", item.Prix3 * 12) DT </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                                <hr />
                                <div class="form-group">
                                    <div class="col-sm-12">
                                        <label class="checkbox-inline">
                                            <input type="radio" checked="checked" value=@Model.Abo_Freq name="PeriodiciteSUS">Normal <span class="label bg-greenbee">@String.Format("{0:N2}", ViewBag.SumP1 * Model.Abo_Freq)DT </span>
                                        </label>
                                        <label class="checkbox-inline">
                                            <input type="radio" value=6 name="PeriodiciteSUS">6 Mois <span class="label bg-greenbee">@String.Format("{0:N2}", ViewBag.SumP2 * 6)DT</span>
                                        </label>
                                        <label class="checkbox-inline">
                                            <input type="radio" value=12 name="PeriodiciteSUS">12 Mois <span class="label bg-greenbee">@String.Format("{0:N2}", ViewBag.SumP3 * 12)DT </span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="alert alert-info">
                                Une première facture sera générée.

                            </div>
                        }
                        <div class="form-group">
                            <label class="col-sm-4 control-label">
                                Fréquence de paiement <br />
                            </label>
                            <div class="col-sm-8">
                                <div>
                                    <label>
                                        @if (Model.Abo_Freq == 1)
                                        {
                                            <input class="checkbox-inline i-checks" type="radio" checked="" value="1" id="Abo_Freq" name="Abo_Freq"> <span>1 mois </span>
                                        }
                                        else
                                        {
                                            <input class="checkbox-inline i-checks" type="radio" value="1" id="Abo_Freq" name="Abo_Freq"> <span> 1 mois </span>
                                        }
                                    </label>
                                    <label>
                                        @if (Model.Abo_Freq == 3)
                                        {
                                            <input class="checkbox-inline i-checks" type="radio" checked="" value="3" id="Abo_Freq" name="Abo_Freq"> <span>3 mois </span>
                                        }
                                        else
                                        {
                                            <input class="checkbox-inline i-checks" type="radio" value="3" id="Abo_Freq" name="Abo_Freq"> <span> 3 mois </span>
                                        }
                                    </label>
                                    <label>
                                        @if (Model.Abo_Freq == 6)
                                        {
                                            <input class="checkbox-inline i-checks" type="radio" checked="" value="6" id="Abo_Freq" name="Abo_Freq"> <span>6 mois </span>
                                        }
                                        else
                                        {
                                            <input class="checkbox-inline i-checks" type="radio" value="6" id="Abo_Freq" name="Abo_Freq"> <span>6 mois </span>
                                        }
                                    </label>
                                    <label>
                                        @if (Model.Abo_Freq == 12)
                                        {
                                            <input class="checkbox-inline i-checks" type="radio" checked="" value="12" id="Abo_Freq" name="Abo_Freq"> <span>12 mois </span>
                                        }
                                        else
                                        {
                                            <input class="checkbox-inline i-checks" type="radio" value="12" id="Abo_Freq" name="Abo_Freq"> <span> 12 mois </span>
                                        }
                                    </label>


                                    <label>
                                        @if (Model.Abo_Freq == 24)
                                        {
                                            <input class="checkbox-inline i-checks" type="radio" checked="" value="24" id="Abo_Freq" name="Abo_Freq"> <span>24 mois </span>
                                        }
                                        else
                                        {
                                            <input class="checkbox-inline i-checks" type="radio" value="24" id="Abo_Freq" name="Abo_Freq"> <span> 24 mois </span>
                                        }
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-4 control-label">
                                Remise Premiere facture
                            </label>
                            <div class="col-sm-8">
                                <input class="form-control" type="text" value="@String.Format("{0:N2}", ViewBag.ArtPACKService.DL_Remise02REM_Valeur)" name="DL_Remise02REM_Valeur" id="DL_Remise02REM_Valeur" pattern="\d*([,\/]?\d+)">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-4 control-label">
                                Remise n°eme factures
                            </label>
                            <div class="col-sm-8">
                                <input class="form-control" type="text" value="@String.Format("{0:N2}", ViewBag.ArtPACKService.DL_RemiseValeur)" name="DL_RemiseValeur" id="DL_RemiseValeur" pattern="\d*([,\/]?\d+)">
                            </div>
                            <label class="col-sm-4 control-label">Date fin remise</label>

                            <div class="col-sm-8">
                                @if (ViewBag.ArtPACKService.DL_DateFinRemise != null)
                                {
                                    @*<input type="date" pattern="\d{1,2}/\d{1,2}/\d{4}" class="form-control" name="DL_DateFinRemise" id="DL_DateFinRemise" value="@ViewBag.ArtPACKService.DL_DateFinRemise.ToString("dd/MM/yyyy")" />*@
                                    @*<input type="date" pattern="\d{1,2}/\d{1,2}/\d{4}" class="form-control" name="DL_DateFinRemise" id="DL_DateFinRemise" value="@ViewBag.ArtPACKService.DL_DateFinRemise">*@
                                    <input class="form-control" pattern="\d{1,2}/\d{1,2}/\d{4}" type="text" id="DL_DateFinRemise" name="DL_DateFinRemise" value="@ViewBag.ArtPACKService.DL_DateFinRemise.ToString("dd/MM/yyyy")"
                                           placeholder="jj/mm/aaaa" />
                                }
                                else
                                {
                                    <input type="date" pattern="\d{1,2}/\d{1,2}/\d{4}" class="form-control" name="DL_DateFinRemise" id="DL_DateFinRemise" />
                                }
                            </div>
                        </div>


                        <div class="form-group">
                            <label class="col-sm-4 control-label">
                                Frais d'installation <small>Vous pouvez rajouter ou supprimer le frais avant de facturer.</small>
                            </label>
                            <div class="col-sm-8">
                                <label>
                                    @if (ViewBag.HasFraisInst)
                                    {
                                        <input class="checkbox-inline i-checks" type="radio" checked value=true id="FraisInstallation" name="FraisInstallation"> <span>Oui </span>
                                        <input class="checkbox-inline i-checks" type="radio" value=false id="FraisInstallation" name="FraisInstallation"> <span> Non </span>

                                    }
                                    else
                                    {
                                        <input class="checkbox-inline i-checks" type="radio" value=true id="FraisInstallation" name="FraisInstallation"> <span>Oui </span>
                                        <input class="checkbox-inline i-checks" type="radio" value=false checked id="FraisInstallation" name="FraisInstallation"> <span> Non </span>
                                    }
                                </label>
                            </div>
                        </div>
                        @if (Model.DO_Etape > 4)
                        {
                            <div class="form-group">
                                <label class="col-sm-4 control-label">
                                    Articles réservés pour cet abonnement
                                </label>
                                @foreach (var item in ViewBag.ArtPACK)
                                {
                                    <div class="col-sm-8">
                                        @if (item.AR_Type == 0 && item.LS_NoSerie != null)
                                        {
                                            <strong class="text-success">@item.DL_Design :</strong> <strong> @item.LS_NoSerie </strong>
                                        }
                                    </div>

                                }
                            </div>
                        }


                        @if (Model.TypeAbonnement != 9)
                        {
                            <div class="form-group">
                                <label class="col-sm-4 control-label">
                                    Changement de l'offre
                                </label>
                                <div class="col-sm-8">
                                    <select class="col-md-6 form-control chosen-select changementoffre" id="DebitAbonnement" name="ChangementDebitAbonnement">
                                        @if (ViewBag.listeDebitsDispoMemeArticle != null)
                                        {
                                            foreach (var item in ViewBag.listeDebitsDispoMemeArticle)
                                            {
                                                if (ViewBag.ArtPACKService.AR_Ref == item.AR_Ref)
                                                {
                                                    <option class="font-bold text-white" style="background-color:#4D57A6;" value="@item.AR_Ref" selected="selected"> Débit: @item.D_Debit @item.AR_Ref @item.AR_Design </option>
                                                }
                                                else
                                                {
                                                    <option class="font-bold" value="@item.AR_Ref"> Débit: @item.D_Debit - Article: @item.AR_Ref @item.AR_Design </option>
                                                }
                                            }
                                        }
                                    </select>
                                </div>
                            </div>

                            if (Model.DO_Etape > 4)
                            {
                                <div class="form-group" id="selectedLSSERIE">

                                    <label class="col-sm-4 control-label">
                                        Articles réservés pour cet abonnement
                                    </label>

                                    <div class="col-sm-8">

                                        @if (ViewBag.Materiel1 != null)
                                        {
                                            int j = 0;
                                            foreach (var kkkk in ViewBag.Materiel1)
                                            {
                                                <div id="resArticle[@j]">

                                                    <div class="form-group">
                                                        <div class="" id="selectjedLSSERIE">

                                                            <select class="form-control" id="ChangementLotSerie[@j]" name="ChangementLotSerie" data-placeholder="Choisir les références...">
                                                                @if (ViewBag.NumSeriesReserves != null)
                                                                {
                                                                    for (int k = 0; k < ViewBag.NumSeriesReserves.Count; k++)
                                                                    {
                                                                        if (ViewBag.NumSeriesReserves[k].AR_Ref == kkkk.AR_Ref)
                                                                        {
                                                                            <option style="background-color:#4D57A6;" class="text-white" value="@ViewBag.NumSeriesReserves[k].LS_NoSerie">@ViewBag.NumSeriesReserves[k].LS_NoSerie</option>

                                                                        }
                                                                    }
                                                                }
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                                j = j + 1;
                                            }

                                        }
                                    </div>

                                </div>
                                <div id="selectNumSerie">

                                </div>

                            }
                        }
                        @if (ViewBag.FraisInstBEE)
                        {
                            <div class="form-group">
                                <label class="col-md-4 control-label">Montant Frais d'installation BEE (HT) </label>
                                <div class="col-md-8">
                                    <input class="form-control" id="FraisBEE" pattern="\d*([,\/]?\d+)" name="FraisBEE" placeholder="0,000" value=0 />
                                </div>
                            </div>
                        }
                        <div class="form-group">
                            <label class="col-md-4 control-label">Total Règlements </label>
                            <div class="col-md-8">
                                @if (ViewBag.Reglements == null)
                                {
                                    <p> 0 TDN </p>
                                }
                                else
                                {
                                    <input type="text" class="form-control" disabled value="@String.Format("{0:N3}", (decimal)(ViewBag.ReglementsTotal)) TND">
                                }


                            </div>
                        </div>

                    </fieldset>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-purplebee  ladda-button">Valider</button>
                </div>

            }
        </div>

    </div>
</div>
<!--liste des bl-->
<div class="modal inmodal" id="ListeBL" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                <h4 class="modal-title">Liste des bon de sortie </h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <form role="form">
                        <div class="form-group">
                            @if (ViewBag.listeBL == null)
                            {
                                <p>Aucune BL </p>

                            }
                            else
                            {
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>N° BL</th>
                                            <th>Date</th>
                                            <th>Voir </th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        @foreach (var item in ViewBag.listeBL)
                                        {

                                            <tr>
                                                <td>
                                                    @item.DO_Piece
                                                </td>
                                                <td>
                                                    @item.DO_Date.ToString("dd/MM/yyyy")
                                                </td>
                                                <td>
                                                    <a class="btn btn-purplebee btn-circle   btn-outline" title="voir la BL"
                                                       href="@Url.Action("ImprimerBL","DocumentsVente", new { id = item.cbMarq })" target="_blank">
                                                        <i title="Imprimer BL " class="fa fa-print"></i>
                                                    </a>

                                                </td>
                                            </tr>

                                        }
                                    </tbody>
                                </table>
                            }

                        </div>
                    </form>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-greenbee" data-dismiss="modal">Fermer</button>
            </div>
        </div>
    </div>
</div>
<!--Remise -->
<!--Remise -->
<div class="modal inmodal" id="AppliquerRemise" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title"> Changement remise abonnement  </h4>
            </div>
            @using (Html.BeginForm("ValiderChangementRemise", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
            {
                <div class="modal-body">
                    @Html.HiddenFor(model => model.cbMarq)

                    <div class="alert alert-warning">
                        <i class="fa fa-info fa-fw"></i>  Notez que tout changement de remise  ne sera pris en considération qu'à partir la prochaine facture.

                    </div>

                    <div class="row">
                        <div class="col-lg-12">
                            <div class="form-group">
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label class="col-lg-3 control-label">Prix HT de l'offre</label>

                                        <div class="col-lg-9">
                                            <span class="help-block m-b-none">
                                                <input type="text" class="form-control" name="DL_Prix" id="DL_Prix" value="@ViewBag.ArtPACKService.DL_PrixUnitaire" readonly>
                                            </span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-lg-3 control-label">Date fin remise</label>

                                        <div class="col-lg-9">
                                            <span class="help-block m-b-none">
                                                @if (ViewBag.ArtPACKService.DL_DateFinRemise != null)
                                                {
                                                    <input type="text" class="form-control" name="DL_DateFinRemise" id="DL_DateFinRemise" value="@ViewBag.ArtPACKService.DL_DateFinRemise.ToString("dd/MM/yyyy")" readonly>
                                                }
                                                else
                                                {
                                                    <input type="text" class="form-control" name="DL_DateFinRemise" id="DL_DateFinRemise" value="@ViewBag.ArtPACKService.DL_DateFinRemise" readonly>

                                                }
                                            </span>

                                            @*<span class="help-block m-b-none">
                                                    <input type="text" class="form-control" name="DL_DateFinRemise" id="DL_DateFinRemise" value="@ViewBag.ArtPACKService.DL_DateFinRemise" readonly>
                                                </span>*@
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-lg-3 control-label">Remise</label>

                                        <div class="col-lg-9">

                                            <span class="help-block m-b-none">

                                                <input type="text" class="form-control" name="DL_RemiseValeur" id="DL_RemiseValeur" value="@String.Format("{0:N2}", ViewBag.ArtPACKService.DL_RemiseValeur) %" readonly>

                                            </span>
                                        </div>
                                    </div>
                                </div>

                            </div>



                        </div>

                    </div>
                    @*</div>*@
                    <fieldset class="form-horizontal">
                        <div class="form-group">
                            <label class="control-label">
                                Remise
                            </label>
                            <div class="">
                                @*<input  type="text" pattern="\d*([,\/]?\d+)" value=0 name="Remise" id="Remise" required>*@
                                <input type="text" pattern="\d*([,\/]?\d+)" class="form-control" id="Remise" name="Remise" required>

                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label">Date de fin remise</label>
                            <div class="">
                                <input type="date" pattern="\d{1,2}/\d{1,2}/\d{4}" class="form-control" name="DateFinRemise" id="DateFinRemise" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label">Commentaires</label>
                            <div class="">
                                <textarea type="text" id="CommentaireChangement" name="CommentaireChangement" class="form-control col-sm-pull-2"></textarea>
                            </div>
                        </div>

                    </fieldset>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-purplebee  ladda-button">Valider</button>
                </div>
            }
        </div>
    </div>
</div>
@*Modifier Abonnement*@
<div class="modal inmodal" id="ChangerMotifAnnulation" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated fadeIn">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Choisir motif d'annulation</h4>
            </div>
            @using (Html.BeginForm("ChangerMotifAnnulation", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
            {
                <div class="modal-body">
                    @Html.HiddenFor(model => model.cbMarq)
                    <div class="form-group">
                        <label class="control-label">Motif</label>
                        <div class="">
                            <select class="col-md-6 form-control chosen-select Motif_Annulation" id="Motif_Annulation" name="Motif_Annulation">
                                @foreach (var item in ViewBag.Motifannulation)
                                {
                                    if (item.Motif == Model.Motif_Annulation)
                                    {
                                        <option class="font-bold" value="@item.Motif" selected> @item.Motif </option>
                                    }
                                    else
                                    {
                                        <option class="font-bold" value="@item.Motif"> @item.Motif </option>
                                    }
                                }
                            </select>



                        </div>
                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Non</button>
                    <button type="submit" class="btn btn-purplebee ladda-button">Oui </button>
                </div>
            }
        </div>
    </div>
</div>
<div class="modal inmodal" id="ChangerMotifResiliation" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated fadeIn">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Choisir motif de résiliation</h4>
            </div>
            @using (Html.BeginForm("ChangerMotifResiliation", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
            {
                <div class="modal-body">
                    @Html.HiddenFor(model => model.cbMarq)
                    <div class="form-group">
                        <label class="control-label">Motif</label>
                        <div class="">
                            <select class="col-md-6 form-control chosen-select Motif_Annulation" id="Motif_Annulation" name="Motif_Annulation">
                                @foreach (var item in ViewBag.MotifResiliation)
                                {
                                    if (item.Motif == Model.Motif_Annulation)
                                    {
                                        <option class="font-bold" value="@item.Motif" selected> @item.Motif </option>
                                    }
                                    else
                                    {
                                        <option class="font-bold" value="@item.Motif"> @item.Motif </option>
                                    }
                                }
                            </select>



                        </div>
                    </div>



                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Non</button>
                    <button type="submit" class="btn btn-purplebee ladda-button">Oui </button>
                </div>
            }
        </div>
    </div>
</div>
@*Retour a l'etape precedente*@
<div class="modal inmodal" id="RetourEtape" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated fadeIn">
            <div class="modal-header">
                <div class="alert alert-danger alert-dismissable">
                    Etes vous sur de vouloir retourner à l'étape précédente ?
                </div>
            </div>
            @using (Html.BeginForm("RetournerEtape", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
            {
                <div class="modal-body">
                    @Html.HiddenFor(model => model.cbMarq)
                    <p style="text-align:center;font-size:25px;">
                        Etes vous sur de vouloir retourner à l'étape précédente ?
                    </p>
                </div>
                <br />
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-purplebee ladda-button">Confirmer </button>
                </div>
            }
        </div>
    </div>
</div>
@*retourner au niveau de   l'etape  « Facturation » à «  paiement et livraison »  *@
<div class="modal inmodal" id="RetourEtapeFact" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated fadeIn">
            <div class="modal-header">
                <div class="alert alert-danger alert-dismissable">
                    Etes vous sur de vouloir retourner l'etape ?
                </div>
            </div>
            @using (Html.BeginForm("RetourEtapeFact", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
            {
                <div class="modal-body">
                    @Html.HiddenFor(model => model.cbMarq)
                    <p style="text-align:center;font-size:25px;">Etes vous sur de vouloir retourner l'etape ?</p>
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="form-group">
                                <label class="col-sm-3 control-label">
                                    <small>Vous pouvez génerer contre reçu ?</small>
                                </label>
                                <div class="col-sm-1">
                                    <label>
                                        <input class="checkbox-inline i-checks" type="radio" value=0 id="Value" name="Value">
                                    </label>
                                </div>
                                <label class="col-sm-3 control-label">
                                    <small>Vous pouvez supprimer le réglement?</small>
                                </label>
                                <div class="col-sm-1">
                                    <label>
                                        <input class="checkbox-inline i-checks" type="radio" value=1 id="Value" name="Value">
                                    </label>
                                </div>
                                <label class="col-sm-3 control-label">
                                    <small>Ne rien fait</small>
                                </label>
                                <div class="col-sm-1">
                                    <label>
                                        <input class="checkbox-inline i-checks" type="radio" checked value=2 id="Value" name="Value">
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <br />
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-purplebee ladda-button">Confirmer </button>
                </div>
            }
        </div>
    </div>
</div>
@*Modification agence creatrice suite demende houssem*@
<div class="modal inmodal" id="ChangeAgenceCreation" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated bounceIn">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                <h4 class="modal-title">Changement Agence creation</h4>
            </div>
            @using (Html.BeginForm("ChangeAgenceCreation", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
            {
                <div class="modal-body">
                    @Html.HiddenFor(model => model.cbMarq)
                    <fieldset class="form-horizontal">
                        <i>Etes vous sur de vouloir changer l'agence creation de cet abonnement  ?</i>
                        <div class="form-group ">
                            <select class="form-control chosen-select" name="A_CodeCreation" id="A_CodeCreation">

                                @foreach (var item in ViewBag.ListOfAgences)
                                {
                                    if (item.Value == Model.A_IntCreation)
                                    {
                                        <option value="@item.Value" selected>@item.Text</option>
                                    }
                                    else
                                    {
                                        <option value="@item.Value">@item.Text</option>
                                    }
                                }
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Remarque </label>
                            <div class="col-sm-10">
                                <textarea type="text" class="form-control" id="RemarqueChangement"></textarea>
                            </div>
                        </div>
                    </fieldset>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-warning">Oui </button>
                </div>
            }
        </div>
    </div>
</div>
<div class="modal inmodal" id="ChangeLivraison" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated bounceIn">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
                <h4 class="modal-title">Prise en charge livraison</h4>
            </div>
            @using (Html.BeginForm("changementLivraison", "Abonnement", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
            {
                <div class="modal-body">
                    @Html.HiddenFor(model => model.cbMarq)
                    <center>
                        <fieldset class="form-horizontal">
                            <i>Etes vous sur de vouloir changer le prise en charge livraison ?</i>
                            <div class="form-group ">


                                @if (ViewBag.Livraison)
                                {
                                    <input class="checkbox-inline i-checks" type="radio" checked value=true id="AB_Livraison" name="AB_Livraison"> <span>Oui </span>
                                    <input class="checkbox-inline i-checks" type="radio" value=false id="AB_Livraison" name="AB_Livraison"> <span> Non </span>
                                }
                                else
                                {
                                    <input class="checkbox-inline i-checks" type="radio" value=true id="AB_Livraison" name="AB_Livraison"> <span>Oui </span>
                                    <input class="checkbox-inline i-checks" type="radio" checked value=false id="AB_Livraison" name="AB_Livraison"> <span> Non </span>
                                }
                            </div>
                        </fieldset>
                    </center>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-greenbee">Modifier </button>
                </div>
            }
        </div>
    </div>
</div>
<!-- Toastr script -->
<script src="~/js/plugins/toastr/toastr.min.js"></script>
<script src="~/js/jquery-3.1.1.min.js"></script>
<!-- Chosen -->
<script src="~/js/plugins/chosen/chosen.jquery.js"></script>
<script src="~/js/plugins/datapicker/bootstrap-datepicker.js"></script>
<!-- Sweet alert -->
<script src="~/js/plugins/sweetalert/sweetalert.min.js"></script>
<!-- TouchSpin -->
<script src="~/js/plugins/touchspin/jquery.bootstrap-touchspin.min.js"></script>
<!-- Ladda -->
<script src="~/js/plugins/ladda/spin.min.js"></script>
<script src="~/js/plugins/ladda/ladda.min.js"></script>
<script src="~/js/plugins/ladda/ladda.jquery.min.js"></script>
<script>
    $('#cbIndice').change(function () {
        if ($('#cbIndice').val() != 2) {
            document.getElementById("ifospayement").style.display = "block";
        }
        else {
            document.getElementById("ifospayement").style.display = "none";
        }
    });
    $(document).ready(function () {
        $('.chosen-select').chosen({ width: "100%" });
        $("#ChangementLotSerie1").trigger("chosen:updated");
        $("#ChangementLotSerie2").trigger("chosen:updated");

        var ckbox = $("input[name='Abo_Freq']");
        var chkId = '';
        @*var userno1=0;
        userno1 = userno1.toFixed(3);
        var userno3=0;
        userno3 = userno3.toFixed(3);
        var usernoo6=0;
        usernoo6 = usernoo6.toFixed(3);
        var usernooo12=0;
        usernooo12 = usernooo12.toFixed(3);
        var userno24=0;
        userno24 = userno24.toFixed(3);
        if(@ViewBag.AR_RemiseP3!=null)
        {
            userno3=@ViewBag.AR_RemiseP3;
            userno3 = userno3.toFixed(3);

        }
        if(@ViewBag.AR_RemiseP6!=null)
        {
            usernoo6=@ViewBag.AR_RemiseP6;
            usernoo6 = usernoo6.toFixed(3);

        }
        if(@ViewBag.AR_RemiseP12!=null)
        {
            usernooo12=@ViewBag.AR_RemiseP12;
            usernooo12 = usernooo12.toFixed(3);

        }*@
        $('input').on('click', function() {

            if (ckbox.is(':checked')) {
                $("input[name='Abo_Freq']:checked").each ( function() {
                    chkId = $(
                    ).val() + ",";
                    chkId = chkId.slice(0, -1);
                    if(chkId==1)
                    {

                        $("#DL_RemiseValeur").val(userno1.replace(".",","));

                    }
                    if(chkId==3)
                    {

                        $("#DL_RemiseValeur").val(userno3.replace(".",","));

                    }
                    if(chkId==6)
                    {

                        $("#DL_RemiseValeur").val(usernoo6.replace(".",","));
                    }
                    if(chkId==12)
                    {
                        $("#DL_RemiseValeur").val(usernooo12.replace(".",","));
                    }
                    if(chkId==24)
                    {

                        $("#DL_RemiseValeur").val(userno24.replace(".",","));

                    }


                });

            }
        });



        //$('.i-checks').iCheck({
        //    radioClass: 'iradio_square-green'
        //});
        // Bind normal buttons
        Ladda.bind( '.ladda-button',{ timeout: 200000 });
        // Bind progress buttons and simulate loading progress
        Ladda.bind( '.progress-demo .ladda-button',{
            callback: function( instance ){
                var progress = 0;
                var interval = setInterval( function(){
                    progress = Math.min( progress + Math.random() * 0.1, 1 );
                    instance.setProgress( progress );

                    if( progress === 1 ){
                        instance.stop();
                        clearInterval( interval );
                    }
                }, 200000 );
            }
        });

        var l = Ladda.bind('.ladda-button-demo');

        l.click(function(){
            // Start loading
            l.ladda( 'start' );

            // Timeout example
            // Do something in backend and then stop ladda
            setTimeout(function(){
                l.ladda('stop');
            },1200000)
        });
        $('.mycheck').on('change', function() {
            $('.mycheck').not(this).prop('checked', false);
        });
        $('.i-checks').iCheck({
            radioClass: 'iradio_square-green'
        });
        $('.chosen-select').chosen({ width: "100%" });
        $('.i-checks').iCheck({
            radioClass: 'iradio_square-green'
        });



    //    $('#DO_Statut').val(@Model.DO_Statut)



        $('#DO_Statut').trigger("chosen:updated");
        $("#validerAb").addClass('hidden');
        var doetapee =@Model.DO_Etape;
        $('#DO_Etape').val(doetapee)
        $('#DO_Etape').trigger("chosen:updated");

        if($("#DO_Ref").val().length != 0){
            $("#DO_Ref").attr('disabled', true);
        }
        if($("#aboTel").val().length != 0){
            $("#aboTel").attr('disabled', true);

        }

        $('.chosen-select').chosen({width: "100%"});
        //$('#AR_Ref').addClass('chosen-select');
        //$('#AR_Ref').trigger("chosen:updated");
    });

    $('#validerAb').click(function () {
        $('#Valider').val(1);
        $("#validerAbonement").modal();
    });


    //function showmodal(){

    $("#showmodal").click(function () {
        var etape =  @Model.DO_Etape;
        switch(etape){
            case 0: $("#ModifierAbo").modal();break;
            case 1: $("#ModifierAboChangerDebit").modal();break;
            case 2: $("#ModifierAboFrais").modal();break;
            case 3: $("#ModifierAbo").modal(); break;
            case 4: if (@ViewBag.TypeMigre== 1 && @ViewBag.AlerteBR!= 1) { $("#RetourMatrielMigration").modal(); $('.chosen-select', this).chosen('destroy').chosen(); break; }
            else { $("#ModifierAboMiseEnservice").modal(); $('.chosen-select', this).chosen('destroy').chosen(); break; }
            case 5: $("#ModifierAbo").modal();break;
            case 6: $("#ValiderAbo").modal();break;
        }
    });

    $("#envoiedemandeAppro").click(function () {
        {

            var url = "/Abonnement/DemandeApproAutomatique?cbmodel=@Model.cbMarq&&codeArticle=" + $("#AR_Ref").val()
                + "&&RefTT=@Model.DO_Ref" ;

            $.ajax({
                type: "GET",
                url: url,
                dataType: "json",
                success: function (data) {
                //    window.location = "/Interne/ListeDemandeAppro/"+ data ;
                    $("#alertAppro").removeClass('hidden');
                    $("#hrefAppro").attr("href", "/Interne/DetailDemandeAppro/"+data);
               //     "@@Url.Action("ListeDemandeAppro", "Interne", new { id =  })

                }

            })
        }
    });

   		 function EnregistrerAdre(cbmarq) {

        swal({
            title: "Êtes vous sûr ?",
            text: "Enregistrer les modifications ?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Oui,Modifier!",
            closeOnConfirm: false,
            closeOnCancel: false
        },
         function(isConfirm){
             if (isConfirm) {
                 $.ajax({
                     type: "Post",
                     url: '/Abonnement/ModifierAdresses?cbmarq=@Model.cbMarq&&CT_Intitule='+ $('#CT_Intitule').val()+
                    '&&ct_contact='+ $('#CT_Contact').val()+
                    '&&ID_CTAdresse='+$('select#ID_CTAdresse').find("option:selected").val() +
                    '&&CT_AdresseFacture='+$('select#CT_AdresseFacture').find("option:selected").val() +
                     '&&CT_AdresseInst='+$('select#CT_AdresseInst').find("option:selected").val() +
                    "&&CT_Complement=" + $('#CT_Complement').val(),
                     success: function () {
                         swal("Modifié!", "Vos modifications ont été enregistrées avec succès .", "success");
                         window.location = "/Abonnement/Modifier/@Model.cbMarq";

                     }
                 });
             }else{
                 swal("Annuler");
             }
         })
   		 }

function SaveRemarque(cbm) {

    //alert(cbm);
    $.ajax({
        type: "get",
        url: "/Abonnement/SaveNote?OpId=" + cbm + "&&Sujet=" + $("#titreRemarque").val() + "&&Description=" + $("#descRemarque").val(),
        dataType: "json",
        success: function (msg) {

            window.location = "/Abonnement/Details/@Model.cbMarq";

        }
    });
}
    function SaveDocuments(cbm) {
        /**************/
        var fileUpload = $("#FileUpload1").get(0);
        var files = fileUpload.files;

        // Create FormData object
        var fileData = new FormData();

        // Looping over all files and add it to FormData object
        for (var i = 0; i < files.length; i++) {
            fileData.append(files[i].name, files[i]);
        }

        // Adding one more key to FormData object
        fileData.append('CRM', 'EasySales');


        $.ajax({
            type: "Post",
            url: "/Abonnement/SaveDocuments?cbm=" + cbm + "&&titreDoc=" + $("#titreDoc").val() + "&&DescDoc=" + $("#DescDoc").val(),
            contentType: false, // Not to set any content header
            processData: false, // Not to process data
            data: fileData,
            success: function (res) {

                if(res.Result == 1){

                    toastr.error(res.msg, 'Erreur');

                }else{

                    toastr.success(res.msg, 'Success');
                    location.reload(true);

                }


            }
        });
    }

    function SaveArticlesSUS(){

        if($('#ArticleSUSList').find("option:selected").val() == "" || $('#ArticleSUSList').find("option:selected").val() == null){
            alert("Veuillez indiquer l'article en sus à ajouter ");
        }
        else{
            $.ajax({
                type: "get",
                url: "/Abonnement/AjouteArticleSUS?AboId=@Model.cbMarq&&ListeArticleSUS=" + $('#ArticleSUSList').find("option:selected").val(),
                dataType: "json",
                success: function (msg) {
                    if(msg.msg=="0"){
                        window.location = "/Abonnement/Modifier/@Model.cbMarq";

                    }else{
                        toastr.error(msg.msg, 'Erreur Abonnement SUS');
                    }

                }
            });
        }
    }



    $('.changementoffre').change(function(){
        var nb=@ViewBag.Reservees;
        var ii =$('.changementoffre').val() ;
        $('#selectedLSSERIE').empty();
    

        listedesMateriels(ii);
        function listedesMateriels(arref) {
            $('.chosen-select').chosen({ width: "100%" });
            $.ajax({
                type: "get",
                url: "/Abonnement/GetArticleLie?arref="+ encodeURIComponent(arref)+"&&cbmq=@Model.cbMarq",
                dataType: "json",
                success: function (msg) {
                    $('#selectNumSerie').empty();
                    //var number = msg.count;
                    var data2 = msg.nomenclaPrinc;
                    console.log(data2);
                    var data = msg.nomenclaProp;
                    console.log(data);
                    if (data2 != null && data2 != 0) {
                        var len = msg.nomenclaPrinc.length;
                        $("#selectedLSSERIE").append(
                            '<label class="col-sm-4 control-label"> Articles réservés pour cet abonnementttttttttttt </label>'
                        );
                        for (var j = 0; j < len; j++) {

                            console.log("msg.msg[j].NO_RefDet = " + msg.nomenclaPrinc[j].NO_RefDet);
                            var select = document.createElement("select");
                            var option = document.createElement("option");
                            select.name = "ChangementLotSerie";
                            select.id = "ChangementLot" + j;
                            select.className = 'form-control col-lg-8 chosen-select';
                           
                            var url = "/Abonnement/getNumSerie?arref=" + msg.nomenclaPrinc[j].NO_RefDet;
                            getservice = function (url) {
                                var res = $.ajax({
                                    type: "POST",
                                    url: url,
                                    dataType: "json",
                                    async: false,
                                    success: function (data) {
                                    }
                                }).responseText;
                                return res;
                            }
                            var ListeSeries = getservice(url);
                            var d = JSON.parse(ListeSeries);

                            if (msg.materiel1 != "") {
                                for (var k = 0; k < msg.materiel1.length; k++) {
                                    if (msg.nomenclaPrinc[j].NO_RefDet == msg.materiel1[k].AR_Ref) {

                                        option.value = msg.materiel1[k].LS_NoSerie;
                                        option.text = msg.ardesign[j].AR_Design + " : " + msg.materiel1[k].LS_NoSerie;
                                        select.className = 'form-control col-sm-8 chosen-select';
                                        select.appendChild(option);

                                    }
                                }
                            }
                            for (var i = 0; i < d.data.length; i++) {
                                var counter = d.data[i];
                                var option = document.createElement("option");
                                option.value = counter.LS_NoSerie;
                                option.text = msg.ardesign[j].AR_Design + " : " + counter.LS_NoSerie;
                                option.className = "form-control col-sm-8 text-success";
                                select.appendChild(option);
                            }
                            $("#selectedLSSERIE").append("<div class='col-sm-8' id='selectLot'></div>");
                            $("#selectLot").append(select);
                           
                        }
                    }
                    
                    if (data != null && data != 0) {
                        var len = msg.nomenclaProp.length;
                        /*for (var j = 0; j < len; j++) {*/

                          //  console.log("msg.msg[j].NO_RefDet = " + msg.nomenclaProp[j].NO_RefDet);
                            //var label = document.createElement("label");
                            //label.innerHTML = msg.ardesign[j].AR_Design;
                            //label.htmlFor = "pets";
                            //label.className='col-lg-12 form-control control-label';
                                $("#selectedLSSERIE").append(
                                    '<label class="col-sm-4 control-label"> Articles réservés pour cet abonnementaaaaaaaaa </label>'+
                                    '<div class="col-sm-8">' +
                                    ' <select class="form-control chosen-select" id="selectart1" name="selectart1">' +
                                    '</select>' +
                                    '</div>'
                        );
                        $("#selectart1").append(
                            '<optgroup  id="group1" >' +
                            '</optgroup>' 
                        );
                        var Prop = msg.ardesign2.length;
                        $("#group1").append("<option>-- Choisir --</option>");
                        for (var jj = 0; jj < Prop; jj++) {

                            $("#group1").append("<option class='form-control col-sm-8 font-bold'  value='" + msg.ardesign2[jj].AR_Ref + "'>" + msg.ardesign2[jj].AR_Design + "</option>");                                //$("#CT_CodePostal").append("<input type='" + text + "class='" + form - control + "name='" + CT_CodePostal + "id='" + CT_CodePostal + "value='" + msg.cpostal[i] + "'>");

                           
                        }
                      
                    }
                    $('#selectart1').change(function () {
                        listedesNumserie();

                    });
                }

            });

        }


    });




    function listedesNumserie() {

        $('#selectNumSerie').empty();
        
        var url = "/Abonnement/getNumSerie?arref=" + $('#selectart1').val();
        getservice = function (url) {
            var res = $.ajax({
                type: "POST",
                url: url,
                dataType: "json",
                async: false,
                success: function (data) {
                }
            }).responseText;
            return res;
        }
        var ListeSeries = getservice(url);
        var d = JSON.parse(ListeSeries);
        $('#selectNumSerie').append(
            '<label class="col-sm-4 control-label"> Numéro de serie </label>' +
            '<div class="col-sm-8">' +
            ' <select class="form-control chosen-select" id="ChangementLotSerie" name="ChangementLotSerie">' +
            '</select>' +
            '</div>'
        )
        
        for (var i = 0; i < d.data.length; i++) {
            $("#ChangementLotSerie").append("<option class='form-control  font-bold'  value='" + d.data[i].LS_NoSerie + "'>" + d.data[i].LS_NoSerie + "</option>");
        }
        $(document).ready(function () {
            $('.chosen-select').chosen({ width: "100%" });
            $('#ChangementLotSerie').addClass('chosen-select');
            $("#ChangementLotSerie").trigger("chosen:updated");
            $('.chosen-select').chosen({ width: "100%" });
        });
    }

    function ContreRecuParReglement(cbmarq) {
        swal({
            title: "Générer Bon rendu ?",
            text: " ",
            type: "warning",
            showCancelButton: true,
            cancelButtonText: 'Annuler',
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Oui.",
            closeOnConfirm: false
        }, function () {
            $.ajax({
                type: "get",
                url: '/Abonnement/contrerecuParReglement?cbmarq='+cbmarq, // we are calling json method
                dataType: 'json',
                success: function (result) {
                    if (result.result == 0) {
                        swal("Attention!", "Vous ne pouvez pas générer un contre reçu sur ce reglement. il est lié à une facture.", "warning");

                    } else if (result.result == 1) {

                        swal("Payée!", "Facture payée avec succès ! ", "success");
                        swal({
                            title: "Imprimer ",
                            text: "impression contre reçu ",
                            type: "success",
                            showCancelButton: true,
                            confirmButtonColor: "#DD6B55",
                            confirmButtonText: "Oui",
                            closeOnConfirm: false,
                            showCancelButton: false,
                        }, function () {
                            //**************************
                            window.open('/DocumentsAbonnements/ContreRecu' + result.msg + '.pdf', '_blank');
                            swal("Bon rendu générée", " ", "success");
                            window.location('/Abonnement/Modifier/' +@Model.cbMarq);

                        });
                    }

                    else {
                        swal({
                            title: "Ok",
                            text: "Annuler La Génération de bon rendu.",
                            type: "warning"
                        });
                    }
                }
            });
        });


    }

    $('.AnnulerResiliation').click(function () {
        swal({
            title: "Êtes vous sûr ?",
            text: "Cet abonnement sera Valider.",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Oui, Valider",
            closeOnConfirm: false
        }, function () {
            $.ajax({
                type: "get",
                url: "/Abonnement/AnnulerResiliation?cbMarq=@Model.cbMarq",
                dataType: "json",
                success: function (msg) {
                    if (msg.msg==1)
                    {
                        swal("Abonnement validé!", "Abonnement terminé.", "success");
                        location.reload();
                    }else
                    {

                        swal(msg.result, "erreur");
                        location.reload();
                    }


                }
            });
        });
    });



    $('.suspendrefacturation').click(function () {
        swal({
            title: "Êtes vous sûr ?",
            text: "la facturation de cet abonnement sera suspendue.",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Oui, suspendre",
            closeOnConfirm: false
        }, function () {
            $.ajax({
                type: "get",
                url: "/Abonnement/SuspendreAbonnement?cbMarq=@Model.cbMarq",
                dataType: "json",
                success: function (msg) {

                    swal("Facturation suspendue!", "Abonnement terminé.", "success");
                    location.reload();

                }
            });
        });
    });

    $('.reactiverfacturation').click(function () {
        swal({
            title: "Êtes vous sûr ?",
            text: "la facturation de cet abonnement sera réactivé. vous devez générer les factures sur demande.",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Oui, réactiver",
            closeOnConfirm: false
        }, function () {
            $.ajax({
                type: "get",
                url: "/Abonnement/ReactiverAbonnement?cbMarq=@Model.cbMarq",
                dataType: "json",
                //success: function (msg) {

                //    swal("Facturation réactivée!", "Abonnement terminé.", "success");
                //    location.reload();

                //}
                    success: function (msg) {
                    if (msg.msg == 1) {
                        swal("Facturation réactivée!", "Abonnement terminé.", "success");
                        location.reload();
                    } else {

                        swal(msg.result, "erreur");
                        location.reload();
                    }


                }
            });
        });
    });


  function BonRetourLigneMateriel(cbmarqLigne) {
        var depotSelected= $('#A_CodeLivraison').val();

        swal({
            title: "Êtes vous sûr ?",
            text: "Créer Bon de retour.",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Oui,Générer!",
            closeOnConfirm: false,
            closeOnCancel: false
        },
         function(isConfirm){
             if (isConfirm) {
                 $.ajax({
                     type: "Post",
                     url: "/Abonnement/RetourMateriel?cbmarqLigne="+cbmarqLigne+"&&depotSelected=" + $('#A_CodeLivraison').val(),
                     success: function (msg) {
                             if(msg=1)
                             {
                                 swal("Bon de retour crée!", "materiels retournées.", "success");
                                 window.location = "/Abonnement/Modifier/@Model.cbMarq";
                                 //location.reload();
                             }else
                             {

                                 swal("Erreur dans créaction d bon de retour", "Veuilez contacter votre administrateur", "error");
                                 window.location = "/Abonnement/Modifier/@Model.cbMarq";
                                 //location.reload();
                             }
                     }
                 });
             }else{
                 swal("Annuler");
             }
         })
    }

    @*$.ajax({
        type: "get",
        url: "/Abonnement/Partial_IsSuspendu?id=@Model.cbMarq",
        dataType: "json",
        success: function (result) {
            if(result.result=="0")
            {
                $("#is_suspendu_container").text("Ligne suspendue.");
            }
//0: client suspendu
//1: client non suspendu
//2: client non ajout dans la base d’authentification
        }});*@



    function SupprimerRemarque(cbmarq) {

        swal({
            title: "Êtes vous sûr ?",
            text: "Supprimer Remarque.",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "Oui,Supprimer!",
            closeOnConfirm: false,
            closeOnCancel: false
        },
         function(isConfirm){
             if (isConfirm) {
                 $.ajax({
                     type: "Post",
                     url: "/Abonnement/SupprimerRemarque?cbmarq="+cbmarq,
                     success: function () {
                         swal("Supprimer remarque!", "", "success");
                         window.location = "/Abonnement/Modifier/@Model.cbMarq";

                     }
                 });
             }else{
                 swal("Annuler");
             }
         })
    }

     function ChangerStatutNS(button) {
           //Determine the reference of the Row using the Button.
           var row = $(button).closest("tr");
         var idPiece = $("td", row).eq(0).html();
         var idNoSerie = $("td", row).eq(2).html();
           //var idStatut = $("td", row).eq(3).html();

           var slect = $('select[name^="ListOfStatutNS"]', row).val();
         //var idNoSerieSelect = idNoSerie.val();
           $.ajax({
               type: "get",
               url: '/Abonnement/ModifierStatutNS?AboId=' + @Model.cbMarq + '&&NS=' +  $('#LS_NoSerie').val()  +'&&StatutS=' + slect, // we are calling json method
               dataType: 'json',
               success: function (msg) {
                   if(msg.msg=="0"){
                       window.location = "/Abonnement/Modifier/@Model.cbMarq";

                   }else{
                       toastr.error(msg.msg, 'Erreur Abonnement SUS');
                   }


               }
           });

    };

     
    $('#arRef').change(function () {
                getRegion();

       });
            function getRegion() {
              
                $.ajax({
                    type: "get",
                    url: '@Url.Action("ReservMat")', // we are calling json method
                    dataType: 'json',
                    data: { Ar_ref: $('#arRef').val(), cbmarq :@Model.cbMarq},
                    success: function (msg) {
                        if (msg.result == 0) {
                           
                            //var Siege = msg.LLSeries[0].LS_NoSerie;                           
                            var data2 = [];
                            var data = [];
                            if (msg.LLSeries != null) {
                                data2 = msg.LLSeries[0].LS_NoSerie
                            }
                            // var Rev = msg.LotSerieDepotLies[0].LS_NoSerie;
                            if (msg.LotSerieDepotLies != null) {
                                data = msg.LotSerieDepotLies[0].LS_NoSerie
                            }
                            $("#NumSerieDep").empty();
                            $("#NumSerieDep").append(
                                ' <label class="col-sm-2 control-label">N° de série</label>' +
                                '<div class="col-sm-10">'+
                                ' <select class="form-control chosen-select" id="selectart" name="selectart">' +
                                '</select>' +
                                '</div>'
                            );

                            $("#selectart").append(
                                '<optgroup label="Dépôt Revendeur" id="group1" >' +
                                '</optgroup>'+
                                '<optgroup label="Dépôt Siège"  id="group2" >' +
                                '</optgroup>'
                            );
                            if (data != null && data != 0) {
                                var len = msg.LotSerieDepotLies[0].LS_NoSerie.length;
                                for (var i = 0; i < len; i++) {

                                    $("#group1").append("<option class='form-control  font-bold text-greenbee'  value='" + data[i].LS_NoSerie + "'>" + data[i].LS_NoSerie + "</option>");                                //$("#CT_CodePostal").append("<input type='" + text + "class='" + form - control + "name='" + CT_CodePostal + "id='" + CT_CodePostal + "value='" + msg.cpostal[i] + "'>");

                                }
                            }
                           
                            if (data2 != null && data2 != 0) {
                                var len2 = msg.LLSeries[0].LS_NoSerie.length;
                                for (var i = 0; i < len2; i++) {

                                    $("#group2").append("<option class='form-control  font-bold text-purplebee' value='" + data2[i].LS_NoSerie + "'>" + data2[i].LS_NoSerie + "</option>");                                //$("#CT_CodePostal").append("<input type='" + text + "class='" + form - control + "name='" + CT_CodePostal + "id='" + CT_CodePostal + "value='" + msg.cpostal[i] + "'>");

                                }
                            }
                           
                            $(document).ready(function () {
                                $('.chosen-select').chosen({ width: "100%" });
                                $('#selectart').addClass('chosen-select');
                                $("#selectart").trigger("chosen:updated");
                                $('.chosen-select').chosen({ width: "100%" });
                            });
                        }
                    }
                });
         }
    
</script>
